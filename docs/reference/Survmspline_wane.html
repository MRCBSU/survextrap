<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>M-spline survival distribution under treatment effect waning — Survmspline_wane • survextrap</title><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="M-spline survival distribution under treatment effect waning — Survmspline_wane"><meta name="description" content='This defines the CDF, cumulative hazard and hazard of a survival
distribution defined by combining the hazards of two different
groups (e.g. "treated" and "untreated") each defined by a standard
M-spline model. The log hazards of one group and the other are
interpolated over a defined period of time.  This may be used for
models where the treatment effect wanes, over a period of time,
between an estimated hazard ratio and zero.'><meta property="og:description" content='This defines the CDF, cumulative hazard and hazard of a survival
distribution defined by combining the hazards of two different
groups (e.g. "treated" and "untreated") each defined by a standard
M-spline model. The log hazards of one group and the other are
interpolated over a defined period of time.  This may be used for
models where the treatment effect wanes, over a period of time,
between an estimated hazard ratio and zero.'></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">survextrap</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.16</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/cetuximab.html">Case study of using survextrap: cetuximab for head and neck cancer</a></li>
    <li><a class="dropdown-item" href="../articles/examples.html">Examples of using survextrap</a></li>
    <li><a class="dropdown-item" href="../articles/methods.html">Details of methods behind survextrap</a></li>
    <li><a class="dropdown-item" href="../articles/priors.html">Priors in survextrap models</a></li>
    <li><a class="dropdown-item" href="../articles/sbc.html">Simulation-based calibration of survextrap</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/chjackson/survextrap/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>M-spline survival distribution under treatment effect waning</h1>
      <small class="dont-index">Source: <a href="https://github.com/chjackson/survextrap/blob/HEAD/R/waning.R" class="external-link"><code>R/waning.R</code></a></small>
      <div class="d-none name"><code>Survmspline_wane.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This defines the CDF, cumulative hazard and hazard of a survival
distribution defined by combining the hazards of two different
groups (e.g. "treated" and "untreated") each defined by a standard
M-spline model. The log hazards of one group and the other are
interpolated over a defined period of time.  This may be used for
models where the treatment effect wanes, over a period of time,
between an estimated hazard ratio and zero.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">Hsurvmspline_wane</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">alpha1</span>,</span>
<span>  <span class="va">alpha0</span>,</span>
<span>  <span class="va">coefs1</span>,</span>
<span>  <span class="va">coefs0</span>,</span>
<span>  <span class="va">knots</span>,</span>
<span>  degree <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  <span class="va">wane_period</span>,</span>
<span>  wane_nt <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  pcure1 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  pcure0 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  offsetH <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  backhaz <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bsmooth <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  log <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">psurvmspline_wane</span><span class="op">(</span></span>
<span>  <span class="va">q</span>,</span>
<span>  <span class="va">alpha1</span>,</span>
<span>  <span class="va">alpha0</span>,</span>
<span>  <span class="va">coefs1</span>,</span>
<span>  <span class="va">coefs0</span>,</span>
<span>  <span class="va">knots</span>,</span>
<span>  degree <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  bsmooth <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">wane_period</span>,</span>
<span>  wane_nt <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  lower.tail <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  pcure1 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  pcure0 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  offsetH <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  backhaz <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  log.p <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">hsurvmspline_wane</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">alpha1</span>,</span>
<span>  <span class="va">alpha0</span>,</span>
<span>  <span class="va">coefs1</span>,</span>
<span>  <span class="va">coefs0</span>,</span>
<span>  <span class="va">knots</span>,</span>
<span>  degree <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  bsmooth <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">wane_period</span>,</span>
<span>  wane_nt <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  pcure1 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  pcure0 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  offseth <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  backhaz <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  log <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dsurvmspline_wane</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">alpha1</span>,</span>
<span>  <span class="va">alpha0</span>,</span>
<span>  <span class="va">coefs1</span>,</span>
<span>  <span class="va">coefs0</span>,</span>
<span>  <span class="va">knots</span>,</span>
<span>  degree <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  bsmooth <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">wane_period</span>,</span>
<span>  wane_nt <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  pcure1 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  pcure0 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  offseth <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  offsetH <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  backhaz <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  log <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">qsurvmspline_wane</span><span class="op">(</span></span>
<span>  <span class="va">p</span>,</span>
<span>  <span class="va">alpha1</span>,</span>
<span>  <span class="va">alpha0</span>,</span>
<span>  <span class="va">coefs1</span>,</span>
<span>  <span class="va">coefs0</span>,</span>
<span>  <span class="va">knots</span>,</span>
<span>  degree <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  bsmooth <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  lower.tail <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  log.p <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  pcure1 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  pcure0 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  offsetH <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  backhaz <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">wane_period</span>,</span>
<span>  wane_nt <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">rsurvmspline_wane</span><span class="op">(</span></span>
<span>  <span class="va">n</span>,</span>
<span>  <span class="va">alpha1</span>,</span>
<span>  <span class="va">alpha0</span>,</span>
<span>  <span class="va">coefs1</span>,</span>
<span>  <span class="va">coefs0</span>,</span>
<span>  <span class="va">knots</span>,</span>
<span>  degree <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  bsmooth <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  pcure1 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  pcure0 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  offsetH <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  backhaz <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">wane_period</span>,</span>
<span>  wane_nt <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">rmst_survmspline_wane</span><span class="op">(</span></span>
<span>  <span class="va">t</span>,</span>
<span>  <span class="va">alpha1</span>,</span>
<span>  <span class="va">alpha0</span>,</span>
<span>  <span class="va">coefs1</span>,</span>
<span>  <span class="va">coefs0</span>,</span>
<span>  <span class="va">knots</span>,</span>
<span>  degree <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  pcure1 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  pcure0 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  offsetH <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  backhaz <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bsmooth <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">wane_period</span>,</span>
<span>  wane_nt <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  disc_rate <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"gl"</span>,</span>
<span>  gl_nodes <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mean_survmspline_wane</span><span class="op">(</span></span>
<span>  <span class="va">alpha1</span>,</span>
<span>  <span class="va">alpha0</span>,</span>
<span>  <span class="va">coefs1</span>,</span>
<span>  <span class="va">coefs0</span>,</span>
<span>  <span class="va">knots</span>,</span>
<span>  degree <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  pcure1 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  pcure0 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  backhaz <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bsmooth <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">wane_period</span>,</span>
<span>  wane_nt <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  disc_rate <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x-q-t">x, q, t<a class="anchor" aria-label="anchor" href="#arg-x-q-t"></a></dt>
<dd><p>Vector of times.</p></dd>


<dt id="arg-alpha-coefs-pcure-">alpha1, coefs1, pcure1<a class="anchor" aria-label="anchor" href="#arg-alpha-coefs-pcure-"></a></dt>
<dd><p>log hazard intercept, spline coefficients and cure probability before the start of the waning period ("treated")</p></dd>


<dt id="arg-alpha-coefs-pcure-">alpha0, coefs0, pcure0<a class="anchor" aria-label="anchor" href="#arg-alpha-coefs-pcure-"></a></dt>
<dd><p>log hazard intercept, spline coefficients and cure probability after the end of the waning period ("untreated")</p></dd>


<dt id="arg-knots">knots<a class="anchor" aria-label="anchor" href="#arg-knots"></a></dt>
<dd><p>Locations of knots on the axis of time, supplied in
increasing order.  These include the two boundary knots.</p>
<p>In vectorised usage of these functions, the knots and degree must be
the same for all alternative times and parameter values.</p></dd>


<dt id="arg-degree">degree<a class="anchor" aria-label="anchor" href="#arg-degree"></a></dt>
<dd><p>Spline polynomial degree.  Can only be changed from
the default of 3 if <code>bsmooth</code> is <code>FALSE</code>.</p></dd>


<dt id="arg-wane-period">wane_period<a class="anchor" aria-label="anchor" href="#arg-wane-period"></a></dt>
<dd><p>vector of two components giving start and stop of waning
period</p></dd>


<dt id="arg-wane-nt">wane_nt<a class="anchor" aria-label="anchor" href="#arg-wane-nt"></a></dt>
<dd><p>time resolution for piecewise constant hazard approximation in the
waning period.  If this is not specified, defaults to dividing the waning period into 10 pieces.</p></dd>


<dt id="arg-offseth">offsetH<a class="anchor" aria-label="anchor" href="#arg-offseth"></a></dt>
<dd><p>Constant to be added to the cumulative hazard.</p></dd>


<dt id="arg-backhaz">backhaz<a class="anchor" aria-label="anchor" href="#arg-backhaz"></a></dt>
<dd><p>A data frame that defines the background hazard as a piecewise-constant function of time.
This should have two columns, named <code>"time"</code> and
<code>"hazard"</code>. Each row gives the "background" hazard between the
specified time and the next time. The first element of
<code>"time"</code> should be 0, and the final row specifies the hazard at all
times greater than the last element of <code>"time"</code>.</p></dd>


<dt id="arg-bsmooth">bsmooth<a class="anchor" aria-label="anchor" href="#arg-bsmooth"></a></dt>
<dd><p>If <code>TRUE</code> then the function is constrained to
also have zero derivative and second derivative at the boundary.</p></dd>


<dt id="arg-log-log-p">log, log.p<a class="anchor" aria-label="anchor" href="#arg-log-log-p"></a></dt>
<dd><p>Return log density or probability.</p></dd>


<dt id="arg-lower-tail">lower.tail<a class="anchor" aria-label="anchor" href="#arg-lower-tail"></a></dt>
<dd><p>logical; if <code>TRUE</code> (default), probabilities are \(P(X
\le x)\), otherwise, \(P(X &gt; x)\).</p></dd>


<dt id="arg-offseth">offseth<a class="anchor" aria-label="anchor" href="#arg-offseth"></a></dt>
<dd><p>Constant to be added to the hazard, e.g. representing a "background" risk of death from causes other than the cause of interest.</p></dd>


<dt id="arg-p">p<a class="anchor" aria-label="anchor" href="#arg-p"></a></dt>
<dd><p>Vector of probabilities.</p></dd>


<dt id="arg-n">n<a class="anchor" aria-label="anchor" href="#arg-n"></a></dt>
<dd><p>Number of random numbers to simulate.</p></dd>


<dt id="arg-disc-rate">disc_rate<a class="anchor" aria-label="anchor" href="#arg-disc-rate"></a></dt>
<dd><p>Discounting rate used to calculate the discounted mean
or restricted mean survival time, using an exponential discounting function.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Method of numerical integration to obtain the
restricted mean survival time from the survival function.</p>
<p>The default is <code>method="gl"</code>, a Gauss-Legendre method with 100
nodes between zero and the maximum of <code>t</code>.</p>
<p><code>method="adaptive"</code> uses the base R <code>integrate</code> function, which is
much slower, but potentially more robust for badly-behaved
survival functions.</p></dd>


<dt id="arg-gl-nodes">gl_nodes<a class="anchor" aria-label="anchor" href="#arg-gl-nodes"></a></dt>
<dd><p>Number of nodes for the Gauss-Legendre method.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>psurvmspline_wane</code> gives the CDF, <code>Hsurvmspline_wane</code> gives the cumulative
hazard, <code>hsurvmspline_wane</code> gives the hazard, <code>dsurvmspline_wane</code> gives the PDF,
<code>qsurvmspline_wane</code> gives the quantiles, and <code>rsurvmspline_wane</code> generates random
numbers from the distribution.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This distribution is defined as follows.</p><ul><li><p>Between time 0 and <code>wane_period[1]</code>, the "treated" hazard is
used, as defined by an M-spline with intercept <code>alpha1</code>.</p></li>
<li><p>Between <code>wane_period[1]</code> and <code>wane_period[2]</code>, the log hazard is
defined by linear interpolation.  The waning period is divided
into a number of discrete pieces in which the hazard is assumed to
be constant, defined by the hazard at the start of the piece.
These hazard values are obtained from the spline model, using an
intercept parameter <code>alpha</code> (log scale parameter) defined by
linearly interpolating between <code>alpha1</code> and <code>alpha0</code> over the
waning period.  The cumulative hazard at any time can then be
deduced by adding up contributions on each piece.</p></li>
<li><p>After <code>wane_period[2]</code>, the "untreated" hazard is used, as defined by an
M-spline with intercept <code>alpha0</code>.</p></li>
</ul><p>See the <a href="https://chjackson.github.io/survextrap/articles/methods.html">methods vignette</a> for more details and examples.</p>
<p>This can be used to predict the hazard of a person treated with a
treatment whose short-term effect is estimated from shorter-term
data, but we wish to extrapolate this model over a longer period
where the effect is assumed to diminish.</p>
<p>This may not work if the hazard is zero or infinite at any point
in the waning period (thus the log hazard is indeterminate).  This
might typically happen at time 0.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Christopher Jackson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer></div>





  </body></html>

