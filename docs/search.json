[{"path":"https://chjackson.github.io/survextrap/articles/cetuximab.html","id":"simple-data-summary","dir":"Articles","previous_headings":"","what":"Simple data summary","title":"Case study of using survextrap: cetuximab for head and neck cancer","text":"data analysis survival head neck cancer, previously conducted Guyot et al.. survextrap package provides data cetux, cetux_seer cetux_bh. cetux data clinical trial cetuximab radiotherapy, compared control group received radiotherapy. cetux_seer contain matched data USA cancer registry, cetux_bh describes comparable survival general population USA. See help(\"cetux\") Guyot et al. information. first load required packages, plot Kaplan-Meier curve individual trial data, create subsets data treatment group, use later analyses.","code":"library(survextrap) library(ggplot2) library(dplyr) library(viridis) # for colour palettes survminer::ggsurvplot(survfit(Surv(years, d) ~ treat, data=cetux)) + xlab(\"Years\") control <- cetux[cetux$treat==\"Control\",] cetuximab <- cetux[cetux$treat==\"Cetuximab\",]"},{"path":"https://chjackson.github.io/survextrap/articles/cetuximab.html","id":"spline-specification","dir":"Articles","previous_headings":"","what":"Spline specification","title":"Case study of using survextrap: cetuximab for head and neck cancer","text":"First set M-spline, specifying expect maximum 6 spline coefficients sufficient describe hazard variations, want allow hazards change 20 years. resulting default spline knots saved mspline object . default knots based quantiles event times data (supply data command).","code":"mspline <- mspline_spec(Surv(years, d) ~ 1, data=cetux, df=6, add_knots=20)"},{"path":"https://chjackson.github.io/survextrap/articles/cetuximab.html","id":"choice-of-priors","dir":"Articles","previous_headings":"","what":"Choice of priors","title":"Case study of using survextrap: cetuximab for head and neck cancer","text":"transparency , priors specified explicitly, rather relying package defaults. parameters spline models hard interpret, can determine suitable priors translating quantities easier interpret. sometimes require simulation. Note also knowledge spline knots necessary calculations, set mspline object advance setting priors. See linked function documentation details functions work.","code":""},{"path":"https://chjackson.github.io/survextrap/articles/cetuximab.html","id":"hazard-scale-parameter-eta-","dir":"Articles","previous_headings":"Choice of priors","what":"Hazard scale parameter \\(\\eta\\).","title":"Case study of using survextrap: cetuximab for head and neck cancer","text":"Since patients trial median age 57 (range 34 83), prior \\(\\eta\\) calibrated imply prior mean survival 25 years diagnosis, variance chosen mean survival high 100 years diagnosis. function p_meansurv() translates prior median upper 95% credible limit mean survival appropriate normal distribution log hazard scale \\(\\eta\\). Note distribution represents uncertainty population mean, individual variability (broader). Conversely, prior_haz_const() function translates normal prior \\(\\eta\\) corresponding beliefs survival. use check lower limit distribution derived p_meansurv() sensible.","code":"prior_hscale <- p_meansurv(median=25, upper=100, mspline=mspline) prior_haz_const(mspline, prior_hscale = prior_hscale) ##        haz   mean ## 2.5%  0.01   6.25 ## 50%   0.04  25.00 ## 97.5% 0.16 100.00"},{"path":"https://chjackson.github.io/survextrap/articles/cetuximab.html","id":"hazard-variability-parameter-sigma-","dir":"Articles","previous_headings":"Choice of priors","what":"Hazard variability parameter \\(\\sigma\\).","title":"Case study of using survextrap: cetuximab for head and neck cancer","text":"prior \\(\\sigma\\) chosen highest hazard values 20 year horizon (90% quantile) expected \\(\\rho=2\\) times lowest values (10% quantile), vague 95% credible interval \\(\\rho\\) 1 16. function prior_haz_sd() uses simulation estimate beliefs implied particular Gamma prior \\(\\sigma\\) (jointly prior specified hazard scale). choice Gamma(2,5) arrived trial--error, distribution \\(\\rho\\) (quantity hr returned prior_haz_sd()) matched prior judgement. Note repeated simulations give slightly different results unless seed set.","code":"set.seed(1) prior_hsd <- p_gamma(2, 5) prior_haz_sd(mspline = mspline,              prior_hsd = prior_hsd,              prior_hscale = prior_hscale) ##             sd_haz    sd_mean        hr ## 2.5%  0.0002520058   1.374872  1.060858 ## 50%   0.0036770673  17.146610  1.855044 ## 97.5% 0.0371823461 303.313735 15.759463"},{"path":"https://chjackson.github.io/survextrap/articles/cetuximab.html","id":"hazard-ratio-for-treatment-effects","dir":"Articles","previous_headings":"Choice of priors","what":"Hazard ratio for treatment effects","title":"Case study of using survextrap: cetuximab for head and neck cancer","text":"prior treatment effect weak, designed rule extremely implausible values, prior median 1 upper 95% credible limit 50 hazard ratio. function p_hr() translates information normal prior log hazard ratio. function prior_hr() goes direction, summarises prior hazard ratio implied particular normal distribution log scale (special format returned p_hr(), alternatively function p_normal()).","code":"prior_loghr <- p_hr(median=1, upper=50) prior_hr(prior_loghr) ##  2.5%   50% 97.5%  ##  0.02  1.00 50.00"},{"path":"https://chjackson.github.io/survextrap/articles/cetuximab.html","id":"hazard-ratio-variability-parameter-tau-in-non-proportional-hazards-model","dir":"Articles","previous_headings":"Choice of priors","what":"Hazard ratio variability parameter \\(\\tau\\) in non-proportional hazards model","title":"Case study of using survextrap: cetuximab for head and neck cancer","text":"similar way, can calibrate Gamma prior parameter \\(\\tau\\), used non-proportional hazards models. governs size departure proportional hazards, .e. variability hazard ratio time. \\(\\tau\\) direct interpretation, can simulate hazard curves different treatment groups, compute ratio \\(\\rho\\) “highest” (90% quantile) “lowest” (10% quantile) hazard ratio time. hazards proportional, \\(\\rho=1\\). Gamma(2,3) prior used, represents judgement hazard ratio vary 10-fold (order magnitude) different points 20 years.","code":"set.seed(1) prior_hrsd <- p_gamma(2, 3) prior_hr_sd(mspline = mspline,                                           prior_hsd = prior_hsd,             prior_loghr = prior_loghr,             prior_hscale = prior_hscale,             prior_hrsd = prior_hrsd,             formula = ~treat,             nonprop = ~treat,             newdata = data.frame(treat=1),              newdata0 = data.frame(treat=0)) ##              sd_hr      hrr ## 2.5%   0.001349767 1.080091 ## 50%    0.115265023 1.620410 ## 97.5% 26.188560197 6.940072"},{"path":"https://chjackson.github.io/survextrap/articles/cetuximab.html","id":"notes-on-model-computation","dir":"Articles","previous_headings":"","what":"Notes on model computation","title":"Case study of using survextrap: cetuximab for head and neck cancer","text":"default, survextrap fits models MCMC sampling. can slow, default settings takes 2 minutes per run. model development, can reduce number MCMC chains iterations setting chains iter calling survextrap. default 4 2000 respectively rstan package survextrap uses computation. approximation full MCMC sampling can also specified calling survextrap fit_method=\"opt\": runs instantly obtains posterior mode exactly, crudely approximates posterior summaries. useful development. ready produce “final” results, can switch back MCMC default number chains iterations. rhat convergence diagnostic shown printing results survextrap fit checked - close 1 MCMC fit converged. Occasionally fitting may report “divergent transitions”. limitation sampling algorithm, can happen posterior distribution awkward sample . See Stan documentation technical details. one two divergent transitions, message probably safe ignore, case results examined ensure make sense. lots divergent transitions, safer simplify model, e.g. using stronger priors fewer spline knots.","code":"options(mc.cores = 2) # CRAN check limits to 2 cores # options(mc.cores = parallel::detectCores()) chains <- 4; iter <- 2000"},{"path":[]},{"path":"https://chjackson.github.io/survextrap/articles/cetuximab.html","id":"single-treatment-group","dir":"Articles","previous_headings":"Models for the trial data alone","what":"Single treatment group","title":"Case study of using survextrap: cetuximab for head and neck cancer","text":"First fit two models control group trial data: one (mod_con) allowing hazard variations 20 years, another (mod_con5) assuming constant hazard 5 years. mod_con5 implemented leaving mspline argument survextrap, case final spline knot set end data. models survextrap assume constant hazard final spline knot. plot comparing survival hazard curves models built. use survival() hazard() functions extract survival hazard estimates, combine give dataset can plotted ggplot().  plots show posterior median 95% credible intervals. data 5 20 years, extrapolation trial data period depends model assumption - either hazard constant, hazard change smoothly, unknown direction extent change. allow change, uncertainty appropriately greater.","code":"mod_con <- survextrap(Surv(years, d) ~ 1, data=control, mspline=mspline,                       chains=chains, iter=iter,                       prior_hscale=prior_hscale, prior_hsd = prior_hsd) mod_con5 <- survextrap(Surv(years, d) ~ 1, data=control,                         chains=chains, iter=iter,                         prior_hscale=prior_hscale, prior_hsd = prior_hsd) surv_const <- survival(mod_con5, tmax=20) %>% mutate(model=\"Constant hazard\") surv_ipd <- survival(mod_con, tmax=20) %>% mutate(model=\"Varying hazard\") surv_single <- rbind(surv_const, surv_ipd) haz_const <- hazard(mod_con5, tmax=20) %>% mutate(model=\"Constant hazard\") haz_ipd <- hazard(mod_con, tmax=20) %>% mutate(model=\"Varying hazard\") haz_single <- rbind(haz_const, haz_ipd)  ps <- ggplot(surv_single, aes(x=t, y=median,                          group=model, col=model, fill=model)) +      geom_ribbon(aes(ymin=lower, ymax=upper), alpha=0.2, colour=NA) +     geom_line(lwd=1.3) +      geom_step(data=mod_con$km, aes(x=time, y=surv), lwd=1.3,               inherit.aes = FALSE) +     theme_minimal() +      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +     xlab(\"Years after diagnosis\") +      ylab(\"Survival probability\") +     scale_color_viridis(discrete=TRUE) +      scale_fill_viridis(discrete=TRUE) +      theme(legend.position = c(0.6, 0.8)) + labs(col=NULL, fill=NULL) +     theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +     geom_vline(xintercept = max(control$years)) +     geom_vline(xintercept = mod_con5$mspline$iknots, col=\"gray80\", lty=2) ## Warning: A numeric `legend.position` argument in `theme()` was deprecated in ggplot2 ## 3.5.0. ## ℹ Please use the `legend.position.inside` argument of `theme()` instead. ## This warning is displayed once every 8 hours. ## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was ## generated. ph <- ggplot(haz_single, aes(x=t, y=median,                          group=model, col=model, fill=model)) +      geom_ribbon(aes(ymin=lower, ymax=upper), alpha=0.2, colour=NA) +     geom_line(lwd=1.3) +      theme_minimal() + xlab(\"Years after diagnosis\") + ylab(\"Hazard\") +     theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +     scale_color_viridis(discrete=TRUE) +      scale_fill_viridis(discrete=TRUE) +      geom_vline(xintercept = max(control$years)) +     geom_vline(xintercept = mod_con5$mspline$iknots, col=\"gray80\", lty=2) +      theme(legend.position = \"none\")  grid::grid.newpage() grid::grid.draw(cbind(ggplotGrob(ps),                        ggplotGrob(ph)))"},{"path":"https://chjackson.github.io/survextrap/articles/cetuximab.html","id":"determining-an-optimal-number-of-knots","dir":"Articles","previous_headings":"Models for the trial data alone","what":"Determining an optimal number of knots","title":"Case study of using survextrap: cetuximab for head and neck cancer","text":"model seems fit trial data well, Bayesian procedure designed mitigate overfitting many spline knots. Even , might still want reassurance spline function appropriate amount complexity describe data. Therefore use LOOIC compare range models different numbers spline basis functions (set via df argument mspline_spec). estimates RMST within 5 years change within 0.1. Note one many ad-hoc checks - note change prior smoothness prior_hsd, also governs amount smoothness hazard function. LOOCV also lower df=7. practice might want switch df according data included, simplicity illustration article, stick df=6 models, general gives slightly stabler computation without affecting results. Using LOOIC model choice may result fitted hazard functions wiggle lot time appear “overfit” data - may matter just want use model estimating quantities averaged time, restricted mean survival. LOOIC designed prediction. instead want use description hazard trajectory, might want pick simpler model setting df lower value.","code":"dfs <- 5:12 rescomp <- as.data.frame(matrix(nrow=length(dfs), ncol=7)) for (i in seq_along(dfs)){     msp <- mspline_spec(Surv(years, d) ~ 1, data=control, df=dfs[i])     mod <- survextrap(Surv(years, d) ~ 1, data=control, mspline=msp,                       chains=chains, iter=iter,                       prior_hscale = prior_hscale, prior_hsd = prior_hsd)      rescompi <- cbind(list(df = dfs[i]),                    list(looic = mod$loo$estimates[\"looic\",\"Estimate\"]),                   rmst(mod,t=5))     rescomp[i,] <- rescompi } names(rescomp) <- names(rescompi) rescomp %>%    mutate(looic = round(looic, 1),           rmf = sprintf(\"%s (%s, %s)\", round(median,2),                         round(`lower`, 2), round(`upper`, 2))) %>%   select(df, looic, rmf) %>%   knitr::kable(col.names = c(\"df\", \"LOOIC\", \"Restricted mean survival (5 years)\"))"},{"path":"https://chjackson.github.io/survextrap/articles/cetuximab.html","id":"models-for-the-trial-data-with-a-treatment-effect","dir":"Articles","previous_headings":"Models for the trial data alone","what":"Models for the trial data with a treatment effect","title":"Case study of using survextrap: cetuximab for head and neck cancer","text":"now fit joint model arms trial data, describing treatment effect either proportional hazards (mod_ph) survextrap’s novel flexible non-proportional hazards model (mod_nph). also fit model cetuximab treatment arm alone, couple model mod_con control arm fitted earlier. survival curves three models now compared. results goodness-fit compared three models. compare estimates restricted mean survival control group (rmst()), increase mean survival time treated group (irmst() ). restricted 5-year trial horizon (t=5). Note using functions like rmst() survival() extract outputs models covariates, supply newdata say covariate values want outputs computed . call rmst() told compute control group. left newdata call irmst() , models one factor covariate two levels, calculate, default, mean second level minus mean first level. little difference fit three models. following code formats table LaTeX format (paper).","code":"mod_ph <- survextrap(Surv(years, d) ~ treat, data=cetux,                       mspline=mspline,                       chains=chains, iter=iter,                      prior_hscale=prior_hscale, prior_hsd = prior_hsd,                      prior_loghr=prior_loghr) ## Warning: There were 3 divergent transitions after warmup. See ## https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup ## to find out why this is a problem and how to eliminate them. ## Warning: Examine the pairs() plot to diagnose sampling problems mod_nph <- survextrap(Surv(years, d) ~ treat, data=cetux, mspline=mspline,                        chains=chains, iter=iter,                       nonprop = TRUE,                       prior_hscale=prior_hscale, prior_hsd = prior_hsd,                       prior_loghr=prior_loghr, prior_hrsd=prior_hrsd) mod_cet <- survextrap(Surv(years, d) ~ 1, data=cetuximab, mspline=mspline,                        chains=chains, iter=iter,                       prior_hscale=prior_hscale, prior_hsd = prior_hsd) surv_ph <- survival(mod_ph, tmax=7) %>% mutate(Model=\"Proportional hazards\") surv_nph <- survival(mod_nph, tmax=7) %>% mutate(Model=\"Non-proportional hazards\") surv_cet <- survival(mod_cet, tmax=7) %>%      mutate(Model=\"Separate fits\", treat=\"Cetuximab\") %>% relocate(treat) surv_con <- survival(mod_con, tmax=7) %>%      mutate(Model=\"Separate fits\", treat=\"Control\") %>% relocate(treat) surv_trt <- rbind(surv_ph, surv_nph, surv_cet, surv_con)  ggplot(surv_trt, aes(x=t, y=median, col=Model, lty=treat)) +      geom_step(data=mod_ph$km, aes(x=time, y=surv, lty=treat), lwd=1.3,               inherit.aes = FALSE) +     geom_line(lwd=1.1) +      labs(lty=\"Treatment\", col=NULL) +     theme_minimal() +     theme(legend.position = c(0.6, 0.8)) +     theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +     xlab(\"Years after diagnosis\") +      ylab(\"Survival probability\") +     scale_color_viridis(discrete=TRUE) +      geom_vline(xintercept = max(cetux$years)) +     geom_vline(xintercept = mod_con5$mspline$iknots, col=\"gray80\", lty=2) comp_fn <- function(mod){     rm <- rmst(mod, niter=1000, newdata=data.frame(treat=\"Control\"), t=c(5,20)) %>%          rename(rm_med=\"median\", rm_lower=\"lower\", rm_upper=\"upper\") %>%          select(t, rm_med, rm_lower, rm_upper)     irm <- irmst(mod, niter=1000, t=c(5,20)) %>%         rename(ir_med=\"median\", ir_lower=\"lower\", ir_upper=\"upper\") %>%         select(ir_med, ir_lower, ir_upper)     cbind(name=deparse(substitute(mod)), rm, irm,            list(looic = mod$loo$estimates[\"looic\",\"Estimate\"])) }  rmst_con <- rmst(mod_con, t=c(5,20)) %>%   rename(rm_med=\"median\", rm_lower=\"lower\", rm_upper=\"upper\") %>%    select(t, rm_med, rm_lower, rm_upper)  irmst_sep <- rmst(mod_cet, t=c(5,20), sample=TRUE) - rmst(mod_con, t=c(5,20), sample=TRUE)   irmst_sep <- irmst_sep %>%   posterior::summarise_draws(median,                              ~quantile(.x, probs=c(0.025, 0.975))) %>%   rename(t=variable, ir_med=\"median\",ir_lower=\"2.5%\", ir_upper=\"97.5%\") %>%    select(ir_med, ir_lower, ir_upper)  loo_sep <- mod_con$loo$estimates[\"looic\",\"Estimate\"] +   mod_cet$loo$estimates[\"looic\",\"Estimate\"] comp_sep <- cbind(list(name=\"mod_sep\"), rmst_con, irmst_sep, list(looic=loo_sep))  trtcomp <- rbind(comp_fn(mod_ph), comp_fn(mod_nph), comp_sep) trtcompf <- trtcomp %>%   arrange(t) %>%   mutate(rm = sprintf(\"%s (%s,%s)\", round(rm_med,2),                       round(rm_lower,2), round(rm_upper,2)),          ir = sprintf(\"%s (%s,%s)\", round(ir_med,2),                       round(ir_lower,2), round(ir_upper,2)),          looic = round(looic),          model = forcats::fct_recode(name,                                       \"(2a) Proportional hazards\"=\"mod_ph\",                                      \"(2b) Non-proportional hazards\"=\"mod_nph\",                                      \"(2c) Separate arms\"=\"mod_sep\"          )) %>%   select(model, t, rm, ir, looic) %>%   tibble::remove_rownames() knitr::kable(trtcompf, col.names=c(\"Model\",\"Time horizon\",                                    \"Restricted mean survival\",                                    \"Increase in restricted mean survival\",                                    \"LOOIC\")) write.table(trtcompf, sep=\"  &  \", eol=\"\\\\\\\\\\n\", quote=FALSE, row.names = FALSE) ## model  &  t  &  rm  &  ir  &  looic\\\\ ## (2a) Proportional hazards  &  5  &  2.89 (2.64,3.12)  &  0.31 (-0.03,0.62)  &  1156\\\\ ## (2b) Non-proportional hazards  &  5  &  2.88 (2.62,3.15)  &  0.31 (-0.05,0.67)  &  1158\\\\ ## (2c) Separate arms  &  5  &  2.88 (2.63,3.14)  &  0.53 (-0.66,4.33)  &  1163\\\\ ## (2a) Proportional hazards  &  20  &  4.89 (3.79,6.79)  &  1.1 (-0.13,2.47)  &  1156\\\\ ## (2b) Non-proportional hazards  &  20  &  4.97 (3.8,7.03)  &  1.13 (-0.47,3.04)  &  1158\\\\ ## (2c) Separate arms  &  20  &  5.11 (3.83,7.28)  &  0.53 (-0.66,4.33)  &  1163\\\\"},{"path":"https://chjackson.github.io/survextrap/articles/cetuximab.html","id":"external-data-registry-data-on-control-group","dir":"Articles","previous_headings":"","what":"External data: registry data on control group","title":"Case study of using survextrap: cetuximab for head and neck cancer","text":"example, registry data giving counts \\(r_j\\) survivors next year \\(n_j\\) alive year \\(j\\), \\(j=5\\) years onwards. supplied survextrap package cetux_seer. data can illustrated annual hazard estimates, calculated \\(-\\log(r_j/n_j)\\), shown thin step function plot . fit model assumes people registry data survival control group trial. allow potential variations hazard shape years 6 25 registry data reported, add extra knots 10, 15 20 years. Note: instead one row external data, giving survivors 25 years alive 6 years, impossible identify variations hazard within period 6 25 years, using multiple knots inside period futile. results illustrated, compared model mod_con trial data alone allowed hazard change trial. registry data makes hazard extrapolations much confident.","code":"head(cetux_seer) ##   start stop   r   n   treat        haz haz_upper  haz_lower ## 1     5    6 325 358 Control 0.09670780 0.1325969 0.06665828 ## 2     6    7 285 308 Control 0.07761060 0.1125955 0.04927675 ## 3     7    8 198 221 Control 0.10989567 0.1595617 0.06981746 ## 4     8    9 143 167 Control 0.15514918 0.2239099 0.09969098 ## 5     9   10 122 133 Control 0.08632808 0.1449198 0.04325704 ## 6    10   11 105 117 Control 0.10821358 0.1783369 0.05615430 mspline_seer <- mspline_spec(Surv(years, d) ~ 1, data=cetux, df=6,                               add_knots=c(10,15,20)) mod_seer <- survextrap(Surv(years, d) ~ 1, data=control,                         external=cetux_seer, mspline=mspline_seer,                         chains=chains, iter=iter,                         prior_hscale=prior_hscale, prior_hsd = prior_hsd) ## Warning: There were 1 divergent transitions after warmup. See ## https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup ## to find out why this is a problem and how to eliminate them. ## Warning: Examine the pairs() plot to diagnose sampling problems haz_con <- hazard(mod_con) %>%     mutate(Model=\"No external data\") haz_seer <- hazard(mod_seer,tmax=30) %>%      mutate(Model=\"With registry data\")  haz_plot_reg <- rbind(haz_con, haz_seer) %>% filter(t < 26)  ggplot(haz_plot_reg, aes(x=t, y=median, col=Model, fill=Model)) +      geom_ribbon(aes(ymin=lower, ymax=upper), alpha=0.2, colour=NA) +     geom_line() +     geom_step(data=cetux_seer, aes(x=start, y=haz), col=\"gray30\", inherit.aes = FALSE) +     geom_step(data=cetux_seer, aes(x=start, y=haz_lower), col=\"gray70\", lty=2, inherit.aes = FALSE) +     geom_step(data=cetux_seer, aes(x=start, y=haz_upper), col=\"gray70\", lty=2, inherit.aes = FALSE) +      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +     xlab(\"Years after diagnosis\") +      ylab(\"Hazard\") +     scale_color_viridis(discrete=TRUE) +      scale_fill_viridis(discrete=TRUE) +      geom_vline(xintercept = max(control$years))  +      theme(legend.position = c(0.4, 0.9),            legend.background=element_blank()) +      labs(col=NULL, fill=NULL)"},{"path":"https://chjackson.github.io/survextrap/articles/cetuximab.html","id":"knot-selection-for-external-data","dir":"Articles","previous_headings":"External data: registry data on control group","what":"Knot selection for external data","title":"Case study of using survextrap: cetuximab for head and neck cancer","text":"hazard seems fit external data, even just one knot designed capture hazard trajectory changes trial, placed 20 years. reassurance, examine alternative knot specifications, ensure captured variations need order estimate survival 20 years. Placing knots 10,15 20 years gives lowest (best) LOOIC alternatives. Adding knots judged -fitting, hampers predictive ability, fewer knots represent hazard variations. changes RMST estimates models small though.","code":"knot_list <- list(c(10,20),                    c(20),                   seq(8,20,by=2))  comp_fn <- function(mod){   rm <- rmst(mod, niter=1000, newdata=data.frame(treat=\"Control\"), t=c(20)) %>%      rename(rm_med=\"median\",rm_lower=\"lower\", rm_upper=\"upper\") %>%      mutate(rmf = sprintf(\"%s (%s, %s)\", round(rm_med,2),                           round(rm_lower,2), round(rm_upper,2))) %>%     select(t, rmf)   cbind(name=deparse(substitute(mod)), rm,           list(looic = round(mod$loo_external$estimates[\"looic\",\"Estimate\"]))) }  res <- vector(3, mode=\"list\") for (i in 1:3){   mspex <- mspline_spec(Surv(years, d) ~ treat, data=cetux, df=6,                           add_knots = knot_list[[i]])   mod <- survextrap(Surv(years, d) ~ 1, data=control,                      external=cetux_seer, mspline=mspex,                      chains=chains, iter=iter,                      prior_hscale=prior_hscale, prior_hsd = prior_hsd)   res[[i]] <- comp_fn(mod) } ## Warning: There were 6 divergent transitions after warmup. See ## https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup ## to find out why this is a problem and how to eliminate them. ## Warning: Examine the pairs() plot to diagnose sampling problems do.call(\"rbind\", c(list(comp_fn(mod_seer)), res)) %>%   mutate(knots = c(\"10,15,20\",                    unlist(lapply(knot_list, paste, collapse=\",\")))) %>%   select(knots, rmf, looic) %>%   knitr::kable(col.names=c(\"Additional knots\",                            \"Restricted mean survival over 20 years\",\"LOOIC\"))"},{"path":"https://chjackson.github.io/survextrap/articles/cetuximab.html","id":"population-data-in-an-additive-hazards-model","dir":"Articles","previous_headings":"","what":"Population data in an additive hazards model","title":"Case study of using survextrap: cetuximab for head and neck cancer","text":"alternative way including external data additive hazards (relative survival), using backhaz argument supply data frame describes background hazard times. describes population USA matched trial patients age, sex calendar year, supplied survextrap package cetux_bh. remaining data (trial registry) used infer excess hazard head neck cancer patients. model fitted assumes overall hazard trial registry patients sum background hazard (fixed data backhaz) unknown excess hazard estimated. Including population data make much difference estimated hazards 20 years diagnosis. benefit population data example inform extrapolations longer time horizon 25 year horizon registry data. now consider extrapolations 40 years. allow hazard shape change 40 years, extend spline specification include two knots 30 40 years, addition ones already placed 10, 15 20 years. Two models fitted, show impact population data. first includes trial registry data. second includes trial, registry population data. population data “anchors” extrapolation - hazard constrained less population, resulting estimates become precise. still lot uncertainty, since (knots 30 40 years) allowed possibility excess hazard changes beyond point (25-26 years) actually data .","code":"head(cetux_bh) ##   time    hazard ## 1    0 0.0092656 ## 2    1 0.0101710 ## 3    2 0.0111254 ## 4    3 0.0117602 ## 5    4 0.0132862 ## 6    5 0.0144244 mod_seer_pop <- survextrap(Surv(years, d) ~ 1, data=control, mspline = mspline_seer,                            external=cetux_seer, backhaz=cetux_bh,                             chains=chains,iter=iter,                            prior_hscale=prior_hscale, prior_hsd = prior_hsd) haz_seer <- hazard(mod_seer,tmax=20) %>% mutate(Model=\"Without population data\") haz_seer_pop <- hazard(mod_seer_pop,tmax=20) %>% mutate(Model=\"With population data\") haz_plot_reg_pop20 <- rbind(haz_seer, haz_seer_pop)  ggplot(haz_plot_reg_pop20, aes(x=t, y=median, col=Model, fill=Model)) +      geom_ribbon(aes(ymin=lower, ymax=upper), alpha=0.2, colour=NA) +     geom_line() +     geom_step(data=cetux_seer  %>% filter(stop < 20),                aes(x=start, y=haz), inherit.aes = FALSE) +     geom_step(data=cetux_seer  %>% filter(stop < 20),                aes(x=start, y=haz_lower), col=\"gray60\", lty=2, inherit.aes = FALSE) +     geom_step(data=cetux_seer  %>% filter(stop < 20),                aes(x=start, y=haz_upper), col=\"gray60\", lty=2, inherit.aes = FALSE) +      geom_step(data=cetux_bh %>% filter(time < 20),                aes(x=time, y=hazard), inherit.aes = FALSE, colour=\"darkgreen\") +     annotate(geom=\"text\", x=10, y=0, label=\"Population mortality\", colour=\"darkgreen\", size=2) +     theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +     xlab(\"Years after diagnosis\") +      ylab(\"Hazard\") +     scale_color_viridis(discrete=TRUE) +      geom_vline(xintercept = max(control$years)) +     theme(legend.position = c(0.8, 0.9),            legend.background=element_blank()) +      labs(col=NULL, fill=NULL) mspline40 <- mspline_spec(Surv(years, d) ~ treat, data=cetux, df=6,                            add_knots=c(10, 15, 20, 30, 40)) mod_seer40 <- survextrap(Surv(years, d) ~ 1, data=control, mspline = mspline40,                          external=cetux_seer,                           chains=chains, iter=iter,                           prior_hscale=prior_hscale, prior_hsd = prior_hsd) mod_seer_pop40 <- survextrap(Surv(years, d) ~ 1, data=control, mspline = mspline40,                            external=cetux_seer, backhaz=cetux_bh,                            chains=chains, iter=iter,                             prior_hscale=prior_hscale, prior_hsd = prior_hsd) haz_seer40 <- hazard(mod_seer40,tmax=40) %>%      mutate(Model=\"With registry data\") haz_seer_pop40 <- hazard(mod_seer_pop40,tmax=40) %>%      mutate(Model=\"With registry and population data\") haz_plot_reg_pop <- rbind(haz_seer40, haz_seer_pop40) ggplot(haz_plot_reg_pop, aes(x=t, y=median, col=Model, fill=Model)) +      ylim(0,0.5) +     geom_ribbon(aes(ymin=lower, ymax=upper), alpha=0.2, colour=NA) +     geom_line() +     geom_step(data=cetux_seer, aes(x=start, y=haz), inherit.aes = FALSE) +     geom_step(data=cetux_seer, aes(x=start, y=haz_lower), col=\"gray60\", lty=2,               inherit.aes = FALSE) +     geom_step(data=cetux_seer, aes(x=start, y=haz_upper), col=\"gray60\", lty=2,               inherit.aes = FALSE) +      geom_step(data=cetux_bh %>% filter(time < 40),                aes(x=time, y=hazard), inherit.aes = FALSE, colour=\"darkgreen\") +     annotate(geom=\"text\", x=33, y=0.1, label=\"Population mortality\", colour=\"darkgreen\", size=2) +     theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +     xlab(\"Years after diagnosis\") +      ylab(\"Hazard\") +     scale_color_viridis(discrete=TRUE) +      theme(legend.position = c(0.4, 0.9),            legend.background=element_blank()) +      labs(col=NULL, fill=NULL) +     geom_vline(xintercept = max(control$years))"},{"path":"https://chjackson.github.io/survextrap/articles/cetuximab.html","id":"mixture-cure-model","dir":"Articles","previous_headings":"","what":"Mixture cure model","title":"Case study of using survextrap: cetuximab for head and neck cancer","text":"extrapolation excess hazard still fairly uncertain, even registry population data included, since data informing excess hazard finish 25 years. many clinical applications, thought excess hazard population disease decrease time, particularly people grow older -cause mortality increases. examine couple ways use kind judgement improve survival extrapolations using survextrap. specific assumptions used may may realistic patients: case study intended demonstration methods, rather full, clinically-informed investigation head neck cancer survival. One way modelling decreasing hazard mixture cure model. can also used model decreasing excess hazard additive hazards model. simply specified setting cure=TRUE call survextrap. Optionally, Beta prior also specified “cure fraction” e.g. survextrap(..., prior cure = p_beta(1,10)), though default uniform prior used . cure fraction proportion people never experience event interest. survival curve decreases asymptote cure fraction, hence (informally) cure fraction can sometimes inferred data examining survival curve. Often however weakly informed data. example, excess hazard head neck cancer patients still substantial end registry data (25 years), little evidence “cure” data. Therefore extrapolations fitted cure model uncertain (see ), largely overlap equivalent model data cure assumed (see ). addition, cure model makes strong parametric assumption shape hazard decreases time.","code":"mod_cure <- survextrap(Surv(years, d) ~ 1, data=control, mspline = mspline40,                        external=cetux_seer, backhaz=cetux_bh,                         cure=TRUE,                         chains=chains, iter=iter,                        prior_hscale=prior_hscale, prior_hsd = prior_hsd) ## Warning: There were 3 divergent transitions after warmup. See ## https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup ## to find out why this is a problem and how to eliminate them. ## Warning: Examine the pairs() plot to diagnose sampling problems"},{"path":"https://chjackson.github.io/survextrap/articles/cetuximab.html","id":"elicited-data-to-inform-long-term-extrapolations","dir":"Articles","previous_headings":"","what":"Elicited data to inform long-term extrapolations","title":"Case study of using survextrap: cetuximab for head and neck cancer","text":"alternative way build judgements longer-term survival expert elicitation, discussed priors vignette. , suppose confident 40 years, survival head neck cancer patients similar general population. Instead using parametric cure model, can create artificial external dataset contains information judgement. annual population survival probability computed hazard stored cetux_bh, stored pops. Beta(n*pops, n(1-pops)) distribution n mean pops, 0.72. set n control amount uncertainty around prior guess. information Beta prior equivalent observed 1000*pops survivors 1000 people. gives numerator denominator n r survival start=39 stop=40 years. use construct dataset format needed external argument survextrap. can joined registry data cetux_seer, give external dataset supply survextrap.","code":"cetux_bh <- cetux_bh %>%    mutate(surv1 = exp(-hazard*1)) pops <- cetux_bh$surv1[39] qbeta(c(0.025, 0.5, 0.975), 1000*pops, 1000*(1-pops)) ## [1] 0.6961908 0.7244400 0.7515403 data_elic <- data.frame(   start=39, stop=40,   n = 1000,    r = round(1000*pops),   treat = \"Control\" ) pop_cured <-    cetux_seer %>% full_join(data_elic, by = join_by(start, stop, r, n, treat)) mod_cure_elic <- survextrap(Surv(years, d) ~ 1, data=control, mspline=mspline40,                              external=pop_cured, backhaz=cetux_bh,                              chains=chains, iter=iter,                             prior_hscale=prior_hscale, prior_hsd = prior_hsd) haz_cure <- hazard(mod_cure, tmax=40) %>% mutate(Model=\"Mixture cure model\") haz_cure_elic <- hazard(mod_cure_elic, tmax=40) %>% mutate(Model=\"Elicited survival\") haz_plot_cure <- rbind(haz_cure, haz_cure_elic)  ggplot(haz_plot_cure, aes(x=t, y=median, col=Model, fill=Model)) +      ylim(0,0.5) +     geom_ribbon(aes(ymin=lower, ymax=upper), alpha=0.2, colour=NA) +     geom_line() +     geom_step(data=cetux_seer, aes(x=start, y=haz), inherit.aes = FALSE) +     geom_step(data=cetux_seer, aes(x=start, y=haz_lower), col=\"gray60\", lty=2,               inherit.aes = FALSE) +     geom_step(data=cetux_seer, aes(x=start, y=haz_upper), col=\"gray60\", lty=2,               inherit.aes = FALSE) +      geom_step(data=cetux_bh %>% filter(time < 40),                aes(x=time, y=hazard), inherit.aes = FALSE, col=\"darkgreen\") +     annotate(geom=\"text\", x=20, y=0, label=\"Population mortality\", col=\"darkgreen\", size=2) +     theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +     xlab(\"Years after diagnosis\") +      ylab(\"Hazard\") +     scale_color_viridis(discrete=TRUE) +      geom_vline(xintercept = max(control$years)) +     theme(legend.position = c(0.4, 0.9),            legend.background=element_blank()) +      labs(col=NULL, fill=NULL)"},{"path":"https://chjackson.github.io/survextrap/articles/cetuximab.html","id":"table-of-mean-survival-times","dir":"Articles","previous_headings":"","what":"Table of mean survival times","title":"Case study of using survextrap: cetuximab for head and neck cancer","text":"table results paper now constructed formatted. compare restricted mean survival times, various time horizons, estimated various models fitted control group data. models categorised data included, assumptions made survival beyond data. following code formats table LaTeX format (paper).","code":"ni <- 4000  rcon <- rmst(mod_con, t=5, niter=ni) %>%    mutate(data=\"Trial\",extrap=\"No extrapolation\") rcon20 <- rmst(mod_con, t=20, niter=ni) %>%    mutate(data=\"Trial\", extrap=\"Uncertain hazard\") rcon520 <- rmst(mod_con5, t=20, niter=ni) %>%    mutate(data=\"Trial\", extrap=\"Constant hazard\") rreg20 <- rmst(mod_seer, t=20, niter=ni) %>%    mutate(data=\"Trial,registry\",extrap=\"No extrapolation\") rreg40 <- rmst(mod_seer40, t=40, niter=ni)  %>%    mutate(data=\"Trial,registry\", extrap=\"Uncertain hazard\") rpop40 <- rmst(mod_seer_pop40, t=40, niter=ni) %>%   mutate(data=\"Trial,registry,population\",extrap=\"Uncertain excess hazard\") rcure40 <- rmst(mod_cure, t=40, niter=ni) %>%    mutate(data=\"Trial,registry,population\",           extrap=\"Mixture cure\") relic40 <- rmst(mod_cure_elic, t=40, niter=ni) %>%   mutate(data=\"Trial,registry,population\",           extrap=\"Elicited survival\")  modlabs <- c(\"(1a)\", \"(1a)\", \"(1b)\", \"(1c)\", \"(1d)\",\"(1e)\", \"(1f)\", \"(1g)\")  rs <- list(rcon, rcon20, rcon520, rreg20, rreg40, rpop40, rcure40, relic40) %>%   purrr::reduce(full_join, by = join_by(variable, t, median, `lower`, `upper`, data, extrap)) %>%   mutate(modlabs=modlabs,          rmst = sprintf(\"%s (%s, %s)\", round(median,2),                          round(`lower`,2), round(`upper`,2))) %>%   select(modlabs, data, extrap, t, rmst) knitr::kable(rs, col.names=c(\"Model\", \"Observed data\",\"Extrapolation assumptions\",                              \"Time horizon\",\"Restricted mean survival\")) write.table(rs, sep=\"  &  \", eol=\"\\\\\\\\\\n\", quote=FALSE, row.names = FALSE) ## modlabs  &  data  &  extrap  &  t  &  rmst\\\\ ## (1a)  &  Trial  &  No extrapolation  &  5  &  2.88 (2.63, 3.14)\\\\ ## (1a)  &  Trial  &  Uncertain hazard  &  20  &  5.11 (3.83, 7.28)\\\\ ## (1b)  &  Trial  &  Constant hazard  &  20  &  5.12 (4, 6.68)\\\\ ## (1c)  &  Trial,registry  &  No extrapolation  &  20  &  5.77 (5.03, 6.6)\\\\ ## (1d)  &  Trial,registry  &  Uncertain hazard  &  40  &  6.19 (5.33, 7.17)\\\\ ## (1e)  &  Trial,registry,population  &  Uncertain excess hazard  &  40  &  6.21 (5.38, 7.14)\\\\ ## (1f)  &  Trial,registry,population  &  Mixture cure  &  40  &  6.28 (5.39, 7.19)\\\\ ## (1g)  &  Trial,registry,population  &  Elicited survival  &  40  &  6.25 (5.36, 7.2)\\\\"},{"path":"https://chjackson.github.io/survextrap/articles/cetuximab.html","id":"waning-models-for-long-term-treatment-effects","dir":"Articles","previous_headings":"","what":"Waning models for long-term treatment effects","title":"Case study of using survextrap: cetuximab for head and neck cancer","text":"Finally, estimate effect treatment cetuximab long-term survival. extend two models external data (fitted earlier just control group) include treatment effect fit full trial data cetux. Firstly, model trial registry data, secondly, model three data sources (trial, registry population, “cure” assumption). proportional hazards model assumed, adequate describe short-term data. restricted mean survival control group, increase restricted mean survival given cetuximab, estimated various “treatment effect waning” assumptions. Essentially assume log hazard ratio “treated” group decreases linearly time period “treated” estimate “control” estimate. done mixing posteriors treated control estimates obtained model, case mod_full_pop (see methods vignette). calls rmst irmst modified include wane_period (vector defining start end waning period). also supply newdata newdata0, indicate respectively covariate values model correspond “treated” “control” groups. Table LaTeX format (paper). Using three data sources, waning, incremental restricted mean survival 20 years estimated 1.04 (-0.32, 2.52). reduces 0.99 (-0.3, 2.39) waning applied gradually 6 20 years, even 0.79 (-0.24, 1.86) effect assumed wane rapidly 5 6 years.","code":"mod_full_reg <- survextrap(Surv(years, d) ~ treat, data=cetux, mspline = mspline40,                            external=cetux_seer,                             chains=chains, iter=iter,                             prior_hscale=prior_hscale, prior_hsd = prior_hsd,                             prior_loghr = prior_loghr) mod_full_pop <- survextrap(Surv(years, d) ~ treat, data=cetux, mspline = mspline40,                            external=cetux_seer, backhaz=cetux_bh,                            chains=chains, iter=iter,                             prior_hscale=prior_hscale, prior_hsd = prior_hsd,                             prior_loghr = prior_loghr) nd <- data.frame(treat=c(\"Cetuximab\")) nd0 <- data.frame(treat=c(\"Control\")) ind <- data.frame(treat=c(\"Control\",\"Cetuximab\")) ind0 <- data.frame(treat=c(\"Control\",\"Control\")) tmax <- max(cetux$years)  ni <- 1000  ## 20 year absolute survival rmnwr <- rmst(mod_full_reg, t=20, niter=ni) %>% mutate(wane=0) rmnw <- rmst(mod_full_pop, t=20, niter=ni) %>% mutate(wane=0) rmw6 <- rmst(mod_full_pop, t=20, niter=ni, newdata=nd, newdata0=nd0,               wane_period = c(tmax, 6)) %>% mutate(wane=6) rmw20 <- rmst(mod_full_pop, t=20, niter=ni, newdata=nd, newdata0=nd0,                wane_period = c(tmax, 20)) %>% mutate(wane=20)  ## 20 year incremental survival for cetuximab irmnwr <- irmst(mod_full_reg, t=20, niter=ni) %>% mutate(wane=0) irmnw <- irmst(mod_full_pop, t=20, niter=ni) %>% mutate(wane=0) irmw6 <- irmst(mod_full_pop, t=20, niter=ni, newdata = ind, newdata0 = ind0,                 wane_period = c(tmax,6), wane_nt = 5) %>% mutate(wane=6) irmw20 <- irmst(mod_full_pop, t=20, niter=ni, newdata = ind, newdata0 = ind0,                  wane_period = c(tmax,20), wane_nt = 5) %>% mutate(wane=20)  rmd <- rbind(rmnwr, rmnw, rmw6, rmw20) %>%      filter(treat==\"Control\") %>%     rename(rm=\"median\",rmlower=\"lower\",rmupper=\"upper\") %>%     mutate(data=c(\"reg\",\"pop\"),            rmf = sprintf(\"%s (%s, %s)\", round(rm,2),                           round(rmlower,2), round(rmupper,2))) %>%     select(data, wane, rmf)  irmd <- rbind(irmnwr, irmnw, irmw6, irmw20) %>%      rename(irm=\"median\",irmlower=\"lower\",irmupper=\"upper\") %>%     mutate(data=c(\"reg\",\"pop\",\"pop\",\"pop\"),            irmf = sprintf(\"%s (%s, %s)\", round(irm,2),                            round(irmlower,2), round(irmupper,2))) %>%     select(data, wane, irmf) res_wane <- rmd %>%      select(-wane) %>%     right_join(irmd, by=c(\"data\")) %>%   mutate(model=c(\"(2d) No waning\",\"(2e) No waning\",                  \"(2e) 5 to 6 years\", \"(2e) 5 to 20 years\"),            looic = \"\",            rmf = tidyr::replace_na(rmf, \"\")) %>%     select(model, rmf, irmf, looic) knitr::kable(res_wane %>%              select(-looic) %>%              mutate(data = c(\"Trial,registry\",rep(\"Trial,registry,population\",3))) %>%              relocate(data),              col.names=c(\"Data\",\"Model\",\"Restricted mean survival\",                          \"Increase in restricted mean survival\")) write.table(res_wane, eol=\"\\\\\\\\\\n\", sep=\"  &  \", row.names = FALSE, quote=FALSE) ## model  &  rmf  &  irmf  &  looic\\\\ ## (2d) No waning  &  5.83 (5.06, 6.58)  &  1.22 (-0.31, 2.91)  &  \\\\ ## (2e) No waning  &  5.88 (5.15, 6.72)  &  1.04 (-0.32, 2.52)  &  \\\\ ## (2e) 5 to 6 years  &  5.88 (5.15, 6.72)  &  0.79 (-0.24, 1.86)  &  \\\\ ## (2e) 5 to 20 years  &  5.88 (5.15, 6.72)  &  0.99 (-0.3, 2.39)  &  \\\\"},{"path":"https://chjackson.github.io/survextrap/articles/examples.html","id":"examples","dir":"Articles","previous_headings":"","what":"Examples","title":"Examples of using survextrap","text":"examples, use dataset trial chemotherapy colon cancer, provided colon survival package, outcome recurrence-free survival (etype==1), artificially censored 3 years, restricted random 20% subset. provided colons survextrap package convenience.","code":"library(survextrap) library(ggplot2) library(dplyr) survminer::ggsurvplot(survfit(Surv(years, status) ~ 1, data=colons), data=colons)"},{"path":"https://chjackson.github.io/survextrap/articles/examples.html","id":"simplest-model-no-external-data","dir":"Articles","previous_headings":"Examples","what":"Simplest model: no external data","title":"Examples of using survextrap","text":"following simplest, default model package fitted short-term trial data alone. external data supplied. three years (maximum follow time short term data) model assumes hazard stays constant. plot shows posterior median 95% credible intervals survival hazard functions. spline adapts give practically perfect fit short-term data - note Kaplan-Meier curve obscured fitted posterior median. Although model assumes extrapolated hazard constant, still wide uncertainty interval around constant value. might thought plausible.  spline knots shown blue lines. allow possibility hazard changes beyond three years placing spline knots beyond point. mspline argument used control spline. create additional knot outside data, 4 years.  increases amount uncertainty extrapolated survival hazard. extrapolations likely sensitive choice knots placed outside data. sensible guide place upper knot latest time interested modelling. Beyond time, either think hazard change, changes hazard matter purpose model. priors chosen give low probability hazard varies outside range thought reasonable, e.g. terms orders magnitude. package provide nice way convert beliefs kind priors. note necessary extrapolate way, using knots default priors, substantive information long term hazard! many practical situations extrapolation time--event models, information. human survival, least know people tend live much longer 100 years. usually data national agencies mortality general populations. idea package make external information explicit possible - ideally form data.","code":"nd_mod <- survextrap(Surv(years, status) ~ 1, data=colons, chains=1) plot(nd_mod, show_knots=TRUE, tmax=5) nd_mod2 <- survextrap(Surv(years, status) ~ 1, data=colons, chains=1,                        mspline = list(add_knots=4)) plot(nd_mod2, tmax=5)"},{"path":"https://chjackson.github.io/survextrap/articles/examples.html","id":"tuning","dir":"Articles","previous_headings":"Examples > Simplest model: no external data","what":"Note on model tuning","title":"Examples of using survextrap","text":"survextrap function various options can used fine-tune basic model explained Methods vignette. options include number spline knots, distribution coefficients (\\(p_i\\)), prior placed amount smoothness curve \\(\\sigma\\). usually necessary tune obtain model gives survival curve fits observed data well, hence estimate restricted mean survival time well. However may optimal every case. See, example, cetuximab case study, tighter prior placed \\(\\sigma\\), fewer knots used. Cross-validation can used determine whether tuning gives overall improvement fit observed data (see “Model comparison” ). Work ongoing give empirical evidence, based simulation studies, sensible default choice . One particularly promising recent development package choice “random walk” prior smooth spline basis coefficients. gives smoother, realistic-looking hazard curve one based default (“exchangeable”) prior.","code":"nd_modr <- survextrap(Surv(years, status) ~ 1, data=colons, chains=1,                        smooth_model = \"random_walk\",                       mspline = list(add_knots=4)) plot(nd_modr, tmax=5)"},{"path":"https://chjackson.github.io/survextrap/articles/examples.html","id":"convergence","dir":"Articles","previous_headings":"Examples > Simplest model: no external data","what":"Note on computation settings","title":"Examples of using survextrap","text":"example models vignette specified using computational approximations allow models fitted quickly, cost inaccuracy. done vignettes build quickly. Specifically: chains=1 set examples . defines number chains used MCMC method estimate model. option can left practice - case, four MCMC chains used, default setting rstan engine package uses, reliable practice. number iterations per chain can also set iter argument, among settings, see stan(). Likewise, models fitted using fit.method=\"opt\". uses approximation posterior. OK producing point estimates parameters (posterior mode used - note likely differ mean median) uncertainty roughly approximated. useful quick checks model development. using MCMC, make sure check diagnostics ensure fit converged - values rhat summary output (e.g. ) 1.05 parameter (see technical details).","code":"head(summary(nd_mod)) ## # A tibble: 6 × 8 ##   variable basis_num  median    lower   upper      sd  rhat ess_bulk ##   <chr>        <dbl>   <dbl>    <dbl>   <dbl>   <dbl> <dbl>    <dbl> ## 1 alpha           NA -0.553  -0.784   -0.339  0.115    1.01    1063. ## 2 coefs            1  0.0249  0.00969  0.0365 0.00673  1.00     445. ## 3 coefs            2  0.0260  0.00201  0.0659 0.0172   1.00     399. ## 4 coefs            3  0.0775  0.0226   0.174  0.0397   1.00     743. ## 5 coefs            4  0.0998  0.0276   0.225  0.0501   1.00     893. ## 6 coefs            5  0.0963  0.0267   0.204  0.0467   1.00     802."},{"path":"https://chjackson.github.io/survextrap/articles/examples.html","id":"divergences","dir":"Articles","previous_headings":"Examples > Simplest model: no external data > Note on computation settings","what":"Divergent transitions","title":"Examples of using survextrap","text":"using MCMC, may warning produced Stan divergent transitions warmup. limitation sampling algorithm, can happen posterior distribution awkward sample . See Stan documentation technical details. one two divergent transitions, message probably safe ignore, case results examined ensure make sense. lots divergent transitions, safer simplify model, e.g. using stronger priors fewer spline knots.","code":""},{"path":"https://chjackson.github.io/survextrap/articles/examples.html","id":"restricted-mean-survival","dir":"Articles","previous_headings":"Examples","what":"Restricted mean survival","title":"Examples of using survextrap","text":"function rmst calculates restricted mean survival time (RMST) fitted model. Uncertainty expressed using MCMC sample model parameters, calculating mean (RMST) draw, produces sample posterior distribution. posterior median credible intervals computed summarising sample. particular combinations parameter values, mean model nd_mod calculated compute restricted mean survival time \\(RMST(t)\\) three alternative time limits \\(t\\): 3, 10 1000 years. upper 95% credible limit \\(RMST(1000)\\) large. Note: niter controls many iterations MCMC sample (previously drawn survextrap) used summarise distribution. artificially set small number example runs faster. OK quick checks, practice “final results”, check enough iterations get summaries amount precision want, usually 1000 . really believe mean survival population can large. evidence fitted model unrealistic, included external information bound estimates mean within plausible values. can done external data. Note also mean function can used get mean survival time infinite time horizon. practice, sometimes numerically unstable, resulting error message divergent integral. suggest substantial posterior probability mean infinite. often consequence enough data inform survival infinite horizon.","code":"rmst(nd_mod2, t = c(3,10,1000), niter=100) ## # A tibble: 3 × 5 ##   variable     t median lower upper ##   <chr>    <dbl>  <dbl> <dbl> <dbl> ## 1 rmst         3   2.21  2.09  2.33 ## 2 rmst        10   5.23  4.34  6.09 ## 3 rmst      1000   9.01  5.13 84.2"},{"path":"https://chjackson.github.io/survextrap/articles/examples.html","id":"custom-posterior-summaries","dir":"Articles","previous_headings":"Examples","what":"Custom posterior summaries","title":"Examples of using survextrap","text":"summ_fns argument can used specify custom summaries posterior distribution quantities survextrap models. example, use mean, median interquartile range, rather median 95% credible interval:","code":"rmst(nd_mod2, t = c(3,10,1000),      summ_fns = list(mean=mean, median=median,                      ~quantile(.x, c(0.25, 0.75))),      niter=50) ## # A tibble: 3 × 6 ##   variable     t  mean median `25%` `75%` ##   <chr>    <dbl> <dbl>  <dbl> <dbl> <dbl> ## 1 rmst         3  2.21   2.20  2.16  2.27 ## 2 rmst        10  5.16   5.10  4.79  5.56 ## 3 rmst      1000 13.3    8.12  6.76 13.3"},{"path":"https://chjackson.github.io/survextrap/articles/examples.html","id":"extrapolation-using-long-term-population-data","dir":"Articles","previous_headings":"Examples","what":"Extrapolation using long term population data","title":"Examples of using survextrap","text":"Suppose judge 5 years, survival patients general population, data describing annual survival rates population similar one, perhaps matching national statistics registry data age sex. construct something like (though fake data shown ). passed external argument survextrap. Extra knots added 10 25 years, allow possibility hazard function change shape times covered external data. external data coarser individual data, impossible identify complex hazard variations , point using couple extra knots. concern knot choice may influence results, sensitivity analysis advised.  Including external data gives confident extrapolation. mean finite. RMST converges mean, supposed .","code":"extdat <- data.frame(start = c(5, 10, 15, 20),                       stop =  c(10, 15, 20, 25),                       n = c(100, 100, 100, 100),                       r = c(50, 40, 30, 20)) nde_mod <- survextrap(Surv(years, status) ~ 1, data=colons,                        chains=1, external = extdat,                       mspline = list(add_knots=c(4, 10, 25))) plot(nde_mod) mean(nde_mod, niter=100) ## # A tibble: 1 × 4 ##   variable median lower upper ##   <chr>     <dbl> <dbl> <dbl> ## 1 mean       5.99  5.13  6.75 rmst(nde_mod, c(3, 10, 1000), niter=100) ## # A tibble: 3 × 5 ##   variable     t median lower upper ##   <chr>    <dbl>  <dbl> <dbl> <dbl> ## 1 rmst         3   2.20  2.07  2.33 ## 2 rmst        10   4.96  4.34  5.45 ## 3 rmst      1000   5.99  5.12  6.75"},{"path":"https://chjackson.github.io/survextrap/articles/examples.html","id":"modelling-differences-between-the-trial-and-external-data","dir":"Articles","previous_headings":"Examples > Extrapolation using long term population data","what":"Modelling differences between the trial and external data","title":"Examples of using survextrap","text":"external data need identical population one arms trial data. can assume datasets related model, can perform extrapolations assumptions model. simple example hazards assumed proportional trial external data. implement , define binary factor covariate called dataset identify two datasets. proportional hazards model defined including covariate right hand side model formula survextrap command. (See Covariates models covariates). effect covariate describes hazard ratio external data compared trial data - artificial example, difference datasets discernible. Different predictions now available trial external population, decision-making contexts need consider relevant. covariates observed datasets, might added model explain differences datasets. Though caution required always extrapolating outside data, different populations well time. extrapolate need assume parameter estimates valid outside data estimated .","code":"levs <- c(\"trial\", \"external\") colons$dataset <- factor(\"trial\", level=levs) extdat$dataset <- factor(\"external\", level=levs) ndec_mod <- survextrap(Surv(years, status) ~ dataset, data=colons,                        chains=1, external = extdat,                       mspline = list(add_knots=c(4, 10, 25))) summary(ndec_mod) %>% filter(variable==\"hr\") ## # A tibble: 1 × 9 ##   variable basis_num term            median lower upper    sd  rhat ess_bulk ##   <chr>        <dbl> <chr>            <dbl> <dbl> <dbl> <dbl> <dbl>    <dbl> ## 1 hr              NA datasetexternal   1.04 0.274  6.79  2.18  1.00     324. rmst(ndec_mod, t=3, niter=100) ## # A tibble: 2 × 6 ##   variable dataset      t median lower upper ##   <chr>    <chr>    <dbl>  <dbl> <dbl> <dbl> ## 1 rmst     trial        3   2.20  2.07  2.34 ## 2 rmst     external     3   2.01  1.04  2.80"},{"path":"https://chjackson.github.io/survextrap/articles/examples.html","id":"expert-elicitation-on-the-long-term","dir":"Articles","previous_headings":"Examples","what":"Expert elicitation on the long term","title":"Examples of using survextrap","text":"Information long term survival elicited experts. use information model, also elicit expert’s uncertainty. example, ask expert consider set people survived 10 years. many expect survive 5 years? kind formal elicitation process, supply best guess (median) 30%, 95% credible interval 10% 50%. Using standard techniques elicitation (SHELF) can interpret \\(Beta(6.6, 15.0)\\) prior distribution survival probability. can interpret posterior observed \\(y=6\\) survivors \\(n=20\\) people (recalling posterior \\(Binomial(y, n)\\) combined vague \\(Beta(0.5, 0.5)\\) prior \\(Beta(y+0.5, n-y+0.5)\\), rounding \\(n\\) \\(y\\) whole numbers). expert’s judgement equivalent information external dataset form: can use survextrap model follows:  still substantial uncertainty mean, even level information, comparing second model (nd_mod2), better information . investigation role knot placement (blue lines figure) might wise - particularly one 15 years. approach might extended include elicited values multiple time points, considering multiple experts. case elicited information can converted straightforwardly aggregate table use survextrap.","code":"SHELF::fitdist(vals=c(0.1, 0.3, 0.5), probs=c(0.025, 0.5, 0.975),                lower=0, upper=1)$Beta ##     shape1   shape2 ## 1 6.588104 14.96673 extdat <- data.frame(start = c(10), stop =  c(15),                       n = c(20), r = c(6)) nde_mod <- survextrap(Surv(years, status) ~ 1, data=colons,                       chains=1, external = extdat) plot(nde_mod) mean(nde_mod, niter = 100) ## # A tibble: 1 × 4 ##   variable median lower upper ##   <chr>     <dbl> <dbl> <dbl> ## 1 mean       5.02  4.19  7.36"},{"path":"https://chjackson.github.io/survextrap/articles/examples.html","id":"covariates","dir":"Articles","previous_headings":"Examples","what":"Covariates","title":"Examples of using survextrap","text":"survextrap uses proportional hazards model represent covariates default. example , model survival treatment group rx, factor three levels. First fit standard Cox model: fit survextrap model extract log hazard ratios. agree Cox model - expected, using proportional hazards model flexible baseline hazard function. posterior median survival curves (thick lines) agree subgroup-specific Kaplan-Meier estimates (thin lines).  number covariates, categorical continuous, can included. can also covariates external data. covariates included model formula, external dataset supplied, must specify covariate values row external dataset. (covariates factors, can supplied character vectors external, values taken factor levels internal data [todo: probably isn’t necessary restriction]) example, external data might assumed survival control group trial (corresponding value \"Obs\" variable rx).","code":"coxph(Surv(years, status) ~ rx, data=colons) ## Call: ## coxph(formula = Surv(years, status) ~ rx, data = colons) ##  ##              coef exp(coef) se(coef)      z      p ## rxLev     -0.3919    0.6758   0.2597 -1.509 0.1313 ## rxLev+5FU -0.6740    0.5097   0.2800 -2.407 0.0161 ##  ## Likelihood ratio test=6.39  on 2 df, p=0.04088 ## n= 191, number of events= 82 rxph_mod <- survextrap(Surv(years, status) ~ rx, data=colons, chains=1, refresh=0) summary(rxph_mod) |>     filter(variable==\"loghr\") ## # A tibble: 2 × 9 ##   variable basis_num term      median  lower   upper    sd  rhat ess_bulk ##   <chr>        <dbl> <chr>      <dbl>  <dbl>   <dbl> <dbl> <dbl>    <dbl> ## 1 loghr           NA rxLev     -0.397 -0.902  0.0937 0.251  1.00     734. ## 2 loghr           NA rxLev+5FU -0.681 -1.29  -0.134  0.292  1.00     663. plot(rxph_mod, niter=100) extdat <- data.frame(start = c(5, 10), stop =  c(10, 15),                       n = c(100, 100), r = c(50, 40),                       rx = \"Obs\") rxphe_mod <- survextrap(Surv(years, status) ~ rx, data=colons,                        chains=1, external = extdat, refresh=0) rmst(rxphe_mod, niter=100, t=20) ## # A tibble: 3 × 6 ##   variable rx          t median lower upper ##   <chr>    <chr>   <dbl>  <dbl> <dbl> <dbl> ## 1 rmst     Obs        20   4.85  4.07  5.78 ## 2 rmst     Lev        20   6.68  4.47  9.33 ## 3 rmst     Lev+5FU    20   8.54  6.22 11.3 plot(rxphe_mod, niter=100, tmax=5) plot_hazard(rxphe_mod, niter=100, tmax=20)"},{"path":"https://chjackson.github.io/survextrap/articles/examples.html","id":"covariate-specific-outputs","dir":"Articles","previous_headings":"Examples > Covariates","what":"Covariate-specific outputs","title":"Examples of using survextrap","text":"fitting model includes covariates, present covariate-specific outputs, newdata data frame supplied output functions rmst(), survival() hazard(). contains one row different covariate value (combination covariate values) outputs required, case, Observation Lev+5FU treatment groups.","code":"nd <- data.frame(rx = c(\"Obs\",\"Lev+5FU\")) survival(rxph_mod, t=c(5,10), newdata=nd) ## # A tibble: 4 × 5 ##   rx          t median  lower upper ##   <chr>   <dbl>  <dbl>  <dbl> <dbl> ## 1 Obs         5  0.354 0.223  0.489 ## 2 Obs        10  0.180 0.0598 0.375 ## 3 Lev+5FU     5  0.590 0.430  0.746 ## 4 Lev+5FU    10  0.419 0.210  0.652"},{"path":"https://chjackson.github.io/survextrap/articles/examples.html","id":"standardised-outputs","dir":"Articles","previous_headings":"Examples > Covariates","what":"Standardised outputs","title":"Examples of using survextrap","text":"models covariates, “standardised” outputs defined averaging, marginalising, covariate values reference population, rather conditional given covariate value. compute , first construct data frame one row member reference population, columns covariate values. tell output function average outputs reference population, applying standardise_to function population, supplying result newdata argument. reference population defined consists 1 person Observation treatment group 1 person Lev+5FU group. expected, marginal 5 10 year survival probabilities population half way treatment-specific estimates survival probabilities.","code":"ref_pop <- data.frame(rx = c(\"Obs\",\"Lev+5FU\")) survival(rxph_mod, t = c(5,10), newdata = standardise_to(ref_pop)) ## # A tibble: 2 × 4 ##       t median  lower upper ##   <dbl>  <dbl>  <dbl> <dbl> ## 1     5  0.458 0.247  0.710 ## 2    10  0.291 0.0751 0.616"},{"path":"https://chjackson.github.io/survextrap/articles/examples.html","id":"notes-on-computation-of-standardised-outputs","dir":"Articles","previous_headings":"Examples > Covariates > Standardised outputs","what":"Notes on computation of standardised outputs","title":"Examples of using survextrap","text":"distribution covariate values reference population matters, population size. example, result obtained reference population \\(n\\) people every treatment group, \\(n\\). reference population larger, computation slower. default procedure involves concatenating multiple MCMC samples \\(R\\) parameter values one: \\[ (\\theta^{(1)} | \\mathbf{x}_1,...,\\theta^{(R)}|\\mathbf{x}_1), ..., (\\theta^{(1)} | \\mathbf{x}_M,...,\\theta^{(R)}|\\mathbf{x}_M) \\] \\(R\\) number MCMC samples obtained original survextrap fit (4000 current default number chains iterations used rstan), \\(M\\) size reference population, \\(\\mathbf{x}_j\\) vector covariate values \\(j\\)th member reference population. output function evaluated element concatenated sample, obtain sample size \\(R \\times M\\) posterior standardised output. sample large, may computationally intensive, particularly output function slow evaluate (e.g. RMST, uses numerical integration). example , one covariate, categorical, just wanted 50/50 balance two groups. Therefore reference population size 2 sufficient describe distribution covariates. complex situations, e.g. continuous covariates, might want larger reference population characterise distribution. save computation standardised outputs large reference populations, alternative computational method available. works drawing random covariate value \\(\\mathbf{x}_r\\) reference population MCMC iteration \\(r\\), evaluating output function corresponding parameter value \\(\\theta^{(r)} | \\mathbf{x}_r\\). resulting sample outputs sample size \\(R\\) posterior standardised output: \\[ (\\theta^{(1)} | \\mathbf{x}_1,...,\\theta^{(R)}|\\mathbf{x}_R) \\] alternative method invoked setting random=TRUE argument standardise_to, e.g.  results dependent random number seed, care taken enough MCMC iterations run original survextrap call output stable required number significant figures.","code":"survival(rxph_mod, t = c(5,10), newdata = standardise_to(ref_pop, random=TRUE)) ## # A tibble: 2 × 4 ##       t median  lower upper ##   <dbl>  <dbl>  <dbl> <dbl> ## 1     5  0.458 0.247  0.710 ## 2    10  0.291 0.0751 0.616"},{"path":"https://chjackson.github.io/survextrap/articles/examples.html","id":"nonprop","dir":"Articles","previous_headings":"Examples > Covariates","what":"Non-proportional hazards model","title":"Examples of using survextrap","text":"flexible non-proportional hazards model described methods vignette can specified nonprop argument. nonprop=TRUE gives covariates main model formula non-proportional hazards. subset covariates can given non-proportional hazards passing different model formula nonprop argument.  Note non-constant separation posterior median hazard curves three treatment groups. example, sample size treatment group time period small, model probably overfitted. posterior median survival seems fit poorly Kaplan-Meier estimates regions, large uncertainty around estimates isn’t shown plots. non-proportional hazards model experimental. theory, can “tuned” changing number spline basis terms knot positions (mspline argument survextrap), changing prior parameter \\(\\sigma^{(np)}_s\\) controls smoothness departures proportional hazards (prior_sdnp argument). tested much practice. plot posterior hazard ratio time desired, might constructed extracting samples posterior hazard different covariate values using hazard(..., sample=TRUE), converting samples hazard ratio, summarising plotting. functions hazard_ratio() plot_hazard_ratio() can used calculate plot ratio hazards two covariate values, function time. covariate values supplied data frame two rows - covariates model included (currently facility standardised effect estimation).  example, credible interval Lev+5FU / Lev hazard ratio wide, suggest hazard ratio time-varying. model may overfitted around time 0.5 1 - fewer knots may preferable model intended description hazard trajectories.","code":"rxnph_mod <- survextrap(Surv(years, status) ~ rx, data=colons, nonprop=TRUE, chains=1) plot(rxnph_mod) nd <- data.frame(rx = c(\"Lev+5FU\",\"Lev\")) plot_hazard_ratio(rxnph_mod, newdata=nd) +    coord_cartesian(ylim=c(0,5))"},{"path":"https://chjackson.github.io/survextrap/articles/examples.html","id":"treatment-effect-waning-models","dir":"Articles","previous_headings":"Examples > Covariates","what":"Treatment effect waning models","title":"Examples of using survextrap","text":"described vignette.","code":""},{"path":"https://chjackson.github.io/survextrap/articles/examples.html","id":"loocv","dir":"Articles","previous_headings":"Examples","what":"Model comparison","title":"Examples of using survextrap","text":"leave-one-cross-validation method loo package automatically implemented every model fitted survextrap, unless survextrap(..., loo=FALSE) used. cross-validation results returned loo loo_external component fitted model object, describing fit model individual external data respectively. external data, “leave one ” refers leaving single individual’s outcome aggregate totals. See loo vignette information interpret . Roughly, lower values looic statistic indicate models better predictive ability. demonstrated comparing proportional hazards model non-proportional hazards model. looic lower proportional hazards model, suggesting non-proportional hazards model worse prediction. likely excessively complicated data. warning message \"Pareto k diagnostic values high\" appears calling survextrap, produced loo package. fitted model still valid, cross-validation statistics may . See loo vignette references explanation. happens non-proportional hazards model - cross-validation failed 2 191 observations data.","code":"rxph_mod$loo ##  ## Computed from 1000 by 191 log-likelihood matrix. ##  ##          Estimate   SE ## elpd_loo   -212.4 10.0 ## p_loo         8.1  0.5 ## looic       424.7 20.1 ## ------ ## MCSE of elpd_loo is 0.1. ## MCSE and ESS estimates assume MCMC draws (r_eff in [0.7, 1.2]). ##  ## All Pareto k estimates are good (k < 0.67). ## See help('pareto-k-diagnostic') for details. rxnph_mod$loo ##  ## Computed from 1000 by 191 log-likelihood matrix. ##  ##          Estimate   SE ## elpd_loo   -232.7 11.5 ## p_loo        29.1  2.4 ## looic       465.3 23.0 ## ------ ## MCSE of elpd_loo is NA. ## MCSE and ESS estimates assume MCMC draws (r_eff in [0.7, 1.4]). ##  ## Pareto k diagnostic values: ##                           Count Pct.    Min. ESS ## (-Inf, 0.67]   (good)     190   99.5%   360      ##    (0.67, 1]   (bad)        1    0.5%   <NA>     ##     (1, Inf)   (very bad)   0    0.0%   <NA>     ## See help('pareto-k-diagnostic') for details."},{"path":"https://chjackson.github.io/survextrap/articles/examples.html","id":"cure_example","dir":"Articles","previous_headings":"Examples","what":"Cure models","title":"Examples of using survextrap","text":"package provides simulated dataset curedata obvious cure fraction. fit cure models described methods vignette. probability cure x=0 0.5, x=1 0.622 (log odds ratio 0.5). uncured fraction follows Weibull(1.5, 1.2) survival distribution.    Covariates cure fraction can supplied putting formula cure argument. modelled using logistic regression. summary, pcure probability cure value 0 covariate x.","code":"plot(survfit(Surv(t, status) ~ 1, data=curedata)) noncure_mod <- survextrap(Surv(t, status) ~ 1, data=curedata, fit_method = \"opt\") plot_survival(noncure_mod,tmax=5) cure_mod <- survextrap(Surv(t, status) ~ 1, data=curedata, chains=1, cure=TRUE, iter=1000) plot(cure_mod, tmax=10, niter=20) curec_mod <- survextrap(Surv(t, status) ~ 1, data=curedata, cure=~x, fit_method=\"opt\") summary(curec_mod) %>%      filter(variable %in% c(\"pcure\", \"logor_cure\", \"or_cure\")) ## # A tibble: 3 × 10 ##   variable   basis_num term   mode median lower upper     sd  rhat ess_bulk ##   <chr>          <dbl> <chr> <dbl>  <dbl> <dbl> <dbl>  <dbl> <dbl>    <dbl> ## 1 pcure             NA NA    0.481  0.481 0.388 0.577 0.0490  1.00    1938. ## 2 logor_cure        NA x     0.778  0.778 0.214 1.33  0.289   1.00    1907. ## 3 or_cure           NA x     2.18   2.18  1.24  3.80  0.665   1.00    1907."},{"path":"https://chjackson.github.io/survextrap/articles/examples.html","id":"relsurv_examples","dir":"Articles","previous_headings":"Examples","what":"Additive hazards / relative survival models","title":"Examples of using survextrap","text":"implement “additive hazards” (“relative survival”) model (see methods vignette), background hazard can supplied alongside data. can done two ways - note meaning predictions model depends specifications used.","code":""},{"path":"https://chjackson.github.io/survextrap/articles/examples.html","id":"relsurv_example2","dir":"Articles","previous_headings":"Examples > Additive hazards / relative survival models","what":"Background hazard defined at all times","title":"Examples of using survextrap","text":"recommended way build data frame defines value background hazard times. hazard assumed piecewise-constant function. data frame columns \"hazard\" \"time\", row defines value hazard current time next time. first value \"time\" 0, final row data defines hazard times greater last time. example: supplied survextrap, defines full model overall hazard time. recurring example model, suppose external data background hazard use extrapolate survival 15 years. represented data frame bh defined . “cause-specific” hazard represents death colon cancer, “background” hazard represents deaths causes. suppose colon cancer deaths dominate shorter term covered individual data (0-3 years), risk death causes increases gradually . fit one model mod excludes information, another model includes . posterior medians survival hazard functions mod_bh overlaid posterior distributions mod. fitted survival hazard short term agrees models, survival worse long term increase background hazard times 3, 5 10 accounted .   Note kind relative survival model can also used together cure model. cure backhaz specified, cure model assumed apply cause-specific hazard. define model cause-specific hazard approaches zero, hence overall hazard increasingly dominated background causes death, time increases.","code":"bh <- data.frame(time=c(0, 3, 5, 10),                   hazard=c(0.01, 0.05, 0.1, 0.2)) mod <- survextrap(Surv(years, status) ~ 1, data=colons, fit_method=\"opt\") mod_bh <- survextrap(Surv(years, status) ~ 1, data=colons, fit_method=\"opt\", backhaz=bh) plot_survival(mod, tmax=15, niter=20) +    geom_line(data=survival(mod_bh, tmax=15, niter=20), aes(y=median, x=t), col=\"red\", lwd=1.2) plot_hazard(mod, tmax=15, niter=20) +    geom_line(data=hazard(mod_bh, tmax=15, niter=20), aes(y=median, x=t), col=\"red\", lwd=1.2)"},{"path":"https://chjackson.github.io/survextrap/articles/examples.html","id":"stratified-background-hazards","dir":"Articles","previous_headings":"Examples > Additive hazards / relative survival models","what":"Stratified background hazards","title":"Examples of using survextrap","text":"Commonly, population mortality statistics available age sex. stratifying variables recorded survival data (either trial external data) survextrap allows strata matched appropriate stratified background hazards. simple example shown . Suppose following background hazard data available, people aged 70 1.2 times mortality rate -70s. year age recorded trial data colons, convert /70 binary age group. run survextrap stratified background hazard, indicate names stratifying variables backhaz_strata argument. variables must exist data backhaz (external provided). Every row data must row backhaz matching stratum value. (Note can multiple stratifying variables, case specify, example backhaz_strata = c(\"agegroup\",\"sex\")). present predictions model stratified background hazard (e.g. RMST, hazard, survival), newdata supplied indicate strata present results , manner models covariates. fitted hazard function reflects increased long-term risk -70s.","code":"bh_strata <- data.frame(time = rep(bh$time, 2),                         hazard = c(bh$hazard, bh$hazard*1.2),                         agegroup = rep(c(\"Under 70\", \"Over 70\"),each=4)) colons$agegroup <- cut(colons$age, breaks=c(0,70,Inf),                         right=FALSE, labels=c(\"Under 70\",\"Over 70\")) bh_strata ##   time hazard agegroup ## 1    0  0.010 Under 70 ## 2    3  0.050 Under 70 ## 3    5  0.100 Under 70 ## 4   10  0.200 Under 70 ## 5    0  0.012  Over 70 ## 6    3  0.060  Over 70 ## 7    5  0.120  Over 70 ## 8   10  0.240  Over 70 mod_bhs <- survextrap(Surv(years, status) ~ 1, data=colons, fit_method=\"opt\",                       backhaz=bh_strata, backhaz_strata=\"agegroup\") nd <- data.frame(agegroup = c(\"Over 70\", \"Under 70\")) plot_hazard(mod, tmax=15, ci=FALSE) +    geom_line(data = hazard(mod_bhs, newdata=nd, tmax=15, niter=300),              aes(y=median, x=t, col=agegroup), lwd=1.2) +    ylim(0,0.5)"},{"path":"https://chjackson.github.io/survextrap/articles/examples.html","id":"relsurv_example1","dir":"Articles","previous_headings":"Examples > Additive hazards / relative survival models","what":"Background hazard only defined at the event times","title":"Examples of using survextrap","text":"alternative approach supply background hazard extra column alongside data. name column supplied (unquoted) backhaz argument survextrap. relies fewer assumptions background hazard, since hazard event times used, background hazard outside time spanned individual data unspecified. background hazard event time defined extra column \"bh\" individual data. previous specification, parameter estimates fitted model describe excess cause-specific hazard study population. However, predictions model (e.g. fitted survival, hazard mean survival) different meaning . Previously described overall hazard - able defined hazard times. now describe excess hazard study population - predict overall survival general , since define background hazard times. example , excess hazard relative hazard model (constant background 0.05) shown blue fitted overall hazard model background adjustment. expected, excess hazard around 0.05 less overall hazard.","code":"colonsb <- colons colonsb$bh <- rep(0.05, nrow(colons)) modb <- survextrap(Surv(years, status) ~ 1, data=colonsb, backhaz=\"bh\", chains=1) mod <- survextrap(Surv(years, status) ~ 1, data=colonsb, chains=1) plot_hazard(mod) +      geom_line(data=hazard(modb), col=\"blue\")"},{"path":"https://chjackson.github.io/survextrap/articles/examples.html","id":"comparison-with-other-ways-of-supplying-external-data-in-survextrap","dir":"Articles","previous_headings":"Examples > Additive hazards / relative survival models","what":"Comparison with other ways of supplying external data in survextrap","title":"Examples of using survextrap","text":"alternative approach modelling study population background population survextrap estimate background hazard external aggregate data supplied external argument. covariate included takes different value external data study data. default, hazards assumed proportional study population external population. Proportional hazards restrictive assumption, however. flexible nonproportional hazards model might preferable. advantage alternative approach account uncertainty background hazard. background hazard uncertain, however, standard relative survival model adequate, excess hazard modelled flexibly. theory, another way account uncertainty backhaz place independent priors backhaz terms (without modelling backhaz parametric function time) though currently implemented.","code":""},{"path":"https://chjackson.github.io/survextrap/articles/methods.html","id":"m-splines","dir":"Articles","previous_headings":"","what":"M-splines","title":"Details of methods behind survextrap","text":"axis time split set regions defined knots. example , knots located integers 1 10, shown grid lines. region associated cubic polynomial function \\(b_i(t)\\), known basis function. M-spline basis functions defined positive. hazard \\(h(t)\\) time \\(t\\) defined weighted sum basis functions: \\[h(t) = \\eta \\sum_i p_i b_i(t)\\] weights \\(p_1,\\ldots,p_n\\) sum 1, \\(\\sum_i p_i = 1\\), known basis coefficients. scale parameter \\(\\eta\\) describes average level hazard.","code":""},{"path":"https://chjackson.github.io/survextrap/articles/methods.html","id":"standard-m-spline-basis","dir":"Articles","previous_headings":"M-splines","what":"Standard M-spline basis","title":"Details of methods behind survextrap","text":"standard basis, 10 knots implies 13 basis functions. Two basis functions peaks 0 upper knot, others peaks around knot, diminishing zero either side. See Ramsay exact definitions \\(b_i(t)\\). package provides functions (e.g. mspline_plotdata(), plot_mspline()) illustrate M-spline bases. actual computation basis done splines2 package.","code":"library(survextrap) library(ggplot2) mspline <- list(knots=1:10, degree=3, bsmooth=FALSE) p_const <- mspline_constant_coefs(mspline) p_naive <- rep(1/13, 13) haz_unif <- mspline_plotdata(knots=mspline$knots, scale=10, coefs = p_const, bsmooth = FALSE) plot_mspline(knots=mspline$knots, bsmooth=FALSE, scale=10, coefs = p_naive, tmax=11) +      geom_line(aes(x=time, y=haz), data=haz_unif, color=\"red\", lwd=1.5, inherit.aes = FALSE) +      annotate(geom=\"text\", x=2, y=1.5, color=\"red\", label=\"h(t): coefficients `p_const`\") +     annotate(geom=\"text\", x=1.5, y=2.5, color=\"blue\", label=\"h(t): coefficients `p_naive`\") +      xlab(\"Time t\") + ylab(\"Hazard rate\")"},{"path":"https://chjackson.github.io/survextrap/articles/methods.html","id":"smoothed-m-spline-basis","dir":"Articles","previous_headings":"M-splines","what":"Smoothed M-spline basis","title":"Details of methods behind survextrap","text":"alternative basis provided smoother upper knot (defined zero derivative second derivative point). selected setting bsmooth=TRUE various package functions defining M-splines.","code":"mspline <- list(knots=1:10, degree=3, bsmooth=TRUE) p_const <- mspline_constant_coefs(mspline) p_naive <- rep(1/11, 11) haz_unif <- mspline_plotdata(knots=mspline$knots, scale=1,                               coefs = p_const, bsmooth = TRUE) plot_mspline(knots=mspline$knots, bsmooth=TRUE,               scale=1, coefs = p_naive, tmax=11) +      geom_line(aes(x=time, y=haz), data=haz_unif,                color=\"red\", lwd=1.5, inherit.aes = FALSE) +      annotate(geom=\"text\", x=2, y=1.5, color=\"red\",               label=\"h(t): coefficients `p_const`\") +     annotate(geom=\"text\", x=1.5, y=2.5, color=\"blue\", label=\"h(t): coefficients `p_naive`\") +      xlab(\"Time t\") + ylab(\"Hazard rate\") + coord_cartesian(ylim=c(0,1))"},{"path":"https://chjackson.github.io/survextrap/articles/methods.html","id":"using-m-splines-to-represent-particular-hazard-shapes","dir":"Articles","previous_headings":"","what":"Using M-splines to represent particular hazard shapes","title":"Details of methods behind survextrap","text":"coefficients \\(p_i\\) define hazard changes time. knots equally spaced, \\(p_i\\) nearly proportional hazard \\(\\)th region, \\(p_i\\) equal, hazard nearly constant (red line p_equal figure). exactly constant influence regions either end space, whose polynomial functions skewed shape. produce practically constant hazard, can search numerically \\(p_i\\) minimise variance selection points \\(t\\) span area want model. search can done automatically package (red line p_const figure). Extrapolation? fully specify parametric time--event model, define hazard times greater time \\(t_{n}\\) highest knot, 10 example. model survextrap simply assumes hazard \\(t > t_{n}\\) constant, hazard \\(t_{n}\\). Therefore, want estimate survival period think hazard might constant, make sure highest spline knot \\(t_n\\) end period. Sidenote. Another way define hazard beyond last knot extrapolate final basis polynomials. splines2 compute basis outside boundary, implemented survextrap. Although lead smoothly extrapolated hazard, driven data just boundary, making opaque assumptions hazard changes boundary. idea behind package make assumptions explicit data mechanisms. Examples different kinds data knowledge given vignette(\"examples\"). Another arbitrary example M-spline curve, wiggly one :","code":"plot_mspline(knots=c(1, 3, 5, 7),      coefs=c(0.01, 0.5, 0.1, 2, 0.6), tmax=10, bsmooth=TRUE) +    coord_cartesian(ylim=c(0, 1.2))"},{"path":"https://chjackson.github.io/survextrap/articles/methods.html","id":"why-not-other-kinds-of-spline","dir":"Articles","previous_headings":"Using M-splines to represent particular hazard shapes","what":"Why not other kinds of spline?","title":"Details of methods behind survextrap","text":"Royston/Parmar model (e.g. flexsurv) uses natural cubic spline log cumulative hazard function. cumulative hazard defined non-decreasing function, spline constrained. constraint handled fitting model - spline coefficients imply decreasing cumulative hazard functions rejected. inefficient. worse problem Bayesian analysis model unclear specify priors - meaningful joint prior coefficients rule invalid combinations. also placed unrestricted spline, kind, log hazard. disadvantage cumulative hazard (required obtain likelihood censored data) evaluated numerical integration, slow. advantage putting M-spline hazard respects constraint hazard non-negative, can integrated analytically produce cumulative hazard. remaining disadvantage M-splines still rely choice knot locations. modelling data, knots generally chosen give equal amounts data knots. user just define number knots. approach generally works well practice. many different kinds arbitrarily-flexible model (fractional polynomials, particular kinds spline), designed fit data well. practice, may differ computational efficiency, easily can construct priors parameters. Priors influential places data. Though model can use simulation calibrate priors meaningful beliefs - see priors vignette examples. extrapolation, don’t want rely opaque nuances functional forms used specific model families. Splines least computationally conceptually simpler kinds flexible model families, e.g. Gaussian Dirichlet processes.","code":""},{"path":"https://chjackson.github.io/survextrap/articles/methods.html","id":"bayesspec","dir":"Articles","previous_headings":"","what":"Bayesian model specification","title":"Details of methods behind survextrap","text":"parameters model, \\(p_i\\) \\(\\eta\\), estimated data using Bayesian inference. flexibility fitted model determined two things. number \\(n\\) choice knots. determines maximum potential flexibility hazard function. prior distribution basis coefficients \\(p_i\\). plays role smoothing fitted hazard function. default approach taken survextrap choose large number knots basis functions (default \\(n=10\\)), intended accommodate reasonable situations, estimate extent smoothing needed data. data, fitted curve flexible necessary represent data. less data, fit influenced prior. smoother, Bayesian analogue common approach spline model selection based choosing \\(n\\) give model lowest AIC. also similar principle “penalised likelihood” methods implemented e.g. mgcv rstpm2 packages. priors package can chosen user (within given distribution families). See priors vignette examples advice . defaults package weakly informative, reasonable enough data, promote transparency analysis advised think priors might reasonable specify explicitly.","code":""},{"path":"https://chjackson.github.io/survextrap/articles/methods.html","id":"priorhaz","dir":"Articles","previous_headings":"","what":"Prior distribution for the hazard curve","title":"Details of methods behind survextrap","text":"log-normal prior used scale \\(\\eta\\). default package normal(0, 20) \\(\\log(\\eta)\\). prior basis coefficients \\(p_i\\), describe mass hazard region, specified multinomial logistic scale, since \\(\\sum_i p_i = 1\\). Define \\(log(p_i / p_1) = \\gamma_i\\), \\(\\gamma_1=0\\), \\(\\gamma_i = \\mu_i + \\sigma\\epsilon_i\\), \\(= 2, \\ldots, n\\). prior following parameters: Prior mean: \\(\\boldsymbol{\\mu} = (\\mu_2,\\ldots,\\mu_n)\\). default, determined special set \\(p_i\\) result constant hazard \\(h(t)\\). See mspline_constant_coefs() function package compute . Prior variability: \\(\\sigma\\) controls smoothness fitted hazard curve. \\(\\sigma=0\\), certain hazard function (scaled \\(\\eta\\)) one defined \\(\\boldsymbol{\\mu}\\). default constant hazard. Values \\(\\sigma\\) around 1 favour wiggly curves, fitted hazard curve driven mainly observed data. high values \\(\\sigma\\), hazard dominated random one \\(n\\) basis functions, typically useful practice. “random effect”: \\(\\epsilon_i\\), describes much \\(\\)th basis coefficient departs mean, compared basis coefficients. default “exchangeable” model, \\(\\epsilon_i \\sim Logistic(0,1)\\), \\(\\gamma_i\\) conditionally independent given \\(\\mu_i\\) \\(\\sigma\\). alternative, smoother model can specified relate basis coefficients, using random walk constrains \\(\\gamma_i\\) closer time similar . model generated \\(\\epsilon_1=0\\), \\(\\epsilon_i \\sim Logistic(\\epsilon_{-1}, w_i)\\) \\(\\geq 2\\). weight \\(w_i\\) accounts difference time periods described coefficients \\(\\) \\(-1\\). ensures less inclined allow hazard variations regions time knots closely-spaced, leading realistically smooth function weights excluded. exact definition \\(w_i\\) given Phillippo et al. 2024, following principles Li Cao 2022. Sidenote. multinomial logistic distribution similar Dirichlet distribution \\(p_i\\), slightly better behaved MCMC estimation done Stan. interpretation \\(\\sigma\\) completely intuitive, function package (prior_hsd()) choose prior \\(\\sigma\\) match judgements much hazard might vary time. plots show samples prior distribution hazard functions implied two choices joint prior distribution \\(\\eta\\) \\(p\\). , \\(\\eta\\) log normal(0,1), supports hazard rates 0.1 7, prior mean \\(p\\) special set centred around constant hazard. two samples differ choice prior variability. \\(\\sigma \\sim Gamma(2,40)\\) strongly favours low values \\(\\sigma\\), forces hazard nearly uniform, \\(\\sigma \\sim Gamma(2,1)\\) allows wide range wiggly shapes.  default, package estimates \\(\\sigma\\) part full Bayesian model (gamma(2,1) prior), uncertainty level smoothness accounted . sampling poor, alternative procedure might work - fit model two steps (“empirical Bayes”): “training” model fit perfomed, prior placed \\(\\sigma\\), maximum posteriori estimate \\(\\hat\\sigma\\) \\(\\sigma\\) determined. “final” model fitted, \\(\\sigma\\) fixed \\(\\hat\\sigma\\), giving “optimal” amount smoothness hazard \\(h(t)\\). default choices package seems -smooth cases. Though may matter hazard function -smoothed, purpose model estimate quantity average time (e.g. mean survival). sensible route resolving uncertainties might use cross-validation assess choose model specifications. package provides interface LOO-CV method Bayesian cross-validation - though note assesses fit individual-level data, using principle AIC.","code":"knots <- 1:10 mspline <- list(knots=knots) p_mean <- mspline_constant_coefs(mspline) set.seed(1) p1 <- plot_prior_hazard(knots=knots, tmax=max(knots),                          coefs_mean = p_mean,                         prior_hsd = p_gamma(2, 40),                               prior_hscale = p_normal(0, 1),                         nsim=10) +     ylim(0, 1) + ggtitle(bquote(sigma ~ \" ~ Gamma(2,40)\")) p2 <- plot_prior_hazard(knots=knots, tmax=max(knots),                          coefs_mean = p_mean,                         prior_hsd = p_gamma(2, 1),                                prior_hscale = p_normal(0, 1),                         nsim=10) +    ylim(0, 1) + ggtitle(bquote(sigma ~ \"~ Gamma(2,1)\")) gridExtra::grid.arrange(p1, p2, nrow=1)"},{"path":"https://chjackson.github.io/survextrap/articles/methods.html","id":"choice-of-knots-when-modelling-data","dir":"Articles","previous_headings":"","what":"Choice of knots when modelling data","title":"Details of methods behind survextrap","text":"default, internal knots placed quantiles vector comprising uncensored survival times individual level data, using 10 basis functions, smoothed version basis. Users can override defaults however, use number knots, placed position. particular, default place highest knot highest follow-time data. default overridden want extrapolate, think hazard might change. sensible guide place upper knot latest time interested modelling. Beyond time, either think hazard change, changes hazard matter whatever purpose model used . external data, advisable place knots manually cover time period data, time period want estimate survival , enable variations time hazard estimated data allow . examples given cetuximab case study. priors chosen give low probability hazard varies outside range thought reasonable, e.g. terms orders magnitude. See priors vignette detailed guidance . default number knots depend absolute amount data. small datasets, relying strongly prior smoothing. assess whether matters using LOO-CV cross-validation. external data, want choice knots outside data can defend allowing reasonable range shapes hazard function, prior observing data.","code":""},{"path":"https://chjackson.github.io/survextrap/articles/methods.html","id":"effect-of-covariates-on-the-hazard","dir":"Articles","previous_headings":"","what":"Effect of covariates on the hazard","title":"Details of methods behind survextrap","text":"survextrap, hazard may also depend vector covariates \\(\\boldsymbol{x}\\) well time \\(t\\), write hazard \\(h(t,\\boldsymbol{x})\\).","code":""},{"path":"https://chjackson.github.io/survextrap/articles/methods.html","id":"proportional-hazards-model","dir":"Articles","previous_headings":"Effect of covariates on the hazard","what":"Proportional hazards model","title":"Details of methods behind survextrap","text":"default model fitted proportional hazards model, scale parameter \\(\\eta(\\boldsymbol{x})\\) defined log-linear function vector covariates \\(\\boldsymbol{x}\\). \\[ \\eta(\\boldsymbol{x}) = \\exp(\\boldsymbol{\\beta}^T \\boldsymbol{x}) \\] model, ratio hazards \\(h(t,\\boldsymbol{x})\\) two different values \\(\\boldsymbol{x}\\) constant respect time \\(t\\). hazard ratios (.e. value 1 0 \\(\\boldsymbol{x}\\)) \\(exp(\\boldsymbol{\\beta})\\).","code":""},{"path":"https://chjackson.github.io/survextrap/articles/methods.html","id":"nonprop","dir":"Articles","previous_headings":"Effect of covariates on the hazard","what":"Flexible, non-proportional hazards model","title":"Details of methods behind survextrap","text":"alternative non-proportional hazards model available. achieved also modelling spline coefficients \\(p_i\\) functions covariates, addition log-linear model \\(\\eta\\). \\[log(p_i(\\boldsymbol{x}) / p_1(\\boldsymbol{x})) = \\gamma_i(\\boldsymbol{x)} \\] \\[ \\gamma_i(\\boldsymbol{x)} \\sim Logistic(\\mu_i + \\boldsymbol{\\delta}^T_i \\boldsymbol{x}, \\sigma) \\quad (=2,...,n), \\quad \\delta_1 = 0 \\] \\(s\\)th element vector \\(\\boldsymbol{\\delta}_i\\) describes departure proportional hazards \\(s\\mbox{th}\\) covariate region time associated \\(\\)th spline basis term. \\(\\boldsymbol{\\delta}_i = 0\\) model proportional hazards model. Non-proportional hazards can applied subset covariates needed, covariates. covariate \\(s\\), hierarchical model used non-proportionality effects \\(\\delta_{ks}\\). model “partially pools” effects different regions time \\(\\), either via exchangeable model, \\[ \\delta_{} \\sim Normal(0, \\tau_s^2) \\] normal second-order random walk model, like one used basis coefficients. non-proportional hazards model, ratio hazards \\(h(t,\\boldsymbol{x})\\) different covariate values \\(\\boldsymbol{x}\\) function time \\(t\\). Since \\(\\boldsymbol{\\delta}_i\\) may arbirtarily different region time \\(\\), hazard ratio can arbitrarily-flexible function time. amount shape non-proportionality estimated data, hierarchical model protects overfitting.","code":""},{"path":"https://chjackson.github.io/survextrap/articles/methods.html","id":"cure_methods","dir":"Articles","previous_headings":"","what":"Cure models","title":"Details of methods behind survextrap","text":"survextrap package implements mixture cure version M-spline model. mixture cure model, survival defined \\(S(t | p, \\boldsymbol{\\theta}) = p + (1-p)S_0(t|\\boldsymbol{\\theta})\\), \\(p\\) sometimes termed “cure probability”, \\(S_0(t|\\boldsymbol{\\theta})\\) parametric model parameters \\(\\boldsymbol{\\theta}\\), termed “uncured survival”. survextrap, \\(S_0\\) M-spline model. model can interpreted two different ways: mixture model, person hazard \\(h_1(t)=0\\) times \\(t\\) probability \\(p\\), hazard \\(h_0(t)\\) times probability \\(1-p\\). model everyone follows hazard function \\(h(t) = f(t)/S(t)\\), PDF \\(f(t) = (1-p)f_0(t)\\), \\(f_0(t)\\) PDF “uncured” parametric model. Hence \\(h(t) = f_0(t) / (p/(1-p) + S_0(t))\\), asymptotically decreases towards zero increasing \\(t\\) (long \\(p>0\\)). Since observe whether censored observations part “cured” subgroup, interpretations indistinguishable practice.","code":""},{"path":"https://chjackson.github.io/survextrap/articles/methods.html","id":"relsurv_methods","dir":"Articles","previous_headings":"","what":"Relative survival / additive hazards models","title":"Details of methods behind survextrap","text":"survextrap also implements model overall hazard assumed sum two components corresponding different causes death. usually termed “background” hazard \\(h_b(t)\\) “cause-specific” “excess” hazard \\(h_c(t)\\), \\(h(t) = h_b(t) + h_c(t)\\), : \\(h_b(t)\\) assumed known, piecewise-constant (step) function, provided user data frame gives background hazard series time periods. See examples. \\(h_c(t)\\) follows standard flexible parametric (M-spline) model used survextrap. known “relative survival” model, since additive model hazards implies multiplicative model survival: \\(S(t) = S_b(t)S_c(t)\\). kind model often used background hazard confidently known (national statistics general mortality) cause-specific hazard can inferred individual-level data. model used survextrap variant model Nelson et al give similar results. difference model survextrap Bayesian, different kind spline used.","code":""},{"path":"https://chjackson.github.io/survextrap/articles/methods.html","id":"combining-relative-survival-and-cure-models","dir":"Articles","previous_headings":"Relative survival / additive hazards models","what":"Combining relative survival and cure models","title":"Details of methods behind survextrap","text":"use cure model relative survival model together, \\(h_c(t)\\) defined mixture cure version M-spline model, background hazard data set supplied define \\(h_b(t)\\). allows overall hazard \\(h(t)\\) decrease asymptotically towards background hazard \\(h_b(t)\\), instead decreasing towards zero. model appropriate sure people disease eventually “cured”, alternatively, risk disease becomes negligible compared risk death causes, good information general mortality starts dominate. Therefore average survival estimated naturally combining short-term information disease-specific survival long-term data general mortality.","code":""},{"path":[]},{"path":"https://chjackson.github.io/survextrap/articles/methods.html","id":"principles","dir":"Articles","previous_headings":"Treatment effect waning models","what":"Principles","title":"Details of methods behind survextrap","text":"Suppose short-term data, say trial treatment control. trial data assumed representative treatment effect short term. may also long-term data gives information survival control group. However believe effect treatment continue. long term, suppose treatment effect “wanes” diminishes, time treatment control group similar risks. done survextrap? Essentially: fit survextrap (M-spline) model combines short-term data long-term data control group. model, estimate short-term treatment effect (e.g. proportional hazards model), long-term survival control group. However, want use model directly estimate long-term survival treatment group, relies assumption hazard ratio short term continues longer term. Instead, predict long-term survival treatment group assume treatment effect wanes time interval \\(t_{min}\\) \\(t_{max}\\), \\(t_{min}\\) follow-period trial.","code":""},{"path":"https://chjackson.github.io/survextrap/articles/methods.html","id":"waning-model-details","dir":"Articles","previous_headings":"Treatment effect waning models","what":"Waning model: details","title":"Details of methods behind survextrap","text":"Specifically, predict long-term hazard \\(h(t | x=1)\\) treated group, assume: time \\(t=0\\) \\(t=t_{min}\\), \\(h(t | x=1)\\) equal hazard treated group \\(x=1\\), estimated model. time \\(t=t_{max}\\), \\(h(t | x=1)\\) equal hazard control group \\(h(t | x=0)\\), estimated model. interval \\(t = t_{min}\\) \\(t = t_{max}\\), log hazard ratio \\(\\log(hr(t)) = \\log(h(t|x=1) | h(t|x=0))\\) diminishes linearly log hazard ratio \\(\\log(hr(t_{min}))\\) \\(t_{min}\\), estimated model, zero \\(t_{max}\\). , \\(\\log(hr(t)) = w \\log(hr(t_{min}))\\), \\(w = (t - t_{min}) / (t_{max} - t_{min})\\). Hence predicted hazard treated group \\(t\\) defined M-spline model \\(h(t|x=1) = h(t | x=0) hr(t)\\), \\(h(t|x=0)\\) comes fitted M-spline model. piecewise-constant approximation, fine grid, imposed hazard within waning period allow easy calculation cumulative hazard, survival related quantities. Note waning assumption implemented prediction fitted model, rather “prior” structural assumption used model fitting. baseline log hazard ratio \\(t_{min}\\) inferred M-spline model, short-term data long-term data provided. requesting predictions , e.g., survival curves, hazard curves mean survival times fitted model, can optionally request interval \\(t_{min},t_{max}\\) log hazard ratio covariate changes linearly value estimated model “null” value. fitted M-spline model necessarily need proportional hazards model use treatment waning. fitted model non-proportional hazards, hazard ratio non-constant time 0 \\(t_{min}\\), wane value \\(t_{min}\\) zero \\(t_{max}\\).","code":""},{"path":"https://chjackson.github.io/survextrap/articles/methods.html","id":"waning-models-example","dir":"Articles","previous_headings":"Treatment effect waning models","what":"Waning models: example","title":"Details of methods behind survextrap","text":"clarity , subset example data two three treatment groups: observation-levamisole. First fit survextrap model (arbitrarily, example, M-spline model 5 basis terms). See examples vignette examples calling survextrap function. extrapolate survival hazard curves 10 years naive assumption proportional hazards beyond end follow-(3 years).  predict model waning treatment effect must define following: wane_period: vector containing start end period effect wanes newdata: covariate values define hazard “full” effect (waning starts) newdata0: covariate values define hazard “null” effect (waning finishes) Optionally can also supply wane_nt, defines number intervals use grid approximation hazard within waning period. defaults 10, ’d expect sufficient practice. things supplied arguments functions survival, hazard rmst, plot mean methods survextrap objects. example, predict survival hazard 10 years treated control groups. treated group assumed experience treatment effect waning - 5 10 years, log hazard changes linearly modelled hazard treated group modelled hazard control group. obtain predictions groups, first define “full” “null” covariate values, data frames two rows, one treated group one control group. Note control group, “full” “null” covariate values . supply arguments plot method, along definition waning period (5 10 years), illustrate survival hazard trajectories group waning model. Note hazard curves converge waning period. survival curves just started converge - effects waning survival noticeable longer extrapolation periods (say 30-40 years).  also compare restricted mean survival times (50 years) without treatment waning. consequence waning treatment effect reduce long term mean survival time treated group three years. (Combining waning computation restricted mean computationally intensive, illustration, use sample 20 posterior distribution).","code":"library(dplyr) library(survextrap) colons2 <- colons %>% filter(rx %in% c(\"Obs\", \"Lev\")) %>% droplevels() rxph_mod <- survextrap(Surv(years, status) ~ rx, data=colons2,                         fit_method=\"opt\", mspline=list(df=5)) plot(rxph_mod, tmax=10, niter=100) nd_full <- data.frame(rx = c(\"Lev\",\"Obs\")) nd_null <- data.frame(rx = c(\"Obs\",\"Obs\")) plot(rxph_mod, tmax=10, wane_period = c(5, 10), niter=1000,       newdata = nd_full, newdata0 = nd_null) options(digits=2) rmst(rxph_mod, t=50, niter=100, newdata=nd_full) ## # A tibble: 2 × 6 ##   variable rx        t median lower upper ##   <chr>    <chr> <dbl>  <dbl> <dbl> <dbl> ## 1 rmst     Lev      50   7.45  4.17 17.0  ## 2 rmst     Obs      50   4.88  3.09  9.07 rmst(rxph_mod, t=50, niter=20, newdata=nd_full, newdata0=nd_null, wane_period = c(5,10)) ## # A tibble: 2 × 6 ##   variable rx        t median lower upper ##   <chr>    <chr> <dbl>  <dbl> <dbl> <dbl> ## 1 rmst     Lev      50   6.32  4.40 14.7  ## 2 rmst     Obs      50   4.83  3.53  9.93"},{"path":"https://chjackson.github.io/survextrap/articles/methods.html","id":"waning-models-distribution-utilities","dir":"Articles","previous_headings":"Treatment effect waning models","what":"Waning models: distribution utilities","title":"Details of methods behind survextrap","text":"Distribution random number generation functions “waning effect” model available psurvmspline_wane(), Hsurvmspline_wane(), hsurvmspline_wane(), dsurvmspline_wane(), qsurvmspline_wane(), rsurvmspline_wane(), enable users construct summaries predictions model.","code":""},{"path":"https://chjackson.github.io/survextrap/articles/priors.html","id":"converting-prior-judgements-about-survival-to-external-data","dir":"Articles","previous_headings":"","what":"Converting prior judgements about survival to external data","title":"Priors in survextrap models","text":"suppose expert judgement survival time period \\(t\\) \\(u\\), can “elicit” probability \\(p\\) person alive \\(t\\) died \\(u\\). elicitation might done many ways (e.g. consensus methods, consulting multiple experts aggregating beliefs). survextrap include tools guidance elicitation, info available, e.g. Bojke et al., SHELF. One simple way elicit: best guess \\(p\\) . interpret median prior distribution. upper lower prior credible limits, (example) 90% sure \\(p\\) within range. can interpret 5% 95% quantiles. example, suppose elicited best guess 0.6, 90% credible interval 0.4 0.8. can fitted probability distribution representing beliefs \\(p\\). SHELF R package provides useful function, fitdist, . use fit Beta distribution, typically-used distribution probabilities. gives Beta(9.2, 6.2) distribution. can plot probability density function, check distribution represents beliefs \\(p\\) intended use:  now convert elicited Beta distribution pseudo-data. trick comes basic result Bayesian estimation event probability \\(p\\). Suppose start Beta\\((,b)\\) prior \\(p\\), observe \\(y\\) events \\(n\\) individual observations, observation may may resulted event, \\(y\\) comes Binomial distribution probability \\(p\\). posterior \\(p\\) Beta\\((+y, b+n-y)\\). can equate elicited belief (call Beta\\((e_1, e_2)\\), say) posterior distribution vague prior (say Beta\\((=0,b=0)\\)). Therefore \\(e_1=+y\\) \\(e_2 = b+n-y\\), hence \\(y=e_1\\), \\(n = e_1 + e_2\\). words, elicited Beta\\((e_1,e_2)\\) distribution equivalent knowledge aggregate count \\(e_1\\) events \\(e_1 + e_2\\) observations. aggregate “pseudo-data” can used external data source survextrap. example, Beta(9,6) distribution equivalent pseudo-data 9 events 15 trials. point estimate event probability data 9/15 = 0.6 (original guess). pseudo-dataset 90 events 150 trials median, narrower credible interval, since dataset larger, implying greater confidence true \\(p\\) near point estimate.","code":"library(SHELF) p <- c(0.4, 0.6, 0.8) bet <- fitdist(vals=p, probs=c(0.05, 0.5, 0.95), lower=0, upper=1)$Beta bet ##     shape1  shape2 ## 1 9.190895 6.19854 library(ggplot2) ggplot(data.frame(p = c(0, 1)), aes(x = p)) +   stat_function(fun = dbeta, args=list(shape1=bet$shape1, shape2=bet$shape2)) +   ylab(\"Density\")"},{"path":"https://chjackson.github.io/survextrap/articles/priors.html","id":"further-notes-on-elicitation","dir":"Articles","previous_headings":"Converting prior judgements about survival to external data","what":"Further notes on elicitation","title":"Priors in survextrap models","text":"Academic note: different ways defining vague Beta prior probability. Beta\\((0,0)\\) uniform distribution log odds \\(\\log(p/(1-p))\\), Beta\\((1,1)\\) uniform scale probability \\(p\\). “Jeffreys” prior Beta\\((0.5, 0.5)\\) sometimes used compromise . difference choices unlikely matter practice. elicit survival probabilities different time intervals, use multiple external datasets survextrap. probably appropriate include beliefs quantity, elicited multiple experts, multiple external datasets survextrap. experts may shared beliefs based common knowledge field. multiple experts consulted quantity, beliefs aggregated single distribution using survextrap, e.g. using mathematical aggregation consensus method. , see, e.g. Bojke et al. SHELF, information elicitation.","code":""},{"path":"https://chjackson.github.io/survextrap/articles/priors.html","id":"priors-on-spline-parameters","dir":"Articles","previous_headings":"","what":"Priors on spline parameters","title":"Priors in survextrap models","text":"parameters spline model mathematical abstractions meaningful interpretations means variances survival times. However Bayesian modelling, still place priors . general way ensure chosen priors represent meaningful beliefs simulation. survextrap provides tools .","code":""},{"path":"https://chjackson.github.io/survextrap/articles/priors.html","id":"plotting-plausible-hazard-trajectories","dir":"Articles","previous_headings":"Priors on spline parameters","what":"Plotting plausible hazard trajectories","title":"Priors in survextrap models","text":"fitting model, can use prior_sample_hazard function check hazard curves simulated prior considered plausible representations knowledge exists outside data. use model fitted, know knots defining spline, choose set priors. survextrap provides set default priors, may may sensible given application. procedure picking knots (see methods vignette). First fit default model, print default priors used. “baseline log hazard scale” parameter parameter \\(\\log(\\eta)\\) definition M-spline function hazard: \\(h(t) = \\eta \\sum_k p_k b_k(t)\\). , \\(\\eta\\) define hazard. defines hazard combined basis coefficients \\(p_k\\) basis terms \\(b_k()\\). “smoothness SD” parameter \\(\\sigma\\) . even harder interpret \\(\\eta\\). Values \\(\\sigma=0\\) represent certainty hazard one defined prior mean \\(p_k\\). Values 1 favour wiggly hazard curves, high values meaningful. prior mean \\(p_k\\) can examined coefs_mean - default, defines hazard function \\(h(t)\\) constant time. number location knots can also examined mspline component model. Together, knots prior choices define model fitted data. can now simulate consequences choices, terms : typical level hazard range hazard trajectories plausible much hazard tends vary time fitted model object (nd_mod ) component called prior_sample, list functions can used simulate various interesting quantities prior specification.","code":"library(survextrap) nd_mod <- survextrap(Surv(years, status) ~ 1, data=colons, fit_method=\"opt\") print_priors(nd_mod) ## Priors: ##   Baseline log hazard scale: normal(location=0,scale=20) ##   Smoothness SD: gamma(shape=2,rate=1) round(nd_mod$coefs_mean,2) sp <- nd_mod$mspline"},{"path":"https://chjackson.github.io/survextrap/articles/priors.html","id":"constant-hazard-level","dir":"Articles","previous_headings":"Priors on spline parameters > Plotting plausible hazard trajectories","what":"Constant hazard level","title":"Priors in survextrap models","text":"first thing verify typical level hazard. prior hazard scale parameter \\(\\eta\\) supplied survextrap, default \\(N(0,20)\\) used, vague. can illustrate implications choice deriving prior constant hazard \\(h(t) = \\eta \\sum_k p_k b_k(t)\\) implied prior \\(\\eta\\) special values \\(p_k\\) imply constant hazard (found using mspline_constant_coefs()). haz_const function returns summary implied prior constant hazard, implied prior mean survival time \\(1/h(t)\\). credible limits extreme. Perhaps reasonable dataset large dominate choice prior. applications, however, idea typical survival time , hence typical hazard , say within order two magnitude. simple heuristic specify prior guess (e.g. guess average survival time 50 years start study) prior upper credible limit (e.g. guess unlikely mean survival time 80 years start study). Note represents uncertainty mean survival population, rather variability individuals population, perhaps credible interval narrower think. hence giving median lower credible limit \\(h(t)\\), hence (dividing constant \\(\\sum_k p_k b_k(t)\\) arbitrary \\(t\\) logging), giving median \\(m\\) lower credible limit \\(L\\) \\(\\log(\\eta)\\). Hence normal prior \\(\\log(\\eta)\\) can defined median \\(m\\), standard deviation \\((L-m)/2\\). implemented function p_meansurv. Note spline knot specification required obtain constant \\(\\sum_k p_k b_k(t)\\). given prior \\(\\eta\\) spline specification, function prior_haz_const can used summarise implied prior constant hazard mean survival time. use now check prior defined p_meansurv one intended define. prior median upper credible limit match numbers put . also get lower 2.5% credible limit consequence normal assumption - checked plausibility, prior revised necessary. Finally, updated survextrap model can fitted includes weakly informative prior defined checked. reporting purposes, can use print_priors view normal prior \\(\\log(\\eta)\\) automatically derived.","code":"nd_mod$prior_sample$haz_const() ##                haz         mean ## 2.5%  8.336083e-18 1.073931e-17 ## 50%   8.810345e-01 1.135029e+00 ## 97.5% 9.311588e+16 1.199604e+17 p_meansurv(median=50, upper=80, mspline=sp) prior_haz_const(mspline=sp,                  prior_hscale = p_meansurv(median=50, upper=80, mspline=sp)) ##          haz  mean ## 2.5%  0.0125 31.25 ## 50%   0.0200 50.00 ## 97.5% 0.0320 80.00 ndi_mod <- survextrap(Surv(years, status) ~ 1, data=colons, fit_method=\"opt\",                       prior_hscale = p_meansurv(median=50, upper=80, mspline=sp)) print_priors(ndi_mod) ## Priors: ##   Baseline log hazard scale: normal(location=-3.7853644873736,scale=0.2398021764446) ##   Smoothness SD: gamma(shape=2,rate=1)"},{"path":"https://chjackson.github.io/survextrap/articles/priors.html","id":"hazard-as-a-function-of-time","dir":"Articles","previous_headings":"Priors on spline parameters > Plotting plausible hazard trajectories","what":"Hazard as a function of time","title":"Priors in survextrap models","text":"prior_sample component includes function called haz simulates desired number hazard trajectories time, given prior. function returns data frame (called haz_sim) contains hazard value haz, time point time simulation replicate rep. simulate nsim=30 prior hazard trajectories model ndi_mod, plot ggplot.  alternative way use prior_sample_hazard function, require model specified survextrap function, require knots priors supplied explicitly. plots can give idea much risks might expected vary time. parameter driving variations \\(\\sigma\\), whose prior can defined prior_hsd argument survextrap. standard survextrap model, \\(\\sigma=0\\) means sure hazard constant. Therefore might want define prior \\(\\sigma\\) rule implausibly large changes. example, Gamma(2,20):  choice prior might important want extrapolate outside data, accounting potential hazard changes outside data. data informing extrapolation weak, extrapolations sensitive prior potential hazard changes. Plotting multiple trajectories gives rough idea typical amount variation time, , ideally want quantitative summary .","code":"set.seed(1) haz_sim <- ndi_mod$prior_sample$haz(nsim=30) ggplot(haz_sim, aes(x=time, y=haz, group=rep)) +    geom_line() + xlab(\"Years\") + ylab(\"Hazard\") + ylim(0,0.05) set.seed(1) haz_sim <- prior_sample_hazard(knots=sp$knots, degree=sp$degree,                                 coefs_mean = ndi_mod$coefs_mean,                                   prior_hsd = p_gamma(2,1),                                   prior_hscale = p_meansurv(median=50, upper=80, mspline=sp),                                tmax=3, nsim=30) set.seed(1) haz_sim <- prior_sample_hazard(knots=sp$knots, degree=sp$degree,                                 coefs_mean = ndi_mod$coefs_mean,                                   prior_hsd = p_gamma(2,20),                                   prior_hscale = p_meansurv(median=50, upper=80, mspline=sp),                              tmax=3, nsim=30) ggplot(haz_sim, aes(x=time, y=haz, group=rep)) +    geom_line() + xlab(\"Years\") + ylab(\"Hazard\") + ylim(0,0.05)"},{"path":"https://chjackson.github.io/survextrap/articles/priors.html","id":"hrsd","dir":"Articles","previous_headings":"Priors on spline parameters","what":"Ratio between high and low hazards over time","title":"Priors in survextrap models","text":"variation hazard curve can summarised simply taking fine grid equally-spaced points time boundary knots, computing empirical standard deviation hazard points. hazard constant, SD zero. Since SD depends scale hazard, useful measure variation ratio particularly high particularly low hazard grid. High low might defined 90% 10% quantiles time. hazard constant, time, ratio 1. measures computed haz_sd() function: sd_haz component SD time hazard, sd_mean SD time inverse hazard, hr high/low hazard ratio (90%/10% default). shows default Gamma\\((=2,b=1)\\) prior used model vague. can make less vague reducing \\(/b\\). Gamma(2, 5), example, leads upper 90% credible limit 5 hazard ratio time. Trial error probably necessary produce prior judged plausible metric. Note large number simulations nsim prior may required precise estimate tail quantiles, distribution skewed, 95% credible limit may much higher 90% limit, example. Let us now fit model compare posterior 95% credible interval hazard ratio prior. posterior interval narrower prior interval, showing influence data. practical applications, prior suspected influential, results interest compared different reasonable priors.","code":"set.seed(1) ndi_mod$prior_sample$haz_sd() ##            sd_haz      sd_mean           hr ## 2.5%  0.001515510 3.114473e+01 1.817126e+00 ## 50%   0.008722217 6.809896e+02 4.013356e+01 ## 97.5% 0.024717065 8.197922e+11 4.182825e+08 set.seed(1) prior_haz_sd(mspline=sp,                                            prior_hsd = p_gamma(2,5),                 prior_hscale = p_meansurv(median=50, upper=80, mspline=sp),               quantiles = c(0.1, 0.5, 0.9),              nsim=1000) ##           sd_haz    sd_mean       hr ## 10% 0.0004542116   9.037567 1.080665 ## 50% 0.0018053422  37.800321 1.517070 ## 90% 0.0050991490 231.092233 4.620972 library(dplyr) nd_mod <- survextrap(Surv(years, status) ~ 1, data=colons, fit_method=\"mcmc\",                      chains=1, iter=1000,                      prior_hsd = p_gamma(2,5)) qgamma(c(0.025, 0.975), 2, 5) summary(nd_mod) %>% filter(variable==\"hsd\") %>% select(lower, upper)"},{"path":"https://chjackson.github.io/survextrap/articles/priors.html","id":"hazard-ratios-for-effects-of-covariates","dir":"Articles","previous_headings":"Priors on spline parameters","what":"Hazard ratios for effects of covariates","title":"Priors in survextrap models","text":"Hazard ratios effects predictors survival models commonly presented discussed practice, prior judgements may easier make, compared parameters survextrap models. survextrap uses normal (t) priors log hazard ratio. default normal(0, 2.5). utility prior_hr() provided check credible interval hazard ratio scale implied particular prior log hazard ratio. shows default actually vague, supports hazard ratios 148. prior SD reduced implausible sample size small enough influential. Conversely, function p_hr goes way round converts prior median upper 95% credible limit hazard ratio normal prior log scale. shows use prior SD 1.17 log HR wanted give low probability (2.5%) HRs 10. p_hr returns list format p_normal, can supplied directly prior_loghr argument survextrap models.","code":"prior_hr(p_normal(0, 2.5)) ##         2.5%          50%        97.5%  ## 7.447254e-03 1.000000e+00 1.342777e+02 p_hr(median=1, upper=10)$scale ## [1] 1.17481 prior_hr(p_hr(median=1, upper=10)) ##  2.5%   50% 97.5%  ##   0.1   1.0  10.0"},{"path":"https://chjackson.github.io/survextrap/articles/priors.html","id":"sd-of-hazard-ratios-over-time-in-non-proportional-hazards-models","dir":"Articles","previous_headings":"Priors on spline parameters","what":"SD of hazard ratios over time in non-proportional hazards models","title":"Priors in survextrap models","text":"novel non-proportional hazards model survextrap works modelling spline coefficients terms covariates, well hazard scale parameter. model described methods vignette example fitting one given examples vignette. parameters relate covariates spline coefficients direct interpretation terms effect covariate hazard changes time. theory, model allows hazard ratio increase decrease arbitrarily flexible way, manner spline function. parameter \\(\\tau\\) governs amount flexibility hazard ratio function. \\(\\tau=0\\) model proportional hazards model, \\(\\tau\\) increases hazard ratio becomes flexible function time. exact value \\(\\tau\\) interpretation, \\(\\sigma\\) , can use simulation calibrate prior matches plausible judgements. done prior_hr_sd function, works \\(\\tau\\) way prior_haz_sd \\(\\sigma\\). new requirement values covariates supplied newdata newdata0, associated regression model formula formula. hazard ratio newdata newdata0 computed. priors supplied: prior_hscale \\(\\eta\\), prior_hsd \\(\\sigma\\), prior_loghr “baseline” hazard ratio non-proportionality effects applied. function simulate joint prior distribution hazard ratios implied priors together one want calibrate: prior_hrsd, Gamma prior \\(\\tau\\). sd_hr column standard deviation hazard ratio, hrr column ratio high low value (default 90% versus 10% quantile, can customised hq argument). quantities implicit prior distributions. Since supplied quantiles=c(0.05,0.95), 90% prior credible intervals two quantities shown . checked consistency beliefs, Gamma prior \\(\\tau\\) (supplied p_gamma(2,3) revised necessary.","code":"prior_hr_sd(mspline=sp,                                           prior_hsd = p_gamma(2,5),                prior_hscale = p_meansurv(median=50, upper=80, mspline=sp),             prior_loghr = p_normal(0,1),             prior_hrsd = p_gamma(2,3),             formula = ~ treat,             newdata = list(treat = 1),             newdata0 = list(treat = 0),             quantiles = c(0.05, 0.95),             nsim=1000) ##           sd_hr       hrr ## 5%   0.01502037  1.453464 ## 95% 53.42515945 12.894767"},{"path":"https://chjackson.github.io/survextrap/articles/sbc.html","id":"core-principle","dir":"Articles","previous_headings":"","what":"Core principle","title":"Simulation-based calibration of survextrap","text":"posterior \\(p(\\theta | \\y)\\), integrated data \\(\\y\\) generated prior predictive distribution \\(p(\\y)\\), equivalent prior \\(p(\\theta)\\).","code":""},{"path":"https://chjackson.github.io/survextrap/articles/sbc.html","id":"core-approach-to-algorithm","dir":"Articles","previous_headings":"","what":"Core approach to algorithm","title":"Simulation-based calibration of survextrap","text":"Repeatedly : Simulate dataset prior predictive distribution, .e. simulate \\(\\theta\\) prior \\(p(\\theta)\\) followed data \\(y\\) \\(p(y|\\theta)\\). Fit model dataset, getting posterior Average resulting posteriors: end prior started doesn’t match: evidence bug code, poorly-performing fitting algorithm.","code":""},{"path":"https://chjackson.github.io/survextrap/articles/sbc.html","id":"how-is-this-actually-done","dir":"Articles","previous_headings":"","what":"How is this actually done","title":"Simulation-based calibration of survextrap","text":"Choose quantity interest model \\(h(\\theta)\\) (scalar parameter function parameters). \\(= 1, \\ldots, N\\) generate value \\(\\tilde\\theta_i\\) prior, hence dataset \\(\\tilde{\\y}_i\\) generate sample size \\(L\\), \\(\\{h(\\theta_1), \\ldots, h(\\theta_L)\\}\\), posterior \\(h(\\theta | \\tilde{\\y}_i)\\) compute rank \\(r_i\\) \\(h(\\tilde\\theta_i)\\) among \\(\\{h(\\theta_1), \\ldots, h(\\theta_L)\\}\\) Plot histogram ranks \\(r_1,\\ldots,r_N\\). uniformly distributed across \\(0\\) \\(L\\). (proof Talts et al.)","code":""},{"path":"https://chjackson.github.io/survextrap/articles/sbc.html","id":"awkward-aspects","dir":"Articles","previous_headings":"","what":"Awkward aspects","title":"Simulation-based calibration of survextrap","text":"Computationally expensive, though easily parallelisable \\(L=100\\) posterior sample used Talts et al. Prior samples \\(N\\) chosen depending speed posterior sampling, procedure takes hours . \\(N=1000, 10000\\) used Talts et al. check one parameter / quantity \\(h(\\theta)\\) time Informal check eye: quantitative measure bad fit, can’t automate Needs informative priors (enough avoid extreme samples prior predictive distribution)","code":""},{"path":"https://chjackson.github.io/survextrap/articles/sbc.html","id":"application-to-survextrap","dir":"Articles","previous_headings":"","what":"Application to survextrap","title":"Simulation-based calibration of survextrap","text":"Compare accuracy posterior computation using three alternative posterior sampling methods Stan Full Hamiltonian MCMC Optimisation / Laplace approximation Variational Bayes Quantity interest \\(h(\\theta)\\): restricted mean survival time 5 years \\(N=1000\\) prior samples model fits, \\(L=100\\) posterior samples, takes hours. knot configuration fixed, informative priors used. priors designed strong enough avoid extreme values. computation overflowed vague \\(N(0,20)\\) prior baseline log hazard scale, worked \\(N(0,1)\\). designed mimic specific applied situation, since aim validate fitting algorithm samples correct posterior, posterior appropriate particular situation. Sample survival dataset hazard function, fixed design (sample size, censor time)","code":""},{"path":"https://chjackson.github.io/survextrap/articles/sbc.html","id":"simulation-and-model-fitting-function","dir":"Articles","previous_headings":"","what":"Simulation and model fitting function","title":"Simulation-based calibration of survextrap","text":"Uses prior_pred() function supplied package simulates prior predictive distribution. called fix_prior=TRUE simulate single value \\(\\theta\\) prior, followed dataset 200 observations given single value. Data censored 5 years use survextrap fit model simulated data, using priors spline knots used simluation. covariates example. function one argument , enable parallel computation (see ). Calling function one iteration algorithm . findInterval call used get rank \\(h(\\tilde\\theta_i)\\) (summ_prior) among posterior sample \\(\\{h(\\theta_1), \\ldots, h(\\theta_L)\\}\\) (summ).","code":"sim_rank <- function(i, fit_method=\"opt\"){   library(survextrap) # have to do this to parallelise on Windows, inefficient   L <- 100   knots <- 1:5   censtime <- 5   iter <- if (fit_method==\"mcmc\") 1000 else 2000   simdf <- prior_pred(n=200, censtime=censtime, fix_prior=TRUE,                        mspline = list(knots=knots),                        prior_hscale = p_normal(0, 1),                       prior_hsd = p_gamma(2,2))   rstan::rstan_options(silent = TRUE, open_progress=FALSE,show_messages=FALSE)   tryres <- try(mod <- survextrap(Surv(time, event) ~ 1, data=simdf,                                   fit_method=fit_method,                                   iter = iter,                                    mspline = list(knots=knots),                                   prior_hscale = p_normal(0, 1),                                   prior_hsd = p_gamma(2,2),                                   loo = TRUE,                                   open_progress = FALSE,                                   refresh = 0))   if (!inherits(tryres, \"try-error\")){       summ <- attr(rmst(mod, t=censtime, niter=L),\"sample\")[[1]]       prior <- attr(simdf, \"prior\")       summ_prior <- rmst_survmspline(t=censtime, prior$alpha, prior$coefs, knots)       res <- findInterval(summ_prior, sort(summ))   } else res <- NA   res }"},{"path":"https://chjackson.github.io/survextrap/articles/sbc.html","id":"mcmc-method","dir":"Articles","previous_headings":"","what":"MCMC method","title":"Simulation-based calibration of survextrap","text":"algorithm used evaluate MCMC model fitting method. non-parallelised loop N, within , 4 chains run parallel MCMC.","code":"N <- 1000 #  194 sec for 10 -> 6 hours for 1000  library(progress) set.seed(1) ranks <- numeric(N) options(mc.cores = 4) pb <- progress_bar$new(total=N) for (i in 1:N) {   ranks[i] <- sim_rank(i, fit_method=\"mcmc\")   pb$tick() } ranks_mcmc <- unlist(ranks) saveRDS(ranks_mcmc, file=\"sbc_files/ranks_mcmc.rds\")"},{"path":"https://chjackson.github.io/survextrap/articles/sbc.html","id":"optimisation-method","dir":"Articles","previous_headings":"","what":"Optimisation method","title":"Simulation-based calibration of survextrap","text":"optimisation method evaluated parallelised loop N.","code":"N <- 1000 library(doParallel) ## Loading required package: foreach ## Loading required package: iterators ## Loading required package: parallel library(parallel) no_cores <- detectCores(logical = TRUE)  cl <- makeCluster(no_cores-1) registerDoParallel(cl)   clusterExport(cl,list('sim_rank')) ranks <- parLapply(cl=cl, X=1:N, fun=sim_rank) ranks_opt <- unlist(ranks) saveRDS(ranks_opt, file=\"sbc_files/ranks_opt.rds\") stopCluster(cl)"},{"path":"https://chjackson.github.io/survextrap/articles/sbc.html","id":"variational-bayes","dir":"Articles","previous_headings":"","what":"Variational Bayes","title":"Simulation-based calibration of survextrap","text":"variational Bayes method evaluated parallelised loop N.","code":"N <- 1000 set.seed(1) cl <- makeCluster(no_cores-1) registerDoParallel(cl)   clusterExport(cl,list('sim_rank')) ranks <- parLapply(cl=cl, X=1:N, fun=sim_rank, fit_method=\"vb\") ranks_vb <- unlist(ranks) saveRDS(ranks_vb, file=\"sbc_files/ranks_vb.rds\") stopCluster(cl)"},{"path":"https://chjackson.github.io/survextrap/articles/sbc.html","id":"graphs-of-the-results","dir":"Articles","previous_headings":"","what":"Graphs of the results","title":"Simulation-based calibration of survextrap","text":"Conventional histograms  QQ plots, easier interpret histograms  MCMC variational Bayes methods seem accurate, since empirical distributions appear uniform, though evidence bias optimisation method.","code":"library(ggplot2) methods <- c(\"mcmc\",\"opt\",\"vb\") methods_full <- c(\"MCMC\",\"Optimisation\",\"Variational\") fnames <- paste0(\"sbc_files/ranks_\",methods,\".rds\") ranks <- purrr::map2_dfr(fnames, methods_full,                           ~data.frame(rank=readRDS(.x),                                       method=.y))  bq <- qbinom(c(0.005, 0.995), size=1000, prob=1/101)  p <- ggplot(ranks, aes(x=rank,fill=method,)) +    geom_histogram(binwidth = 1) +    geom_ribbon(fill=\"gray75\",              aes(ymin=bq[1], ymax=bq[2], xmin=-1, xmax=101), alpha=0.4) +   facet_grid(rows=vars(method)) +   xlab(\"Rank\") + ylab(\"Count out of N=1000\") +    ggtitle(\"Bin width 1\") +    theme_minimal() +   theme(legend.position = \"none\")   bq2 <- qbinom(c(0.005, 0.995), size=1000, prob=1/50) p2 <- ggplot(ranks, aes(x=rank,fill=method)) +    geom_histogram(binwidth = 2) +    geom_ribbon(fill=\"gray75\",              aes(ymin=bq2[1], ymax=bq2[2], xmin=-1, xmax=101), alpha=0.4) +   facet_grid(rows=vars(method)) +   xlab(\"Rank\") + ylab(\"\") +    ggtitle(\"Bin width 2\") +    theme_minimal() +   theme(legend.position = \"none\")     gridExtra::grid.arrange(p, p2, nrow=1) x <- seq(0, 1, by=0.01) rank_ecdf <- purrr::map2_dfr(fnames, methods_full,                           ~data.frame(x=x,                                       ecdf = ecdf(readRDS(.x)/100)(x),                                       method = .y)) rank_ecdf$diff <- rank_ecdf$ecdf - rank_ecdf$x p1 <- ggplot(rank_ecdf, aes(x=x, y=ecdf, col=method, group=method)) +    geom_abline(intercept=0, slope=1, lwd=1.5, alpha=0.4) +    geom_line(lwd=1.5, alpha=0.6) +    facet_grid(rows=vars(method)) +    theme(legend.position = \"none\") +    ylab(\"Theoretical quantiles of U(0,1)\") +    xlab(\"Empirical quantiles\") +    theme_minimal() p2 <- ggplot(rank_ecdf, aes(x=x, y=diff, col=method, group=method)) +    geom_hline(yintercept=0, lwd=1.5, alpha=0.4) +    geom_line(lwd=1.5, alpha=0.6) +    facet_grid(rows=vars(method)) +    theme(legend.position = \"none\") +    ylab(\"Empirical - theoretical quantiles\") +    xlab(\"Empirical quantiles\") +    theme_minimal() gridExtra::grid.arrange(p1, p2, nrow=1)"},{"path":"https://chjackson.github.io/survextrap/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Christopher Jackson. Author, maintainer, copyright holder. Iain Timmins. Contributor. Michael Sweeting. Contributor.","code":""},{"path":"https://chjackson.github.io/survextrap/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Christopher Jackson survextrap: package flexible transparent survival extrapolation BMC Medical Research Methodology (2023)23:282","code":"@Article{,   title = {survextrap: a package for flexible and transparent survival extrapolation},   author = {Christopher Jackson},   journal = {BMC Medical Research Methodology},   year = {2023},   volume = {23},   number = {282},   doi = {10.1186/s12874-023-02094-1}, }"},{"path":"https://chjackson.github.io/survextrap/index.html","id":"survextrap","dir":"","previous_headings":"","what":"Survival Extrapolation with a Flexible Bayesian Parametric Model and External Data","title":"Survival Extrapolation with a Flexible Bayesian Parametric Model and External Data","text":"survextrap R package parametric survival modelling either : standard individual-level, right-censored survival dataset, e.g. (optionally) “External” data sources following aggregate “count” form: number rows can supplied “external” data, time intervals distinct exhaustive. Many forms external data might useful survival extrapolation (population data, registry data elicited judgements) can manipulated common “count” form.","code":""},{"path":"https://chjackson.github.io/survextrap/index.html","id":"principles","dir":"","previous_headings":"","what":"Principles","title":"Survival Extrapolation with a Flexible Bayesian Parametric Model and External Data","text":"Extrapolations short-term individual level data done using explicit data judgements risk change time. Extrapolations rely standard parametric forms (e.g. Weibull, log-normal, gamma…) used convention interpretations plausible mechanisms risk change time. Instead selecting (averaging) traditional parametric models, arbitrarily flexible parametric model used, adapts give optimal fit short-term long-term data combination.","code":""},{"path":"https://chjackson.github.io/survextrap/index.html","id":"how-it-works","dir":"","previous_headings":"","what":"How it works","title":"Survival Extrapolation with a Flexible Bayesian Parametric Model and External Data","text":"Bayesian multiparameter evidence synthesis used jointly model sources data judgements. M-spline used represent hazard changes time (rstanarm). Bayesian fitting method automatically chooses optimal level smoothness flexibility. Spline “knots” span period covered data, future period chance hazard may vary. data future period, uncertainty acknowledged predicted hazards wide credible intervals. proportional hazards model flexible non-proportional hazards model can used describe relation survival predictors. Mixture cure, relative survival treatment effect waning models supported. R interface, designed friendly familiar standard R modelling functions. Stan used surface MCMC (Hamiltonian Monte Carlo) sampling posterior distribution, similar fashion rstanarm survHE. Estimates posterior summaries samples outputs, survival, hazard (restricted) mean survival, can easily extracted.","code":""},{"path":"https://chjackson.github.io/survextrap/index.html","id":"technical-details-of-the-methods","dir":"","previous_headings":"","what":"Technical details of the methods","title":"Survival Extrapolation with a Flexible Bayesian Parametric Model and External Data","text":"model fully described paper: Jackson, BMC Medical Research Methodology (2023). See also vignette(\"methods\"). vignette(\"priors\") goes detail prior distributions judgements can specified survextrap - important often-neglected part Bayesian analysis.","code":""},{"path":"https://chjackson.github.io/survextrap/index.html","id":"examples-of-how-to-use-it","dir":"","previous_headings":"","what":"Examples of how to use it","title":"Survival Extrapolation with a Flexible Bayesian Parametric Model and External Data","text":"vignette(\"examples\") gives rapid tour feature, using simple textbook examples simulated data. cetuximab case study -depth demonstration survextrap used typical health technology evaluation, based clinical trial, disease registry, general population elicited data. vignette accompanies Section 4 preprint paper.","code":""},{"path":"https://chjackson.github.io/survextrap/index.html","id":"slides-from-presentations-about-survextrap","dir":"","previous_headings":"","what":"Slides from presentations about survextrap","title":"Survival Extrapolation with a Flexible Bayesian Parametric Model and External Data","text":"Belfast (RSS NI), December 2023 Royal Statistical Society, September 2023 R-HTA, York, June 2023 Exeter, October 2022","code":""},{"path":"https://chjackson.github.io/survextrap/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Survival Extrapolation with a Flexible Bayesian Parametric Model and External Data","text":"current version can installed : soon CRAN well. Please give feedback suggestions use . can posted github issues, email.","code":"install.packages(\"survextrap\", repos=c('https://chjackson.r-universe.dev',                                        'https://cloud.r-project.org'))"},{"path":"https://chjackson.github.io/survextrap/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"GNU General Public License","title":"GNU General Public License","text":"Version 3, 29 June 2007Copyright © 2007 Free Software Foundation, Inc. <http://fsf.org/> Everyone permitted copy distribute verbatim copies license document, changing allowed.","code":""},{"path":"https://chjackson.github.io/survextrap/LICENSE.html","id":"preamble","dir":"","previous_headings":"","what":"Preamble","title":"GNU General Public License","text":"GNU General Public License free, copyleft license software kinds works. licenses software practical works designed take away freedom share change works. contrast, GNU General Public License intended guarantee freedom share change versions program–make sure remains free software users. , Free Software Foundation, use GNU General Public License software; applies also work released way authors. can apply programs, . speak free software, referring freedom, price. General Public Licenses designed make sure freedom distribute copies free software (charge wish), receive source code can get want , can change software use pieces new free programs, know can things. protect rights, need prevent others denying rights asking surrender rights. Therefore, certain responsibilities distribute copies software, modify : responsibilities respect freedom others. example, distribute copies program, whether gratis fee, must pass recipients freedoms received. must make sure , , receive can get source code. must show terms know rights. Developers use GNU GPL protect rights two steps: (1) assert copyright software, (2) offer License giving legal permission copy, distribute /modify . developers’ authors’ protection, GPL clearly explains warranty free software. users’ authors’ sake, GPL requires modified versions marked changed, problems attributed erroneously authors previous versions. devices designed deny users access install run modified versions software inside , although manufacturer can . fundamentally incompatible aim protecting users’ freedom change software. systematic pattern abuse occurs area products individuals use, precisely unacceptable. Therefore, designed version GPL prohibit practice products. problems arise substantially domains, stand ready extend provision domains future versions GPL, needed protect freedom users. Finally, every program threatened constantly software patents. States allow patents restrict development use software general-purpose computers, , wish avoid special danger patents applied free program make effectively proprietary. prevent , GPL assures patents used render program non-free. precise terms conditions copying, distribution modification follow.","code":""},{"path":[]},{"path":"https://chjackson.github.io/survextrap/LICENSE.html","id":"id_0-definitions","dir":"","previous_headings":"TERMS AND CONDITIONS","what":"0. Definitions","title":"GNU General Public License","text":"“License” refers version 3 GNU General Public License. “Copyright” also means copyright-like laws apply kinds works, semiconductor masks. “Program” refers copyrightable work licensed License. licensee addressed “”. “Licensees” “recipients” may individuals organizations. “modify” work means copy adapt part work fashion requiring copyright permission, making exact copy. resulting work called “modified version” earlier work work “based ” earlier work. “covered work” means either unmodified Program work based Program. “propagate” work means anything , without permission, make directly secondarily liable infringement applicable copyright law, except executing computer modifying private copy. Propagation includes copying, distribution (without modification), making available public, countries activities well. “convey” work means kind propagation enables parties make receive copies. Mere interaction user computer network, transfer copy, conveying. interactive user interface displays “Appropriate Legal Notices” extent includes convenient prominently visible feature (1) displays appropriate copyright notice, (2) tells user warranty work (except extent warranties provided), licensees may convey work License, view copy License. interface presents list user commands options, menu, prominent item list meets criterion.","code":""},{"path":"https://chjackson.github.io/survextrap/LICENSE.html","id":"id_1-source-code","dir":"","previous_headings":"TERMS AND CONDITIONS","what":"1. Source Code","title":"GNU General Public License","text":"“source code” work means preferred form work making modifications . “Object code” means non-source form work. “Standard Interface” means interface either official standard defined recognized standards body, , case interfaces specified particular programming language, one widely used among developers working language. “System Libraries” executable work include anything, work whole, () included normal form packaging Major Component, part Major Component, (b) serves enable use work Major Component, implement Standard Interface implementation available public source code form. “Major Component”, context, means major essential component (kernel, window system, ) specific operating system () executable work runs, compiler used produce work, object code interpreter used run . “Corresponding Source” work object code form means source code needed generate, install, (executable work) run object code modify work, including scripts control activities. However, include work’s System Libraries, general-purpose tools generally available free programs used unmodified performing activities part work. example, Corresponding Source includes interface definition files associated source files work, source code shared libraries dynamically linked subprograms work specifically designed require, intimate data communication control flow subprograms parts work. Corresponding Source need include anything users can regenerate automatically parts Corresponding Source. Corresponding Source work source code form work.","code":""},{"path":"https://chjackson.github.io/survextrap/LICENSE.html","id":"id_2-basic-permissions","dir":"","previous_headings":"TERMS AND CONDITIONS","what":"2. Basic Permissions","title":"GNU General Public License","text":"rights granted License granted term copyright Program, irrevocable provided stated conditions met. License explicitly affirms unlimited permission run unmodified Program. output running covered work covered License output, given content, constitutes covered work. License acknowledges rights fair use equivalent, provided copyright law. may make, run propagate covered works convey, without conditions long license otherwise remains force. may convey covered works others sole purpose make modifications exclusively , provide facilities running works, provided comply terms License conveying material control copyright. thus making running covered works must exclusively behalf, direction control, terms prohibit making copies copyrighted material outside relationship . Conveying circumstances permitted solely conditions stated . Sublicensing allowed; section 10 makes unnecessary.","code":""},{"path":"https://chjackson.github.io/survextrap/LICENSE.html","id":"id_3-protecting-users-legal-rights-from-anti-circumvention-law","dir":"","previous_headings":"TERMS AND CONDITIONS","what":"3. Protecting Users’ Legal Rights From Anti-Circumvention Law","title":"GNU General Public License","text":"covered work shall deemed part effective technological measure applicable law fulfilling obligations article 11 WIPO copyright treaty adopted 20 December 1996, similar laws prohibiting restricting circumvention measures. convey covered work, waive legal power forbid circumvention technological measures extent circumvention effected exercising rights License respect covered work, disclaim intention limit operation modification work means enforcing, work’s users, third parties’ legal rights forbid circumvention technological measures.","code":""},{"path":"https://chjackson.github.io/survextrap/LICENSE.html","id":"id_4-conveying-verbatim-copies","dir":"","previous_headings":"TERMS AND CONDITIONS","what":"4. Conveying Verbatim Copies","title":"GNU General Public License","text":"may convey verbatim copies Program’s source code receive , medium, provided conspicuously appropriately publish copy appropriate copyright notice; keep intact notices stating License non-permissive terms added accord section 7 apply code; keep intact notices absence warranty; give recipients copy License along Program. may charge price price copy convey, may offer support warranty protection fee.","code":""},{"path":"https://chjackson.github.io/survextrap/LICENSE.html","id":"id_5-conveying-modified-source-versions","dir":"","previous_headings":"TERMS AND CONDITIONS","what":"5. Conveying Modified Source Versions","title":"GNU General Public License","text":"may convey work based Program, modifications produce Program, form source code terms section 4, provided also meet conditions: ) work must carry prominent notices stating modified , giving relevant date. b) work must carry prominent notices stating released License conditions added section 7. requirement modifies requirement section 4 “keep intact notices”. c) must license entire work, whole, License anyone comes possession copy. License therefore apply, along applicable section 7 additional terms, whole work, parts, regardless packaged. License gives permission license work way, invalidate permission separately received . d) work interactive user interfaces, must display Appropriate Legal Notices; however, Program interactive interfaces display Appropriate Legal Notices, work need make . compilation covered work separate independent works, nature extensions covered work, combined form larger program, volume storage distribution medium, called “aggregate” compilation resulting copyright used limit access legal rights compilation’s users beyond individual works permit. Inclusion covered work aggregate cause License apply parts aggregate.","code":""},{"path":"https://chjackson.github.io/survextrap/LICENSE.html","id":"id_6-conveying-non-source-forms","dir":"","previous_headings":"TERMS AND CONDITIONS","what":"6. Conveying Non-Source Forms","title":"GNU General Public License","text":"may convey covered work object code form terms sections 4 5, provided also convey machine-readable Corresponding Source terms License, one ways: ) Convey object code , embodied , physical product (including physical distribution medium), accompanied Corresponding Source fixed durable physical medium customarily used software interchange. b) Convey object code , embodied , physical product (including physical distribution medium), accompanied written offer, valid least three years valid long offer spare parts customer support product model, give anyone possesses object code either (1) copy Corresponding Source software product covered License, durable physical medium customarily used software interchange, price reasonable cost physically performing conveying source, (2) access copy Corresponding Source network server charge. c) Convey individual copies object code copy written offer provide Corresponding Source. alternative allowed occasionally noncommercially, received object code offer, accord subsection 6b. d) Convey object code offering access designated place (gratis charge), offer equivalent access Corresponding Source way place charge. need require recipients copy Corresponding Source along object code. place copy object code network server, Corresponding Source may different server (operated third party) supports equivalent copying facilities, provided maintain clear directions next object code saying find Corresponding Source. Regardless server hosts Corresponding Source, remain obligated ensure available long needed satisfy requirements. e) Convey object code using peer--peer transmission, provided inform peers object code Corresponding Source work offered general public charge subsection 6d. separable portion object code, whose source code excluded Corresponding Source System Library, need included conveying object code work. “User Product” either (1) “consumer product”, means tangible personal property normally used personal, family, household purposes, (2) anything designed sold incorporation dwelling. determining whether product consumer product, doubtful cases shall resolved favor coverage. particular product received particular user, “normally used” refers typical common use class product, regardless status particular user way particular user actually uses, expects expected use, product. product consumer product regardless whether product substantial commercial, industrial non-consumer uses, unless uses represent significant mode use product. “Installation Information” User Product means methods, procedures, authorization keys, information required install execute modified versions covered work User Product modified version Corresponding Source. information must suffice ensure continued functioning modified object code case prevented interfered solely modification made. convey object code work section , , specifically use , User Product, conveying occurs part transaction right possession use User Product transferred recipient perpetuity fixed term (regardless transaction characterized), Corresponding Source conveyed section must accompanied Installation Information. requirement apply neither third party retains ability install modified object code User Product (example, work installed ROM). requirement provide Installation Information include requirement continue provide support service, warranty, updates work modified installed recipient, User Product modified installed. Access network may denied modification materially adversely affects operation network violates rules protocols communication across network. Corresponding Source conveyed, Installation Information provided, accord section must format publicly documented (implementation available public source code form), must require special password key unpacking, reading copying.","code":""},{"path":"https://chjackson.github.io/survextrap/LICENSE.html","id":"id_7-additional-terms","dir":"","previous_headings":"TERMS AND CONDITIONS","what":"7. Additional Terms","title":"GNU General Public License","text":"“Additional permissions” terms supplement terms License making exceptions one conditions. Additional permissions applicable entire Program shall treated though included License, extent valid applicable law. additional permissions apply part Program, part may used separately permissions, entire Program remains governed License without regard additional permissions. convey copy covered work, may option remove additional permissions copy, part . (Additional permissions may written require removal certain cases modify work.) may place additional permissions material, added covered work, can give appropriate copyright permission. Notwithstanding provision License, material add covered work, may (authorized copyright holders material) supplement terms License terms: ) Disclaiming warranty limiting liability differently terms sections 15 16 License; b) Requiring preservation specified reasonable legal notices author attributions material Appropriate Legal Notices displayed works containing ; c) Prohibiting misrepresentation origin material, requiring modified versions material marked reasonable ways different original version; d) Limiting use publicity purposes names licensors authors material; e) Declining grant rights trademark law use trade names, trademarks, service marks; f) Requiring indemnification licensors authors material anyone conveys material (modified versions ) contractual assumptions liability recipient, liability contractual assumptions directly impose licensors authors. non-permissive additional terms considered “restrictions” within meaning section 10. Program received , part , contains notice stating governed License along term restriction, may remove term. license document contains restriction permits relicensing conveying License, may add covered work material governed terms license document, provided restriction survive relicensing conveying. add terms covered work accord section, must place, relevant source files, statement additional terms apply files, notice indicating find applicable terms. Additional terms, permissive non-permissive, may stated form separately written license, stated exceptions; requirements apply either way.","code":""},{"path":"https://chjackson.github.io/survextrap/LICENSE.html","id":"id_8-termination","dir":"","previous_headings":"TERMS AND CONDITIONS","what":"8. Termination","title":"GNU General Public License","text":"may propagate modify covered work except expressly provided License. attempt otherwise propagate modify void, automatically terminate rights License (including patent licenses granted third paragraph section 11). However, cease violation License, license particular copyright holder reinstated () provisionally, unless copyright holder explicitly finally terminates license, (b) permanently, copyright holder fails notify violation reasonable means prior 60 days cessation. Moreover, license particular copyright holder reinstated permanently copyright holder notifies violation reasonable means, first time received notice violation License (work) copyright holder, cure violation prior 30 days receipt notice. Termination rights section terminate licenses parties received copies rights License. rights terminated permanently reinstated, qualify receive new licenses material section 10.","code":""},{"path":"https://chjackson.github.io/survextrap/LICENSE.html","id":"id_9-acceptance-not-required-for-having-copies","dir":"","previous_headings":"TERMS AND CONDITIONS","what":"9. Acceptance Not Required for Having Copies","title":"GNU General Public License","text":"required accept License order receive run copy Program. Ancillary propagation covered work occurring solely consequence using peer--peer transmission receive copy likewise require acceptance. However, nothing License grants permission propagate modify covered work. actions infringe copyright accept License. Therefore, modifying propagating covered work, indicate acceptance License .","code":""},{"path":"https://chjackson.github.io/survextrap/LICENSE.html","id":"id_10-automatic-licensing-of-downstream-recipients","dir":"","previous_headings":"TERMS AND CONDITIONS","what":"10. Automatic Licensing of Downstream Recipients","title":"GNU General Public License","text":"time convey covered work, recipient automatically receives license original licensors, run, modify propagate work, subject License. responsible enforcing compliance third parties License. “entity transaction” transaction transferring control organization, substantially assets one, subdividing organization, merging organizations. propagation covered work results entity transaction, party transaction receives copy work also receives whatever licenses work party’s predecessor interest give previous paragraph, plus right possession Corresponding Source work predecessor interest, predecessor can get reasonable efforts. may impose restrictions exercise rights granted affirmed License. example, may impose license fee, royalty, charge exercise rights granted License, may initiate litigation (including cross-claim counterclaim lawsuit) alleging patent claim infringed making, using, selling, offering sale, importing Program portion .","code":""},{"path":"https://chjackson.github.io/survextrap/LICENSE.html","id":"id_11-patents","dir":"","previous_headings":"TERMS AND CONDITIONS","what":"11. Patents","title":"GNU General Public License","text":"“contributor” copyright holder authorizes use License Program work Program based. work thus licensed called contributor’s “contributor version”. contributor’s “essential patent claims” patent claims owned controlled contributor, whether already acquired hereafter acquired, infringed manner, permitted License, making, using, selling contributor version, include claims infringed consequence modification contributor version. purposes definition, “control” includes right grant patent sublicenses manner consistent requirements License. contributor grants non-exclusive, worldwide, royalty-free patent license contributor’s essential patent claims, make, use, sell, offer sale, import otherwise run, modify propagate contents contributor version. following three paragraphs, “patent license” express agreement commitment, however denominated, enforce patent (express permission practice patent covenant sue patent infringement). “grant” patent license party means make agreement commitment enforce patent party. convey covered work, knowingly relying patent license, Corresponding Source work available anyone copy, free charge terms License, publicly available network server readily accessible means, must either (1) cause Corresponding Source available, (2) arrange deprive benefit patent license particular work, (3) arrange, manner consistent requirements License, extend patent license downstream recipients. “Knowingly relying” means actual knowledge , patent license, conveying covered work country, recipient’s use covered work country, infringe one identifiable patents country reason believe valid. , pursuant connection single transaction arrangement, convey, propagate procuring conveyance , covered work, grant patent license parties receiving covered work authorizing use, propagate, modify convey specific copy covered work, patent license grant automatically extended recipients covered work works based . patent license “discriminatory” include within scope coverage, prohibits exercise , conditioned non-exercise one rights specifically granted License. may convey covered work party arrangement third party business distributing software, make payment third party based extent activity conveying work, third party grants, parties receive covered work , discriminatory patent license () connection copies covered work conveyed (copies made copies), (b) primarily connection specific products compilations contain covered work, unless entered arrangement, patent license granted, prior 28 March 2007. Nothing License shall construed excluding limiting implied license defenses infringement may otherwise available applicable patent law.","code":""},{"path":"https://chjackson.github.io/survextrap/LICENSE.html","id":"id_12-no-surrender-of-others-freedom","dir":"","previous_headings":"TERMS AND CONDITIONS","what":"12. No Surrender of Others’ Freedom","title":"GNU General Public License","text":"conditions imposed (whether court order, agreement otherwise) contradict conditions License, excuse conditions License. convey covered work satisfy simultaneously obligations License pertinent obligations, consequence may convey . example, agree terms obligate collect royalty conveying convey Program, way satisfy terms License refrain entirely conveying Program.","code":""},{"path":"https://chjackson.github.io/survextrap/LICENSE.html","id":"id_13-use-with-the-gnu-affero-general-public-license","dir":"","previous_headings":"TERMS AND CONDITIONS","what":"13. Use with the GNU Affero General Public License","title":"GNU General Public License","text":"Notwithstanding provision License, permission link combine covered work work licensed version 3 GNU Affero General Public License single combined work, convey resulting work. terms License continue apply part covered work, special requirements GNU Affero General Public License, section 13, concerning interaction network apply combination .","code":""},{"path":"https://chjackson.github.io/survextrap/LICENSE.html","id":"id_14-revised-versions-of-this-license","dir":"","previous_headings":"TERMS AND CONDITIONS","what":"14. Revised Versions of this License","title":"GNU General Public License","text":"Free Software Foundation may publish revised /new versions GNU General Public License time time. new versions similar spirit present version, may differ detail address new problems concerns. version given distinguishing version number. Program specifies certain numbered version GNU General Public License “later version” applies , option following terms conditions either numbered version later version published Free Software Foundation. Program specify version number GNU General Public License, may choose version ever published Free Software Foundation. Program specifies proxy can decide future versions GNU General Public License can used, proxy’s public statement acceptance version permanently authorizes choose version Program. Later license versions may give additional different permissions. However, additional obligations imposed author copyright holder result choosing follow later version.","code":""},{"path":"https://chjackson.github.io/survextrap/LICENSE.html","id":"id_15-disclaimer-of-warranty","dir":"","previous_headings":"TERMS AND CONDITIONS","what":"15. Disclaimer of Warranty","title":"GNU General Public License","text":"WARRANTY PROGRAM, EXTENT PERMITTED APPLICABLE LAW. EXCEPT OTHERWISE STATED WRITING COPYRIGHT HOLDERS /PARTIES PROVIDE PROGRAM “” WITHOUT WARRANTY KIND, EITHER EXPRESSED IMPLIED, INCLUDING, LIMITED , IMPLIED WARRANTIES MERCHANTABILITY FITNESS PARTICULAR PURPOSE. ENTIRE RISK QUALITY PERFORMANCE PROGRAM . PROGRAM PROVE DEFECTIVE, ASSUME COST NECESSARY SERVICING, REPAIR CORRECTION.","code":""},{"path":"https://chjackson.github.io/survextrap/LICENSE.html","id":"id_16-limitation-of-liability","dir":"","previous_headings":"TERMS AND CONDITIONS","what":"16. Limitation of Liability","title":"GNU General Public License","text":"EVENT UNLESS REQUIRED APPLICABLE LAW AGREED WRITING COPYRIGHT HOLDER, PARTY MODIFIES /CONVEYS PROGRAM PERMITTED , LIABLE DAMAGES, INCLUDING GENERAL, SPECIAL, INCIDENTAL CONSEQUENTIAL DAMAGES ARISING USE INABILITY USE PROGRAM (INCLUDING LIMITED LOSS DATA DATA RENDERED INACCURATE LOSSES SUSTAINED THIRD PARTIES FAILURE PROGRAM OPERATE PROGRAMS), EVEN HOLDER PARTY ADVISED POSSIBILITY DAMAGES.","code":""},{"path":"https://chjackson.github.io/survextrap/LICENSE.html","id":"id_17-interpretation-of-sections-15-and-16","dir":"","previous_headings":"TERMS AND CONDITIONS","what":"17. Interpretation of Sections 15 and 16","title":"GNU General Public License","text":"disclaimer warranty limitation liability provided given local legal effect according terms, reviewing courts shall apply local law closely approximates absolute waiver civil liability connection Program, unless warranty assumption liability accompanies copy Program return fee. END TERMS CONDITIONS","code":""},{"path":"https://chjackson.github.io/survextrap/LICENSE.html","id":"how-to-apply-these-terms-to-your-new-programs","dir":"","previous_headings":"","what":"How to Apply These Terms to Your New Programs","title":"GNU General Public License","text":"develop new program, want greatest possible use public, best way achieve make free software everyone can redistribute change terms. , attach following notices program. safest attach start source file effectively state exclusion warranty; file least “copyright” line pointer full notice found. Also add information contact electronic paper mail. program terminal interaction, make output short notice like starts interactive mode: hypothetical commands show w show c show appropriate parts General Public License. course, program’s commands might different; GUI interface, use “box”. also get employer (work programmer) school, , sign “copyright disclaimer” program, necessary. information , apply follow GNU GPL, see <http://www.gnu.org/licenses/>. GNU General Public License permit incorporating program proprietary programs. program subroutine library, may consider useful permit linking proprietary applications library. want , use GNU Lesser General Public License instead License. first, please read <http://www.gnu.org/philosophy/--lgpl.html>.","code":"<one line to give the program's name and a brief idea of what it does.> Copyright (C) <year>  <name of author>  This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.  This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.  You should have received a copy of the GNU General Public License along with this program.  If not, see <http://www.gnu.org/licenses/>. <program>  Copyright (C) <year>  <name of author> This program comes with ABSOLUTELY NO WARRANTY; for details type 'show w'. This is free software, and you are welcome to redistribute it under certain conditions; type 'show c' for details."},{"path":[]},{"path":"https://chjackson.github.io/survextrap/news/news-0.1.html","id":"changes-0-1","dir":"News","previous_headings":"survextrap version 0.1","what":"Changes","title":"Version 0.1","text":"See commit messages GitHub history developments survextrap.","code":""},{"path":"https://chjackson.github.io/survextrap/news/news-0.8.html","id":"survextrap-version-08","dir":"News","previous_headings":"","what":"survextrap version 0.8","title":"Version 0.8","text":"GitHub commit ?? implemented several changes listed . survextrap now “beta” status. major features now implemented, may still lack polish.","code":""},{"path":"https://chjackson.github.io/survextrap/news/news-0.8.html","id":"new-features-0-8","dir":"News","previous_headings":"survextrap version 0.8","what":"New features","title":"Version 0.8","text":"new vignette cetuximab, giving -depth case study realistic use survextrap. included forthcoming paper. Improvements usability stability M-splines: iknots bknots replaced single knots, lower boundary knot always fixed zero. add_knots can used add user-defined knots default ones. See case study. New function mspline_spec define M-spline knots based data, advance fitting models. M-splines can now smoother final knot option bsmooth. Thanks Iain Timmins suggestion. Incremental restricted mean survival time (irmst) added. summary posterior distribution can produced supplying list summary functions (e.g. mean, quantiles) output functions (rmst survival).","code":""},{"path":"https://chjackson.github.io/survextrap/news/news-0.8.html","id":"bug-fixes-and-improvements-0-8","dir":"News","previous_headings":"survextrap version 0.8","what":"Bug fixes and improvements","title":"Version 0.8","text":"Bug fixes hazard() hsurvmspline(), using wrong tail end psurvmspline(). Waning models longer ignore non-proportional hazards cure. Waning vignette merged methods vignette. information given printing fitted model objects. consistent naming arguments variables (e.g. hscale hazard scale, hsd hazard smoothing parameter). Thorough documentation polishing code tidying.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/cetux.html","id":null,"dir":"Reference","previous_headings":"","what":"Datasets for evaluation of cetuximab in head and neck cancer — cetux","title":"Datasets for evaluation of cetuximab in head and neck cancer — cetux","text":"Datasets evaluation cetuximab head neck cancer, previously analysed Guyot et al. (2017) demonstrate models survival extrapolation Bayesian evidence synthesis.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/cetux.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Datasets for evaluation of cetuximab in head and neck cancer — cetux","text":"","code":"cetux  cetux_seer  cetux_bh"},{"path":"https://chjackson.github.io/survextrap/reference/cetux.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Datasets for evaluation of cetuximab in head and neck cancer — cetux","text":"cetux contains synthetic individual-level survival data, generated (using method Guyot et al 2012) consistent Kaplan-Meier estimates survival published Bonner et al. (2006). Columns months, years, give survival months years since date diagnosis head neck cancer. d numeric vector 0 indicates censoring, 1 indicates death time.  treat factor indicating treatment group (Cetuximab Control); groups also received radiotherapy. cetux_seer Estimates conditional survival registry data, matched Bonner trial population age, gender, cancer site, date diagnosis. \"Surveillance Epidemiology End Results\" (SEER) database. line gives counts r survivors stop years, given n people alive start.  haz corresponding constant hazard estimate period, computed -log(r/n). also 95% interval estimates hazard based data one period time, derived Bayesian principles -log(qbeta(c(0.975, 0.025), r, n-r)). cetux_bh Mortality rates population USA, matched age sex patients Bonner trial. 80% male, median age 57 (range 34 83).  Hence \\(\\)th row weighted average male female mortality rates age \\(57 + - 1\\). See Guyot et al. (2017) details . object class data.frame 424 rows 4 columns. object class data.frame 21 rows 8 columns. object class data.frame 54 rows 2 columns.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/cetux.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Datasets for evaluation of cetuximab in head and neck cancer — cetux","text":"Guyot, P., Ades, .E., Beasley, M., Lueza, B., Pignon, J.P. Welton, N.J., (2017). Extrapolation survival curves cancer trials using external information. Medical Decision Making, 37(4), pp.353-366. Bonner, J.., Harari, P.M., Giralt, J., Azarnia, N., Shin, D.M., Cohen, R.B., Jones, C.U., Sur, R., Raben, D., Jassem, J. Ove, R., (2006) Radiotherapy plus cetuximab squamous-cell carcinoma head neck. New England Journal Medicine, 354(6), pp.567-578. Guyot, P., Ades, .E., Ouwens, M.J. Welton, N.J., (2012) Enhanced secondary analysis survival data: reconstructing data published Kaplan-Meier survival curves. BMC Medical Research Methodology, 12, pp.1-13.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/colons.html","id":null,"dir":"Reference","previous_headings":"","what":"Colon cancer survival data — colons","title":"Colon cancer survival data — colons","text":"Survival times 191 patients trial chemotherapy colon cancer.  data provided survival package colon, restricted outcome recurrence-free survival, artificially censored 3 years, taking 20% random sample.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/colons.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Colon cancer survival data — colons","text":"","code":"colons"},{"path":"https://chjackson.github.io/survextrap/reference/colons.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Colon cancer survival data — colons","text":"Documented colon.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/colons.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Colon cancer survival data — colons","text":"See colon.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/colons.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Colon cancer survival data — colons","text":"See colon.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/cumhaz.html","id":null,"dir":"Reference","previous_headings":"","what":"Estimates of cumulative hazard from a survextrap model — cumhaz","title":"Estimates of cumulative hazard from a survextrap model — cumhaz","text":"Estimates cumulative hazard particular times, survextrap model","code":""},{"path":"https://chjackson.github.io/survextrap/reference/cumhaz.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Estimates of cumulative hazard from a survextrap model — cumhaz","text":"","code":"cumhaz(   x,   newdata = NULL,   t = NULL,   tmax = NULL,   niter = NULL,   summ_fns = NULL,   sample = FALSE,   newdata0 = NULL,   wane_period = NULL,   wane_nt = 10 )"},{"path":"https://chjackson.github.io/survextrap/reference/cumhaz.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Estimates of cumulative hazard from a survextrap model — cumhaz","text":"x fitted model object returned survextrap newdata Data frame covariate values compute output . covariates model supplied, following default used: () covariate one factor variable, output computed level factor. (b) multiple covariates, numeric covariates, output computed mean numeric covariate original data, baseline level factor covariate. Note: caution required treatment groups (example) stored data.  coded numeric (0/1), newdata specified, one output shown. relates average value numeric variable data, correspond either treatment groups.  avoid , treatment group stored factor. t Vector times compute estimates. tmax Maximum time compute estimates.  t supplied, ignored.  t supplied, t set set 100 equally spaced time points 0 tmax.  tmax t supplied, tmax set maximum follow time data. niter Number MCMC iterations use compute credible intervals.  Set low value make function quicker, cost approximation error (may important plotting model development). summ_fns list functions use summarise posterior sample. passed posterior::summarise_draws. default list(median=median, ~quantile(.x, probs=c(0.025, 0.975))). list named, names used columns output. sample TRUE MCMC samples returned instead summarised median 95% credible intervals. newdata0 Data frame covariate values defining \"untreated\" group use treatment waning models. See Survmspline_wane. wane_period Vector two numbers, defining time period hazard interpolated hazard \"treated\" group (taken newdata) hazard \"untreated\" group (taken newdata0).  Optional - supplied, waning assumed. wane_nt Number intervals defining piecewise constant approximation hazard waning period.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/cumhaz.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Estimates of cumulative hazard from a survextrap model — cumhaz","text":"data frame (tibble) giving posterior summary statistics, (sample=TRUE) array giving samples posterior.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/curedata.html","id":null,"dir":"Reference","previous_headings":"","what":"Simulated data for testing mixture cure models — curedata","title":"Simulated data for testing mixture cure models — curedata","text":"Survival times 200 fake people.  cure probability 0.5 x=0, log odds ratio cure 0.5, cure probability 0.62 x=1.  uncured population survival times distributed Weibull shape 1.5 scale 1.2.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/curedata.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Simulated data for testing mixture cure models — curedata","text":"","code":"curedata"},{"path":"https://chjackson.github.io/survextrap/reference/curedata.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Simulated data for testing mixture cure models — curedata","text":"t Survival times, right-censored 10 years. status. 1 observed death 0 censoring. x. numeric variable value 0 100 individuals, 1 100.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/curedata.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Simulated data for testing mixture cure models — curedata","text":"Simulated.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/get_cum_backhaz.html","id":null,"dir":"Reference","previous_headings":"","what":"Cumulative background hazards — get_cum_backhaz","title":"Cumulative background hazards — get_cum_backhaz","text":"Obtain cumulative hazard particular time, given data frame piecewise-constant background hazards.  used computation likelihoods results additive hazards models.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/get_cum_backhaz.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Cumulative background hazards — get_cum_backhaz","text":"","code":"get_cum_backhaz(t, backhaz, strata = NULL)"},{"path":"https://chjackson.github.io/survextrap/reference/get_cum_backhaz.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Cumulative background hazards — get_cum_backhaz","text":"t time point, vector time points, calculate cumulative hazard . backhaz data frame two columns, named \"time\" \"hazard\". row gives \"background\" hazard specified time next time. strata vector length t indicating strata. column backhaz named stratum, factor levels strata (analogous character vector). row backhaz indicating background hazard time interval stratum strata. assume background hazard known times, defined piecewise-constant function (step function) time. first element \"time\" 0, final row specifies hazard times greater last element \"time\". additive hazards models, background hazard hazard death causes specific cause interest. overall hazard defined sum background hazard cause-specific hazard.  survextrap, cause-specific hazard modelled M-spline model, background hazard assumed known.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/get_cum_backhaz.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Cumulative background hazards — get_cum_backhaz","text":"cumulative hazard t.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/get_draws.html","id":null,"dir":"Reference","previous_headings":"","what":"Posterior draws from a survextrap model — get_draws","title":"Posterior draws from a survextrap model — get_draws","text":"Return matrix draws posterior distribution parameters survextrap model, chains collapsed.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/get_draws.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Posterior draws from a survextrap model — get_draws","text":"","code":"get_draws(x)"},{"path":"https://chjackson.github.io/survextrap/reference/get_draws.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Posterior draws from a survextrap model — get_draws","text":"x fitted model object returned survextrap","code":""},{"path":"https://chjackson.github.io/survextrap/reference/get_draws.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Posterior draws from a survextrap model — get_draws","text":"matrix draws draws_matrix format posterior package.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/hazard.html","id":null,"dir":"Reference","previous_headings":"","what":"Estimates of hazard from a survextrap model — hazard","title":"Estimates of hazard from a survextrap model — hazard","text":"Estimates hazard function particular times, survextrap model","code":""},{"path":"https://chjackson.github.io/survextrap/reference/hazard.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Estimates of hazard from a survextrap model — hazard","text":"","code":"hazard(   x,   newdata = NULL,   t = NULL,   tmax = NULL,   niter = NULL,   summ_fns = NULL,   sample = FALSE,   newdata0 = NULL,   wane_period = NULL,   wane_nt = 10 )"},{"path":"https://chjackson.github.io/survextrap/reference/hazard.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Estimates of hazard from a survextrap model — hazard","text":"x fitted model object returned survextrap newdata Data frame covariate values compute output . covariates model supplied, following default used: () covariate one factor variable, output computed level factor. (b) multiple covariates, numeric covariates, output computed mean numeric covariate original data, baseline level factor covariate. Note: caution required treatment groups (example) stored data.  coded numeric (0/1), newdata specified, one output shown. relates average value numeric variable data, correspond either treatment groups.  avoid , treatment group stored factor. t Vector times compute estimates. tmax Maximum time compute estimates.  t supplied, ignored.  t supplied, t set set 100 equally spaced time points 0 tmax.  tmax t supplied, tmax set maximum follow time data. niter Number MCMC iterations use compute credible intervals.  Set low value make function quicker, cost approximation error (may important plotting model development). summ_fns list functions use summarise posterior sample. passed posterior::summarise_draws. default list(median=median, ~quantile(.x, probs=c(0.025, 0.975))). list named, names used columns output. sample TRUE MCMC samples returned instead summarised median 95% credible intervals. newdata0 Data frame covariate values defining \"untreated\" group use treatment waning models. See Survmspline_wane. wane_period Vector two numbers, defining time period hazard interpolated hazard \"treated\" group (taken newdata) hazard \"untreated\" group (taken newdata0).  Optional - supplied, waning assumed. wane_nt Number intervals defining piecewise constant approximation hazard waning period.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/hazard.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Estimates of hazard from a survextrap model — hazard","text":"data frame (tibble) giving posterior summary statistics, (sample=TRUE) array giving samples posterior.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/hazard_ratio.html","id":null,"dir":"Reference","previous_headings":"","what":"Hazard ratio against time in a survextrap model — hazard_ratio","title":"Hazard ratio against time in a survextrap model — hazard_ratio","text":"Compute hazard ratio series time points, estimated survextrap model.  Intended use non-proportional hazards models (survextrap(...,nonprop=TRUE)).  proportional hazards models (survextrap fits default) hazard ratio constant time.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/hazard_ratio.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Hazard ratio against time in a survextrap model — hazard_ratio","text":"","code":"hazard_ratio(   x,   newdata = NULL,   t = NULL,   tmax = NULL,   niter = NULL,   summ_fns = NULL,   sample = FALSE )"},{"path":"https://chjackson.github.io/survextrap/reference/hazard_ratio.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Hazard ratio against time in a survextrap model — hazard_ratio","text":"x fitted model object returned survextrap newdata data frame two rows.  hazard ratio defined hazard(second row) divided hazard(first row). covariate model factor two levels, newdata defaults data frame containing levels factor, hazard ratio second level versus first level computed.  models, newdata must supplied explicitly. t Vector times compute estimates. tmax Maximum time compute estimates.  t supplied, ignored.  t supplied, t set set 100 equally spaced time points 0 tmax.  tmax t supplied, tmax set maximum follow time data. niter Number MCMC iterations use compute credible intervals.  Set low value make function quicker, cost approximation error (may important plotting model development). summ_fns list functions use summarise posterior sample. passed posterior::summarise_draws. default list(median=median, ~quantile(.x, probs=c(0.025, 0.975))). list named, names used columns output. sample TRUE MCMC samples returned instead summarised median 95% credible intervals.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/hazard_ratio.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Hazard ratio against time in a survextrap model — hazard_ratio","text":"data frame (tibble) row containing posterior summary statistics different times. sample=TRUE, array dimensions length(t), niter, 1, giving incremental RMST evaluated different times MCMC iterations respectively.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/hrtime.html","id":null,"dir":"Reference","previous_headings":"","what":"Hazard ratio between high and low values of the hazard over time — hrtime","title":"Hazard ratio between high and low values of the hazard over time — hrtime","text":"intended intuitive single-number measure much hazard function changes time.  hazard computed equally-spaced fine grid boundary knots.  ratio \"high\" \"low\" one hazard values computed. example, hazard constant time, hazard ratio 1.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/hrtime.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Hazard ratio between high and low values of the hazard over time — hrtime","text":"","code":"hrtime(   x,   newdata = NULL,   niter = NULL,   summ_fns = NULL,   hq = c(0.1, 0.9),   sample = FALSE )"},{"path":"https://chjackson.github.io/survextrap/reference/hrtime.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Hazard ratio between high and low values of the hazard over time — hrtime","text":"x fitted model object returned survextrap newdata Data frame covariate values compute output . covariates model supplied, following default used: () covariate one factor variable, output computed level factor. (b) multiple covariates, numeric covariates, output computed mean numeric covariate original data, baseline level factor covariate. Note: caution required treatment groups (example) stored data.  coded numeric (0/1), newdata specified, one output shown. relates average value numeric variable data, correspond either treatment groups.  avoid , treatment group stored factor. niter Number MCMC iterations use compute credible intervals.  Set low value make function quicker, cost approximation error (may important plotting model development). summ_fns list functions use summarise posterior sample. passed posterior::summarise_draws. default list(median=median, ~quantile(.x, probs=c(0.025, 0.975))). list named, names used columns output. hq Quantiles define \"low\" \"high\" values time-varying quantity (hazard prior_haz_sd hazard ratio prior_hr_sd).  ratio high low values summarised, measure time-dependence.  default, c(0.1, 0.9), 10% 90% quantiles used respectively. sample TRUE MCMC samples returned instead summarised median 95% credible intervals.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/hrtime.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Hazard ratio between high and low values of the hazard over time — hrtime","text":"summary posterior distribution hazard ratio fitted model, data frame one row per covariate value requested newdata, one column posterior summary statistic. sample=TRUE, array dimensions 1, niter, nrow(newdata), giving incremental RMST evaluated different MCMC iterations covariate values respectively.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/irmst.html","id":null,"dir":"Reference","previous_headings":"","what":"Incremental restricted mean survival time — irmst","title":"Incremental restricted mean survival time — irmst","text":"Compute difference restricted mean survival times two covariate values (e.g. treatment groups).","code":""},{"path":"https://chjackson.github.io/survextrap/reference/irmst.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Incremental restricted mean survival time — irmst","text":"","code":"irmst(   x,   t,   newdata = NULL,   newdata0 = NULL,   wane_period = NULL,   wane_nt = 10,   niter = NULL,   summ_fns = NULL,   sample = FALSE,   disc_rate = 0,   method = \"gl\",   gl_nodes = 100 )"},{"path":"https://chjackson.github.io/survextrap/reference/irmst.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Incremental restricted mean survival time — irmst","text":"x fitted model object returned survextrap t Vector times.  restricted mean survival time one times computed. newdata data frame two rows.  result restricted mean covariates second row, minus restricted mean covariates first row.  newdata omitted models covariate factor two levels, taken levels.  Otherwise newdata must supplied explicitly. newdata0 Data frame covariate values defining \"untreated\" group use treatment waning models. See Survmspline_wane. wane_period Vector two numbers, defining time period hazard interpolated hazard \"treated\" group (taken newdata) hazard \"untreated\" group (taken newdata0).  Optional - supplied, waning assumed. wane_nt Number intervals defining piecewise constant approximation hazard waning period. niter Number MCMC iterations use compute credible intervals.  Set low value make function quicker, cost approximation error (may important plotting model development). summ_fns list functions use summarise posterior sample. passed posterior::summarise_draws. default list(median=median, ~quantile(.x, probs=c(0.025, 0.975))). list named, names used columns output. sample TRUE MCMC sample returned posterior output, rather summary statistics. disc_rate Discounting rate used calculate discounted mean restricted mean survival time, using exponential discounting function. method Method numerical integration obtain restricted mean survival time survival function. default method=\"gl\", Gauss-Legendre method 100 nodes zero maximum t. method=\"adaptive\" uses base R integrate function, much slower, potentially robust badly-behaved survival functions. gl_nodes Number nodes Gauss-Legendre method.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/irmst.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Incremental restricted mean survival time — irmst","text":"data frame (tibble) row containing posterior summary statistics particular time covariate value. sample=TRUE, array dimensions length(t), niter, nrow(newdata), giving incremental RMST evaluated different times, MCMC iterations covariate values respectively.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/irmst.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Incremental restricted mean survival time — irmst","text":"posterior distribution obtained calling rmst group, obtaining posterior sample \"sample\" attribute, taking difference get posterior sample difference.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mean.survextrap.html","id":null,"dir":"Reference","previous_headings":"","what":"Mean survival time — mean.survextrap","title":"Mean survival time — mean.survextrap","text":"Compute mean survival time model fitted survextrap.  Defined integral fitted survival curve zero infinity.  relies numerical integration, done every parameter MCMC sample, may slow.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mean.survextrap.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Mean survival time — mean.survextrap","text":"","code":"# S3 method for class 'survextrap' mean(   x,   newdata = NULL,   newdata0 = NULL,   wane_period = NULL,   wane_nt = 10,   disc_rate = 0,   niter = NULL,   summ_fns = NULL,   sample = FALSE,   ... )"},{"path":"https://chjackson.github.io/survextrap/reference/mean.survextrap.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Mean survival time — mean.survextrap","text":"x fitted model object returned survextrap newdata Data frame covariate values compute output . covariates model supplied, following default used: () covariate one factor variable, output computed level factor. (b) multiple covariates, numeric covariates, output computed mean numeric covariate original data, baseline level factor covariate. Note: caution required treatment groups (example) stored data.  coded numeric (0/1), newdata specified, one output shown. relates average value numeric variable data, correspond either treatment groups.  avoid , treatment group stored factor. newdata0 Data frame covariate values defining \"untreated\" group use treatment waning models. See Survmspline_wane. wane_period Vector two numbers, defining time period hazard interpolated hazard \"treated\" group (taken newdata) hazard \"untreated\" group (taken newdata0).  Optional - supplied, waning assumed. wane_nt Number intervals defining piecewise constant approximation hazard waning period. disc_rate Discounting rate used calculate discounted mean restricted mean survival time, using exponential discounting function. niter Number MCMC iterations use compute credible intervals.  Set low value make function quicker, cost approximation error (may important plotting model development). summ_fns list functions use summarise posterior sample. passed posterior::summarise_draws. default list(median=median, ~quantile(.x, probs=c(0.025, 0.975))). list named, names used columns output. sample TRUE MCMC sample returned posterior output, rather summary statistics. ... options (currently unused).","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mean.survextrap.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Mean survival time — mean.survextrap","text":"data frame row containing posterior summary statistics particular covariate value. attribute \"sample\" also returned, containing matrix samples posterior distribution RMST.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mean.survextrap.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Mean survival time — mean.survextrap","text":"Additionally models, integration infinity may converge, giving error message.  typically occurs substantial probability high survival times zero hazards later times.  restricted mean survival time can usually computed situations rmst, model also investigated ensure posterior distributions realistic, simplified supplemented external data informative priors appropriate.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/msplinemodel_init.html","id":null,"dir":"Reference","previous_headings":"","what":"Create an M-spline survival model, both structure and parameters. — msplinemodel_init","title":"Create an M-spline survival model, both structure and parameters. — msplinemodel_init","text":"mspline_init first used create M-spline model structure, including knot positions.  Parameters including basis coefficients scale either supplied set default defines constant hazard model.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/msplinemodel_init.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Create an M-spline survival model, both structure and parameters. — msplinemodel_init","text":"","code":"msplinemodel_init(   df = 10,   degree = 3,   bsmooth = TRUE,   knots = NULL,   bknot = 10,   obstimes = NULL,   coefs = NULL,   hscale = 1 )"},{"path":"https://chjackson.github.io/survextrap/reference/msplinemodel_init.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Create an M-spline survival model, both structure and parameters. — msplinemodel_init","text":"df Desired number basis terms, \"degrees freedom\" spline.  knots supplied, number knots chosen satisfy . degree Spline polynomial degree.  Can changed default 3 bsmooth FALSE. bsmooth TRUE function constrained also zero derivative second derivative boundary. knots Vector knot locations. supplied, df specified.  One two rules used choose knot locations.  bknot specified, set equally spaced knots zero bknot used.  Otherwise obstimes supplied, knots chosen equally spaced quantiles obstimes. number knots (excluding zero) df - degree + 1 bsmooth TRUE, df - degree - 1 otherwise. bknot Location final spline knot. obstimes Vector observation times whose quantiles used choose knot locations coefs Basis coefficients hscale Hazard scale parameter","code":""},{"path":"https://chjackson.github.io/survextrap/reference/msplinemodel_init.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Create an M-spline survival model, both structure and parameters. — msplinemodel_init","text":"list defining M-spline, omitted list components set defaults.  See mspline_init details.  parameters included coefs hscale components.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/msplinemodel_init.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Create an M-spline survival model, both structure and parameters. — msplinemodel_init","text":"function fitting models data, setting theoretical M-spline model illustration.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_args.html","id":null,"dir":"Reference","previous_headings":"","what":"Documentation for arguments used in illustration of M-splines — mspline_args","title":"Documentation for arguments used in illustration of M-splines — mspline_args","text":"Documentation arguments used illustration M-splines","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_args.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Documentation for arguments used in illustration of M-splines — mspline_args","text":"knots Vector knot locations. supplied, df specified, case default set equally spaced knots zero highest knot.  number knots (excluding zero) df - degree + 1 bsmooth TRUE, df - degree - 1 otherwise. bknot Location highest knot. degree Spline polynomial degree.  Can changed default 3 bsmooth FALSE. df Desired number basis terms, \"degrees freedom\" spline.  knots supplied, number knots chosen satisfy . bsmooth TRUE function constrained also zero derivative second derivative boundary.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_basis.html","id":null,"dir":"Reference","previous_headings":"","what":"Evaluate an M-spline basis matrix at the specified times. — mspline_basis","title":"Evaluate an M-spline basis matrix at the specified times. — mspline_basis","text":"Evaluate M-spline basis matrix specified times. Extrapolation beyond boundary knots done assuming basis term constant beyond boundary.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_basis.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Evaluate an M-spline basis matrix at the specified times. — mspline_basis","text":"","code":"mspline_basis(times, knots, degree = 3, integrate = FALSE, bsmooth = TRUE)"},{"path":"https://chjackson.github.io/survextrap/reference/mspline_basis.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Evaluate an M-spline basis matrix at the specified times. — mspline_basis","text":"times numeric vector times evaluate basis. knots Spline knots degree Spline degree integrate TRUE, integrated M-spline (-spline) basis returned. bsmooth TRUE function constrained also zero derivative second derivative boundary, improves smoothness boundary.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_basis.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Evaluate an M-spline basis matrix at the specified times. — mspline_basis","text":"two-dimensional array.  Rows times, columns basis terms.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_basis.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Evaluate an M-spline basis matrix at the specified times. — mspline_basis","text":"lower boundary fixed zero, basis term assumed zero times less zero, since models used hazard functions survival data.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_basis.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Evaluate an M-spline basis matrix at the specified times. — mspline_basis","text":"splines2 package used.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_constant_coefs.html","id":null,"dir":"Reference","previous_headings":"","what":"Determine M-spline basis coefficients which give a constant function. — mspline_constant_coefs","title":"Determine M-spline basis coefficients which give a constant function. — mspline_constant_coefs","text":"works obtaining coefficients corresponding B-spline basis, equal B-spline constant function.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_constant_coefs.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Determine M-spline basis coefficients which give a constant function. — mspline_constant_coefs","text":"","code":"mspline_constant_coefs(mspline, logit = FALSE)"},{"path":"https://chjackson.github.io/survextrap/reference/mspline_constant_coefs.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Determine M-spline basis coefficients which give a constant function. — mspline_constant_coefs","text":"mspline list components knots (vector knots), degree (polynomial degree) bsmooth (logical smoothness constraint boundary), defining M-spline configuration. logit TRUE multinomial logit transform coefficients returned.  vector length one less number coefficients, rth element defined \\(log(coefs[r+1] / coefs[1])\\).","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_constant_coefs.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Determine M-spline basis coefficients which give a constant function. — mspline_constant_coefs","text":"numeric vector coefficients.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_constant_coefs.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Determine M-spline basis coefficients which give a constant function. — mspline_constant_coefs","text":"Ramsay, J. O. (1988). Monotone regression splines action. Statistical Science, 3(4): 425-441.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_constant_weights.html","id":null,"dir":"Reference","previous_headings":"","what":"Determine M-spline basis weights which give a constant function. — mspline_constant_weights","title":"Determine M-spline basis weights which give a constant function. — mspline_constant_weights","text":"works transforming weights corresponding B-spline basis, equal B-spline constant function.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_constant_weights.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Determine M-spline basis weights which give a constant function. — mspline_constant_weights","text":"","code":"mspline_constant_weights(mspline, logit = FALSE)"},{"path":"https://chjackson.github.io/survextrap/reference/mspline_constant_weights.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Determine M-spline basis weights which give a constant function. — mspline_constant_weights","text":"mspline list components knots (vector knots), degree (polynomial degree) defining M-spline configuration. logit TRUE multinomial logit transform coefficients returned.  vector length one less number coefficients, rth element defined \\(log(coefs[r+1] / coefs[1])\\).","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_constant_weights.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Determine M-spline basis weights which give a constant function. — mspline_constant_weights","text":"Ramsay, J. O. (1988). Monotone regression splines action. Statistical Science, 3(4): 425-441.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_init.html","id":null,"dir":"Reference","previous_headings":"","what":"Create a default M-spline model structure — mspline_init","title":"Create a default M-spline model structure — mspline_init","text":"Create default M-spline model structure","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_init.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Create a default M-spline model structure — mspline_init","text":"","code":"mspline_init(   df = 10,   degree = 3,   bsmooth = TRUE,   knots = NULL,   bknot = 10,   obstimes = NULL )"},{"path":"https://chjackson.github.io/survextrap/reference/mspline_init.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Create a default M-spline model structure — mspline_init","text":"df Desired number basis terms, \"degrees freedom\" spline.  knots supplied, number knots chosen satisfy . degree Spline polynomial degree.  Can changed default 3 bsmooth FALSE. bsmooth TRUE function constrained also zero derivative second derivative boundary. knots Vector knot locations. supplied, df specified.  One two rules used choose knot locations.  bknot specified, set equally spaced knots zero bknot used.  Otherwise obstimes supplied, knots chosen equally spaced quantiles obstimes. number knots (excluding zero) df - degree + 1 bsmooth TRUE, df - degree - 1 otherwise. bknot Location final spline knot. obstimes Vector observation times whose quantiles used choose knot locations","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_init.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Create a default M-spline model structure — mspline_init","text":"list fundamental components knots, degree, bsmooth, documented . component df also included, derived consequence fundamental components. basis_means gives \"mean\" basis term (.e. mean random variable whose probability density function given basis function) basis_spans sqrt_wt quantities used construction random walk prior distributions basis coefficients (following https://arxiv.org/abs/2401.12640 https://arxiv.org/abs/2201.06808).","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_list_init.html","id":null,"dir":"Reference","previous_headings":"","what":"Validate an M-spline object supplied as a list, choosing defaults if needed. — mspline_list_init","title":"Validate an M-spline object supplied as a list, choosing defaults if needed. — mspline_list_init","text":"Validate M-spline object supplied list, choosing defaults needed.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_list_init.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Validate an M-spline object supplied as a list, choosing defaults if needed. — mspline_list_init","text":"","code":"mspline_list_init(mspline, obstimes = NULL)"},{"path":"https://chjackson.github.io/survextrap/reference/mspline_list_init.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Validate an M-spline object supplied as a list, choosing defaults if needed. — mspline_list_init","text":"mspline list none following components: df, degree, bsmooth, knots, bknot, documented mspline_init. obstimes Vector observation times whose quantiles used choose knot locations","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_list_init.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Validate an M-spline object supplied as a list, choosing defaults if needed. — mspline_list_init","text":"list defining M-spline, omitted list components set defaults.  See mspline_init details. mspline$knots supplied, giving knot locations, either mspline$bknot obstimes must specified, default locations can obtained.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_plotdata.html","id":null,"dir":"Reference","previous_headings":"","what":"Data for plotting an M-spline function, showing how it is built up from its basis — mspline_plotdata","title":"Data for plotting an M-spline function, showing how it is built up from its basis — mspline_plotdata","text":"Data plotting M-spline function, showing built basis","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_plotdata.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Data for plotting an M-spline function, showing how it is built up from its basis — mspline_plotdata","text":"","code":"mspline_plotdata(   knots = NULL,   bknot = 10,   df = 10,   degree = 3,   bsmooth = TRUE,   coefs = NULL,   scale = 1,   tmin = 0,   tmax = 10 )"},{"path":"https://chjackson.github.io/survextrap/reference/mspline_plotdata.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Data for plotting an M-spline function, showing how it is built up from its basis — mspline_plotdata","text":"knots Vector knot locations. supplied, df specified.  One two rules used choose knot locations.  bknot specified, set equally spaced knots zero bknot used.  Otherwise obstimes supplied, knots chosen equally spaced quantiles obstimes. number knots (excluding zero) df - degree + 1 bsmooth TRUE, df - degree - 1 otherwise. bknot Location final spline knot. df Desired number basis terms, \"degrees freedom\" spline.  knots supplied, number knots chosen satisfy . degree Spline polynomial degree.  Can changed default 3 bsmooth FALSE. bsmooth TRUE function constrained also zero derivative second derivative boundary. coefs Coefficients spline basis terms.  normalised internally sum 1, already sum 1. scale Scale parameter. computing standard M-spline function weighted sum basis terms, function multiplied scale.   log scale parameter called alpha results survextrap model, intercept linear model log hazard. tmin Minimum plotting time.  Defaults zero. tmax Maximum plotting time.  Defaults highest knot.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_plotdata.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Data for plotting an M-spline function, showing how it is built up from its basis — mspline_plotdata","text":"data frame values hazard different times different basis functions.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_plotsetup.html","id":null,"dir":"Reference","previous_headings":"","what":"Get basis for an illustration of an M-spline with given knots. — mspline_plotsetup","title":"Get basis for an illustration of an M-spline with given knots. — mspline_plotsetup","text":"Get basis illustration M-spline given knots.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_plotsetup.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get basis for an illustration of an M-spline with given knots. — mspline_plotsetup","text":"","code":"mspline_plotsetup(   knots,   bknot = 10,   tmin = NULL,   tmax = NULL,   degree = 3,   df = 10,   bsmooth = TRUE )"},{"path":"https://chjackson.github.io/survextrap/reference/mspline_plotsetup.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Get basis for an illustration of an M-spline with given knots. — mspline_plotsetup","text":"knots Vector knot locations. supplied, df specified.  One two rules used choose knot locations.  bknot specified, set equally spaced knots zero bknot used.  Otherwise obstimes supplied, knots chosen equally spaced quantiles obstimes. number knots (excluding zero) df - degree + 1 bsmooth TRUE, df - degree - 1 otherwise. bknot Location final spline knot. tmin Minimum plotting time.  Defaults zero. tmax Maximum plotting time.  Defaults highest knot. degree Spline polynomial degree.  Can changed default 3 bsmooth FALSE. df Desired number basis terms, \"degrees freedom\" spline.  knots supplied, number knots chosen satisfy . bsmooth TRUE function constrained also zero derivative second derivative boundary.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_plotsetup.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Get basis for an illustration of an M-spline with given knots. — mspline_plotsetup","text":"Data frame containing basis, returned mspline_basis.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_priorpred.html","id":null,"dir":"Reference","previous_headings":"","what":"Generate and/or plot a sample from the prior distribution of M-spline hazard curves — mspline_priorpred","title":"Generate and/or plot a sample from the prior distribution of M-spline hazard curves — mspline_priorpred","text":"Generates /plots hazard curves (functions time) implied prior mean spline coefficients (constant hazard default) particular priors baseline log hazard smoothness standard deviation.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_priorpred.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Generate and/or plot a sample from the prior distribution of M-spline hazard curves — mspline_priorpred","text":"","code":"mspline_priorpred(   knots = NULL,   df = 10,   degree = 3,   bsmooth = TRUE,   coefs_mean = NULL,   prior_hsd = p_gamma(2, 1),   prior_hscale = NULL,   prior_loghr = NULL,   X = NULL,   X0 = NULL,   prior_hrsd = NULL,   tmin = 0,   tmax = 10,   nsim = 10 )  plot_mspline_priorpred(   knots = NULL,   df = 10,   degree = 3,   coefs_mean = NULL,   prior_hsd = p_gamma(2, 1),   prior_hscale = p_normal(0, 20),   prior_loghr = NULL,   X = NULL,   prior_hrsd = p_gamma(2, 1),   tmin = 0,   tmax = NULL,   nsim = 10 )"},{"path":"https://chjackson.github.io/survextrap/reference/mspline_priorpred.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Generate and/or plot a sample from the prior distribution of M-spline hazard curves — mspline_priorpred","text":"knots Vector knot locations. supplied, df specified, case default set equally spaced knots zero highest knot.  number knots (excluding zero) df - degree + 1 bsmooth TRUE, df - degree - 1 otherwise. df Desired number basis terms, \"degrees freedom\" spline.  knots supplied, number knots chosen satisfy . degree Spline polynomial degree.  Can changed default 3 bsmooth FALSE. bsmooth TRUE function constrained also zero derivative second derivative boundary. coefs_mean Spline basis coefficients define prior mean hazard function. default, set values define constant hazard function (see mspline_constant_coefs).  normalised sum 1 internally (already). prior_hsd Gamma prior standard deviation controls variability time (smoothness) hazard function.  call p_gamma().  default p_gamma(2,1).  See prior_haz_sd way calibrate represent meaningful belief. prior_hscale Prior baseline log hazard scale parameter (alpha log(eta)). call prior constructor function, p_normal(0,1) p_t(0,2,2).   Supported prior distribution families normal (parameters mean SD) t distributions (parameters location, scale degrees freedom).  default normal distribution mean 0 standard deviation 20. Note eta hazard, proportional hazard (see vignette full model specification). \"Baseline\" defined continuous covariates taking value zero factor covariates taking reference level.  use different baseline, data transformed appropriately beforehand, value zero different meaning.  continuous covariates, helps computation interpretation define value zero denote typical value data, e.g. mean. prior_loghr Priors log hazard ratios.  call p_normal() p_t().  list calls can also provided, give different priors different coefficients, name list component matches name coefficient, e.g. list(\"age45-59\" = p_normal(0,1), \"age60+\" = p_t(0,2,3)) default p_normal(0,2.5) coefficients. X Either list, vector one-row matrix, one value covariate model.  Defaults zero.  Factors must supplied multiple numeric (0/1) contrasts. multiple covariates single prior given prior_loghr, prior used covariates. list priors provided, list X must named names covariates. X0 alternative set \"reference\" covariate values (optional).  hazard ratio hazards X X0 also returned. prior_hrsd Prior standard deviation parameters smooth non-proportionality effects time non-proportional hazards models.  call p_gamma() list calls p_gamma() one component per covariate, prior_loghr.  See prior_hr_sd way calibrate represent meaningful belief. tmin Minimum plotting time.  Defaults zero. tmax Maximum plotting time.  Defaults highest knot. nsim Number simulations draw","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_priorpred.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Generate and/or plot a sample from the prior distribution of M-spline hazard curves — mspline_priorpred","text":"mspline_priorpred returns data frame samples, plot_mspline_priorpred generates plot.  customisation options provided plot function, just intended quick check.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_spec.html","id":null,"dir":"Reference","previous_headings":"","what":"Make default M-spline knot specification given a survival dataset. — mspline_spec","title":"Make default M-spline knot specification given a survival dataset. — mspline_spec","text":"Choose default M-spline knot locations given dataset desired number spline parameters.  Assumes cubic spline, knots based quantiles event times observed individual data.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_spec.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Make default M-spline knot specification given a survival dataset. — mspline_spec","text":"","code":"mspline_spec(   formula,   data,   cure = FALSE,   nonprop = NULL,   backhaz = NULL,   backhaz_strata = NULL,   external = NULL,   df = 10,   add_knots = NULL,   degree = 3,   bsmooth = TRUE )"},{"path":"https://chjackson.github.io/survextrap/reference/mspline_spec.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Make default M-spline knot specification given a survival dataset. — mspline_spec","text":"formula survival formula standard R formula syntax, call Surv() left hand side. Covariates included right hand side formula modelled proportional hazards, nonprop TRUE non-proportional hazards used. data omitted, model fitted external aggregate data alone, without individual data, formula include Surv() call.  left-hand side formula empty, right hand side specifies covariates usual.  example, formula = ~1 covariates. data Data frame containing variables formula. Variables data frame, working environment. may omitted, case external must supplied.  allows model fitted external aggregate data alone, without individual-level data. cure TRUE, mixture cure model used, \"uncured\" survival defined M-spline model, cure probability estimated. nonprop Non-proportional hazards model specification. achieved modelling spline basis coefficients terms covariates.  See methods vignette details. TRUE, covariates modelled non-proportional hazards, using model formula formula. formula, assumed define model dependence basis coefficients covariates. NULL FALSE (default) covariates modelled proportional hazards. backhaz Background hazard, , causes death cause interest. defines \"relative survival\" model overall hazard sum cause-specific hazard background hazard.  background hazard assumed known, cause-specific hazard modelled flexible parametric model. background hazard can supplied two forms.  meaning predictions model depends used. () data frame columns \"hazard\" \"time\", specifying background hazard times piecewise-constant (step) function.  row gives background hazard specified time next time.  first element \"time\" 0, final row specifies hazard times greater last element \"time\".  Predictions model fitted survextrap include background hazard, known times. (b) (quoted) name variable data giving background hazard.  censored cases, exact value matter.  predictions survextrap describe excess hazard survival top background.  overall hazard predicted general, background hazard specified limited range time. external data, backhaz supplied form (b), user also supply background survival start stop points columns external data named \"backsurv_start\" \"backsurv_stop\".  , probability survival times someone alive time 0. describe reference population backhaz, though package check consistency . stratifying variables specified backhaz_strata, multiple rows giving background hazard value time period stratifying variable. backhaz NULL (default) background hazard component included model. backhaz_strata character vector names variables appear backhaz indicate strata, e.g. backhaz_strata = c(\"agegroup\",\"sex\").  allows different background hazard values used different subgroups.  variables must also appear datasets modelled, , data, external .  row datasets corresponding row backhaz values stratifying variables. NULL default, indicating stratification background hazard. stratification done, backhaz must supplied form (), data frame rather variable data. external External data data frame aggregate survival counts columns named: start: Start time stop: Follow-time n: Number people alive start r: Number people still alive stop covariates formula, values take external data must supplied additional columns external.  Therefore external data, covariates formula data named start,stop,n r. df Desired number basis terms, \"degrees freedom\" spline.  knots supplied, number knots chosen satisfy . add_knots Additional knots, determined quantiles individual data. Typically used add maximum knot time want extrapolate . degree Spline polynomial degree.  Can changed default 3 bsmooth FALSE. bsmooth TRUE function constrained also zero derivative second derivative boundary.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_spec.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Make default M-spline knot specification given a survival dataset. — mspline_spec","text":"list components knots Knot locations.  number knots equal df + degree + 2. degree Spline polynomial degree (.e. 3) nvars Number basis variables (alias df)","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_spec.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Make default M-spline knot specification given a survival dataset. — mspline_spec","text":"also external data, based quantiles vector defined concatenating event times individual data unique start stop times external data. designed arguments survextrap.  intended use want fit set survextrap models spline specification. See also mspline_list_init mspline_init, lower-level interfaces, designed use without data, e.g. illustrating theoretical M-spline model.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_uniform_weights.html","id":null,"dir":"Reference","previous_headings":"","what":"Estimate M-spline basis weights which give a constant function. — mspline_uniform_weights","title":"Estimate M-spline basis weights which give a constant function. — mspline_uniform_weights","text":"works choosing basis coefficients minimise variance log hazard values different time points. used survextrap choose default prior mean hazard function.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/mspline_uniform_weights.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Estimate M-spline basis weights which give a constant function. — mspline_uniform_weights","text":"","code":"mspline_uniform_weights(   iknots,   bknots,   times = NULL,   degree = 3,   logit = FALSE )"},{"path":"https://chjackson.github.io/survextrap/reference/mspline_uniform_weights.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Estimate M-spline basis weights which give a constant function. — mspline_uniform_weights","text":"iknots Internal knots. bknots Boundary knots. times Times use construct numerical calculation. default, 20 equally-spaced times boundary knots. degree Spline polynomial degree. logit TRUE multinomial logit transform coefficients returned.  vector length one less number coefficients, rth element defined \\(log(coefs[r+1] / coefs[1])\\).","code":""},{"path":"https://chjackson.github.io/survextrap/reference/plot.survextrap.html","id":null,"dir":"Reference","previous_headings":"","what":"Plot method for survextrap model objects — plot.survextrap","title":"Plot method for survextrap model objects — plot.survextrap","text":"Intended quick check results model fit.   See plot_survival plot_hazard functions behind panel, survival hazard extract data plotted enable custom plots like .","code":""},{"path":"https://chjackson.github.io/survextrap/reference/plot.survextrap.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Plot method for survextrap model objects — plot.survextrap","text":"","code":"# S3 method for class 'survextrap' plot(x, type = \"hazsurv\", newdata = NULL, ...)"},{"path":"https://chjackson.github.io/survextrap/reference/plot.survextrap.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Plot method for survextrap model objects — plot.survextrap","text":"x fitted model object returned survextrap type \"survival\" plot survival function, \"hazard\" hazard function, time. newdata Data frame covariate values compute output . covariates model supplied, following default used: () covariate one factor variable, output computed level factor. (b) multiple covariates, numeric covariates, output computed mean numeric covariate original data, baseline level factor covariate. Note: caution required treatment groups (example) stored data.  coded numeric (0/1), newdata specified, one output shown. relates average value numeric variable data, correspond either treatment groups.  avoid , treatment group stored factor. ... Additional arguments, passed plot_hazard plot_survival.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/plot.survextrap.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Plot method for survextrap model objects — plot.survextrap","text":"ggplot2 plot object.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/plot_hazard.html","id":null,"dir":"Reference","previous_headings":"","what":"Plot hazard curves from a survextrap model — plot_hazard","title":"Plot hazard curves from a survextrap model — plot_hazard","text":"Plot hazard curves survextrap model.  function intended quick check fitted model, deliberately limited options customisation.  data behind plots can extracted hazard tidy data frame enable custom plots constructed ggplot2.  See case study vignette examples.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/plot_hazard.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Plot hazard curves from a survextrap model — plot_hazard","text":"","code":"plot_hazard(   x,   newdata = NULL,   t = NULL,   tmax = NULL,   niter = NULL,   newdata0 = NULL,   wane_period = NULL,   wane_nt = 10,   ci = NULL,   xlab = \"Time\",   ylab = \"Hazard\",   line_size = 1.5,   ci_alpha = 0.2,   show_knots = FALSE )"},{"path":"https://chjackson.github.io/survextrap/reference/plot_hazard.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Plot hazard curves from a survextrap model — plot_hazard","text":"x fitted model object returned survextrap newdata Data frame covariate values compute output . covariates model supplied, following default used: () covariate one factor variable, output computed level factor. (b) multiple covariates, numeric covariates, output computed mean numeric covariate original data, baseline level factor covariate. Note: caution required treatment groups (example) stored data.  coded numeric (0/1), newdata specified, one output shown. relates average value numeric variable data, correspond either treatment groups.  avoid , treatment group stored factor. t Vector times compute estimates. tmax Maximum time compute estimates.  t supplied, ignored.  t supplied, t set set 100 equally spaced time points 0 tmax.  tmax t supplied, tmax set maximum follow time data. niter Number MCMC iterations use compute credible intervals.  Set low value make function quicker, cost approximation error (may important plotting model development). newdata0 Data frame covariate values defining \"untreated\" group use treatment waning models. See Survmspline_wane. wane_period Vector two numbers, defining time period hazard interpolated hazard \"treated\" group (taken newdata) hazard \"untreated\" group (taken newdata0).  Optional - supplied, waning assumed. wane_nt Number intervals defining piecewise constant approximation hazard waning period. ci TRUE credible intervals drawn.  Defaults drawing intervals plot shows curve one covariate value. xlab X-axis label ylab Y-axis label line_size Passed geom_line ci_alpha Transparency credible interval ribbons show_knots Show locations spline knots vertical lines","code":""},{"path":"https://chjackson.github.io/survextrap/reference/plot_hazard.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Plot hazard curves from a survextrap model — plot_hazard","text":"ggplot2 plot object.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/plot_hazard.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Plot hazard curves from a survextrap model — plot_hazard","text":"model single factor covariate (excluding background hazard strata), curves produced level factor newdata requests (left default). Otherwise, single curve produced, illustrating corresponding output hazard.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/plot_hazard_ratio.html","id":null,"dir":"Reference","previous_headings":"","what":"Plot hazard ratio against time from a survextrap model — plot_hazard_ratio","title":"Plot hazard ratio against time from a survextrap model — plot_hazard_ratio","text":"use non-proportional hazards models (survextrap(...,nonprop=TRUE)).   Intended quick check model fit, limited customisation options. underlying data can extracted hazard_ratio.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/plot_hazard_ratio.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Plot hazard ratio against time from a survextrap model — plot_hazard_ratio","text":"","code":"plot_hazard_ratio(   x,   newdata = NULL,   t = NULL,   tmax = NULL,   niter = NULL,   ci = TRUE,   xlab = \"Time\",   ylab = \"Hazard ratio\",   line_size = 1.5,   ci_alpha = 0.2 )"},{"path":"https://chjackson.github.io/survextrap/reference/plot_hazard_ratio.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Plot hazard ratio against time from a survextrap model — plot_hazard_ratio","text":"x fitted model object returned survextrap newdata data frame two rows.  hazard ratio defined hazard(second row) divided hazard(first row). covariate model factor two levels, newdata defaults data frame containing levels factor, hazard ratio second level versus first level computed.  models, newdata must supplied explicitly. t Vector times compute estimates. tmax Maximum time compute estimates.  t supplied, ignored.  t supplied, t set set 100 equally spaced time points 0 tmax.  tmax t supplied, tmax set maximum follow time data. niter Number MCMC iterations use compute credible intervals.  Set low value make function quicker, cost approximation error (may important plotting model development). ci TRUE credible intervals drawn.  Defaults drawing intervals plot shows curve one covariate value. xlab X-axis label ylab Y-axis label line_size Passed geom_line ci_alpha Transparency credible interval ribbons","code":""},{"path":"https://chjackson.github.io/survextrap/reference/plot_hazard_ratio.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Plot hazard ratio against time from a survextrap model — plot_hazard_ratio","text":"ggplot2 plot object.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/plot_mspline.html","id":null,"dir":"Reference","previous_headings":"","what":"Plot a M-spline function, showing how it is built up from its basis — plot_mspline","title":"Plot a M-spline function, showing how it is built up from its basis — plot_mspline","text":"See mspline_plotdata data behind plot","code":""},{"path":"https://chjackson.github.io/survextrap/reference/plot_mspline.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Plot a M-spline function, showing how it is built up from its basis — plot_mspline","text":"","code":"plot_mspline(   knots = NULL,   bknot = 10,   df = 10,   degree = 3,   bsmooth = TRUE,   coefs = NULL,   scale = 1,   tmin = 0,   tmax = 10,   show_knots = FALSE,   show_means = FALSE )"},{"path":"https://chjackson.github.io/survextrap/reference/plot_mspline.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Plot a M-spline function, showing how it is built up from its basis — plot_mspline","text":"knots Vector knot locations. supplied, df specified.  One two rules used choose knot locations.  bknot specified, set equally spaced knots zero bknot used.  Otherwise obstimes supplied, knots chosen equally spaced quantiles obstimes. number knots (excluding zero) df - degree + 1 bsmooth TRUE, df - degree - 1 otherwise. bknot Location final spline knot. df Desired number basis terms, \"degrees freedom\" spline.  knots supplied, number knots chosen satisfy . degree Spline polynomial degree.  Can changed default 3 bsmooth FALSE. bsmooth TRUE function constrained also zero derivative second derivative boundary. coefs Coefficients spline basis terms.  normalised internally sum 1, already sum 1. scale Scale parameter. computing standard M-spline function weighted sum basis terms, function multiplied scale.   log scale parameter called alpha results survextrap model, intercept linear model log hazard. tmin Minimum plotting time.  Defaults zero. tmax Maximum plotting time.  Defaults highest knot. show_knots Show positions knots, including upper boundary show_means Show \"mean\" around basis term centred (defined mean random variable whose PDF defined basis term).","code":""},{"path":"https://chjackson.github.io/survextrap/reference/plot_mspline.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Plot a M-spline function, showing how it is built up from its basis — plot_mspline","text":"ggplot2 plot object.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/plot_mspline_priorpred.html","id":null,"dir":"Reference","previous_headings":"","what":"Generate a sample from the prior distribution of M-spline hazard curves implied by\r\na particular mean and variance for the baseline curve and scale parameter. — plot_mspline_priorpred","title":"Generate a sample from the prior distribution of M-spline hazard curves implied by\r\na particular mean and variance for the baseline curve and scale parameter. — plot_mspline_priorpred","text":"See vignette(\"methods\") information model.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/plot_mspline_priorpred.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Generate a sample from the prior distribution of M-spline hazard curves implied by\r\na particular mean and variance for the baseline curve and scale parameter. — plot_mspline_priorpred","text":"","code":"plot_mspline_priorpred(   iknots = NULL,   bknots = c(0, 10),   df = 10,   degree = 3,   prior_mean,   prior_sd = 1,   scale = 1,   scale_sd = 1,   tmin = 0,   tmax = 10,   nsim = 10,   plot = TRUE )"},{"path":"https://chjackson.github.io/survextrap/reference/plot_mspline_priorpred.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Generate a sample from the prior distribution of M-spline hazard curves implied by\r\na particular mean and variance for the baseline curve and scale parameter. — plot_mspline_priorpred","text":"iknots Internal knots.  supplied, df specified, case default df - degree - 1 equally spaced knots boundary knots. bknots Boundary knots.   Defaults c(0,10). df Desired number basis terms, \"degrees freedom\" spline. iknots supplied, number internal knots chosen satisfy . degree Spline polynomial degree. prior_mean Vector means logistic distributions. prior_sd Scale SD parameter logistic distributions (scale dllogis) scale Prior mean log scale log-normal prior scale parameter. scale_sd Prior SD log scale log-normal prior scale parameter. tmin Minimum plotting time.  Defaults lower boundary knot. tmax Maximum plotting time.  Defaults upper boundary knot. nsim Number simulations draw plot TRUE ggplot2 plot object returned.  FALSE underlying data returned plot done.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/plot_survival.html","id":null,"dir":"Reference","previous_headings":"","what":"Plot survival curves from a survextrap model — plot_survival","title":"Plot survival curves from a survextrap model — plot_survival","text":"Plot survival curves survextrap model.  function intended quick check fitted model, deliberately limited options customisation.  data behind plots can extracted survival tidy data frame enable custom plots constructed ggplot2.  See case study vignette examples.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/plot_survival.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Plot survival curves from a survextrap model — plot_survival","text":"","code":"plot_survival(   x,   newdata = NULL,   t = NULL,   tmax = NULL,   km = NULL,   niter = NULL,   newdata0 = NULL,   wane_period = NULL,   wane_nt = 10,   ci = NULL,   xlab = \"Time\",   ylab = \"Survival\",   line_size = 1.5,   ci_alpha = 0.2,   show_knots = FALSE )"},{"path":"https://chjackson.github.io/survextrap/reference/plot_survival.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Plot survival curves from a survextrap model — plot_survival","text":"x fitted model object returned survextrap newdata Data frame covariate values compute output . covariates model supplied, following default used: () covariate one factor variable, output computed level factor. (b) multiple covariates, numeric covariates, output computed mean numeric covariate original data, baseline level factor covariate. Note: caution required treatment groups (example) stored data.  coded numeric (0/1), newdata specified, one output shown. relates average value numeric variable data, correspond either treatment groups.  avoid , treatment group stored factor. t Vector times compute estimates. tmax Maximum time compute estimates.  t supplied, ignored.  t supplied, t set set 100 equally spaced time points 0 tmax.  tmax t supplied, tmax set maximum follow time data. km TRUE Kaplan-Meier curve observed data plotted, using results survival::survfit() formula originally used survextrap fit.  default, done covariates one factor covariate. Kaplan-Meier estimates returned km component fitted model object returned survextrap, use hand-crafted plots like . niter Number MCMC iterations use compute credible intervals.  Set low value make function quicker, cost approximation error (may important plotting model development). newdata0 Data frame covariate values defining \"untreated\" group use treatment waning models. See Survmspline_wane. wane_period Vector two numbers, defining time period hazard interpolated hazard \"treated\" group (taken newdata) hazard \"untreated\" group (taken newdata0).  Optional - supplied, waning assumed. wane_nt Number intervals defining piecewise constant approximation hazard waning period. ci TRUE credible intervals drawn.  Defaults drawing intervals plot shows curve one covariate value. xlab X-axis label ylab Y-axis label line_size Passed geom_line ci_alpha Transparency credible interval ribbons show_knots Show locations spline knots vertical lines","code":""},{"path":"https://chjackson.github.io/survextrap/reference/plot_survival.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Plot survival curves from a survextrap model — plot_survival","text":"ggplot2 plot object.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/plot_survival.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Plot survival curves from a survextrap model — plot_survival","text":"model single factor covariate (excluding background hazard strata), curves produced level factor newdata requests (left default). Otherwise, single curve produced, illustrating corresponding output hazard.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/print.survextrap.html","id":null,"dir":"Reference","previous_headings":"","what":"Print a fitted survextrap model — print.survextrap","title":"Print a fitted survextrap model — print.survextrap","text":"Print fitted survextrap model","code":""},{"path":"https://chjackson.github.io/survextrap/reference/print.survextrap.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Print a fitted survextrap model — print.survextrap","text":"","code":"# S3 method for class 'survextrap' print(x, ...)"},{"path":"https://chjackson.github.io/survextrap/reference/print.survextrap.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Print a fitted survextrap model — print.survextrap","text":"x fitted model object returned survextrap ... arguments (currently unused). prints summary data, statement fitted model, prior distributions, table summary statistics posterior distributions model parameters.  descriptions parameters summary table, see summary.survextrap.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/print_priors.html","id":null,"dir":"Reference","previous_headings":"","what":"Print the priors used in a fitted survextrap model — print_priors","title":"Print the priors used in a fitted survextrap model — print_priors","text":"Print priors used fitted survextrap model","code":""},{"path":"https://chjackson.github.io/survextrap/reference/print_priors.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Print the priors used in a fitted survextrap model — print_priors","text":"","code":"print_priors(x)"},{"path":"https://chjackson.github.io/survextrap/reference/print_priors.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Print the priors used in a fitted survextrap model — print_priors","text":"x fitted model object returned survextrap","code":""},{"path":"https://chjackson.github.io/survextrap/reference/print_priors.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Print the priors used in a fitted survextrap model — print_priors","text":"explicit value returned.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/priors.html","id":null,"dir":"Reference","previous_headings":"","what":"Prior distributions and options — priors","title":"Prior distributions and options — priors","text":"functions described page used specify prior distributions parameters survextrap model.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/priors.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Prior distributions and options — priors","text":"","code":"p_normal(location = 0, scale = 2.5)  p_t(location = 0, scale = 2.5, df = 1)  p_beta(shape1 = 1, shape2 = 1)  p_gamma(shape = 2, rate = 1)"},{"path":"https://chjackson.github.io/survextrap/reference/priors.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Prior distributions and options — priors","text":"location Prior location. normal distribution, mean. Defaults 0 scale Prior scale.  normal distribution, standard deviation. Defaults 2.5. df Prior degrees freedom (Student t distribution). shape1 First shape parameter (Beta distribution, defaults 1). shape2 Second shape parameter (Beta distribution, defaults 1). shape Shape parameter (Gamma distribution, defaults 2). rate Rate parameter (Gamma distribution, defaults 1).","code":""},{"path":"https://chjackson.github.io/survextrap/reference/priors.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Prior distributions and options — priors","text":"named list prior distribution name parameters, used internally survextrap model fitting functions.","code":""},{"path":[]},{"path":"https://chjackson.github.io/survextrap/reference/prior_haz.html","id":null,"dir":"Reference","previous_headings":"","what":"Determine priors for time-varying hazards and hazard ratios — prior_haz","title":"Determine priors for time-varying hazards and hazard ratios — prior_haz","text":"Computes consequences priors chosen parameters hsd hrsd flexible hazard model survextrap interpretable scale.  can used calibrate Gamma priors parameters match interpretable beliefs.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/prior_haz.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Determine priors for time-varying hazards and hazard ratios — prior_haz","text":"","code":"prior_haz_sd(   mspline,   coefs_mean = NULL,   prior_hsd = p_gamma(2, 1),   prior_hscale = p_normal(0, 20),   smooth_model = \"exchangeable\",   prior_loghr = NULL,   formula = NULL,   cure = NULL,   nonprop = NULL,   newdata = NULL,   prior_hrsd = NULL,   tmin = 0,   tmax = NULL,   nsim = 1000,   hq = c(0.1, 0.9),   quantiles = c(0.025, 0.5, 0.975) )  prior_hr_sd(   mspline,   coefs_mean = NULL,   prior_hsd = p_gamma(2, 1),   prior_hscale = p_normal(0, 20),   smooth_model = \"exchangeable\",   prior_loghr = NULL,   formula = NULL,   cure = NULL,   nonprop = NULL,   newdata = NULL,   newdata0 = NULL,   prior_hrsd = NULL,   tmin = 0,   tmax = 10,   nsim = 100,   hq = c(0.1, 0.9),   quantiles = c(0.025, 0.5, 0.975) )"},{"path":"https://chjackson.github.io/survextrap/reference/prior_haz.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Determine priors for time-varying hazards and hazard ratios — prior_haz","text":"mspline list control parameters defining spline model. knots: Spline knots.  supplied, number knots taken df, location taken equally-spaced quantiles observed event times individual-level data. add_knots: intended used external data included model.  External data typically outside time period covered individual data.  add_knots chosen span time period covered external data, hazard trajectory can vary time. external data, knots add_knots omitted, default set knots chosen span individual external data, taking quantiles vector defined concatenating individual-level event times start stop times external data. df: Degrees freedom, .e. number parameters (basis terms) intended result choosing knots based quantiles data.  total number parameters df plus number additional knots specified add_knots. df defaults 10.  necessarily overfit, function smoothed prior. degree: Polynomial degree used basis function. default 3, giving cubic. can changed 3 bsmooth FALSE. bsmooth: TRUE (default) spline smoother highest knot, defining derivative second derivative point zero. coefs_mean Spline basis coefficients define prior mean hazard function. default, set values define constant hazard function (see mspline_constant_coefs).  normalised sum 1 internally (already). prior_hsd Gamma prior standard deviation controls variability time (smoothness) hazard function.  call p_gamma().  default p_gamma(2,1).  See prior_haz_sd way calibrate represent meaningful belief. prior_hscale Prior baseline log hazard scale parameter (alpha log(eta)).  call prior constructor function, p_normal(0,1) p_t(0,2,2).  Supported prior distribution families normal (parameters mean SD) t distributions (parameters location, scale degrees freedom).  default normal distribution mean 0 standard deviation 20. Note eta hazard, proportional hazard (see vignette full model specification). \"Baseline\" defined continuous covariates taking value zero factor covariates taking reference level.  use different baseline, data transformed appropriately beforehand, value zero different meaning.  continuous covariates, helps computation interpretation define value zero denote typical value data, e.g. mean. smooth_model default \"random_walk\", specifies random walk prior multinomial-logit spline coefficients, based logistic distributions.  See methods vignette full details. alternative \"exchangeable\" uses independent logistic priors multinomial-logit spline coefficients, conditionally common smoothing variance parameter.  Note method explained original survextrap paper (Jackson, BMC Med Res 2023).  random walk model shown perform better Timmins et al (2025). non-proportional hazards models, setting smooth_model also determines whether exchangeable random walk model used non-proportionality parameters (\\(\\delta\\)). prior_loghr Priors log hazard ratios.  call p_normal() p_t().  list calls can also provided, give different priors different coefficients, name list component matches name coefficient, e.g.  list(\"age45-59\" = p_normal(0,1), \"age60+\" = p_t(0,2,3)) default p_normal(0,2.5) coefficients. formula survival formula standard R formula syntax, call Surv() left hand side. Covariates included right hand side formula modelled proportional hazards, nonprop TRUE non-proportional hazards used. data omitted, model fitted external aggregate data alone, without individual data, formula include Surv() call.  left-hand side formula empty, right hand side specifies covariates usual.  example, formula = ~1 covariates. cure TRUE, mixture cure model used, \"uncured\" survival defined M-spline model, cure probability estimated. nonprop Non-proportional hazards model specification. achieved modelling spline basis coefficients terms covariates.  See methods vignette details. TRUE, covariates modelled non-proportional hazards, using model formula formula. formula, assumed define model dependence basis coefficients covariates. NULL FALSE (default) covariates modelled proportional hazards. newdata data frame one row, containing variables model formulae.  Samples drawn, covariate-dependent parameters, covariates set values given . prior_hrsd Prior standard deviation parameters smooth non-proportionality effects time non-proportional hazards models.  call p_gamma() list calls p_gamma() one component per covariate, prior_loghr.  See prior_hr_sd way calibrate represent meaningful belief. tmin Minimum plotting time.  Defaults zero. tmax Maximum plotting time.  Defaults highest knot. nsim Number simulations draw hq Quantiles define \"low\" \"high\" values time-varying quantity (hazard prior_haz_sd hazard ratio prior_hr_sd).  ratio high low values summarised, measure time-dependence.  default, c(0.1, 0.9), 10% 90% quantiles used respectively. quantiles Quantiles used summarise implied prior distributions simulated quantities. newdata0 data frame one row, containing \"reference\" values variables model formulae.  hazard ratio hazards newdata newdata0 returned.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/prior_haz.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Determine priors for time-varying hazards and hazard ratios — prior_haz","text":"data frame columns sd_haz (SD hazard), sd_mean (SD inverse hazard) hr (ratio high/low hazards) (prior_haz_sd), rows giving prior quantiles . prior_hr_sd, sd_hr SD hazard ratios time, hrr ratio high/low hazard ratios.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/prior_haz.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Determine priors for time-varying hazards and hazard ratios — prior_haz","text":"spline model survextrap allows hazard change time arbitrarily flexible manner.  prior distributions parameters model implications much expect hazard plausibly vary time. priors hard interpret directly, function can used compute implications easily-understandable scale. done : (1) simulating set parameters prior distributions (2) computing hazard fine grid equally-spaced points spanning boundary knots (3) calculating empirical standard deviation set hazards points (4) repeatedly performing steps 1-3, summarising distribution resulting standard deviations.   implied prior hazard variability. prior_haz_sd computes SD hazard, SD inverse hazard also computed.   inverse hazard time t expected time event given survival t. hazard ratio high low value (defined quantiles values different times) also computed. prior_hr_sd computes SD hazard ratio two covariate values supplied user. SDs refer variability time, e.g. SD 0 indicates hazard (inverse hazard, hazard ratio) constant time.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/prior_haz_const.html","id":null,"dir":"Reference","previous_headings":"","what":"Summarises the prior for the constant hazard implied by a particular prior on the hazard scale parameter and spline specification. — prior_haz_const","title":"Summarises the prior for the constant hazard implied by a particular prior on the hazard scale parameter and spline specification. — prior_haz_const","text":"Summarises prior constant hazard implied particular prior hazard scale parameter M-spline specification, spline coefficients fixed define constant hazard using mspline_constant_coefs.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/prior_haz_const.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Summarises the prior for the constant hazard implied by a particular prior on the hazard scale parameter and spline specification. — prior_haz_const","text":"","code":"prior_haz_const(   mspline,   prior_hscale = p_normal(0, 20),   nsim = 10000,   quantiles = c(0.025, 0.5, 0.975) )"},{"path":"https://chjackson.github.io/survextrap/reference/prior_haz_const.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Summarises the prior for the constant hazard implied by a particular prior on the hazard scale parameter and spline specification. — prior_haz_const","text":"mspline list control parameters defining spline model. knots: Spline knots.  supplied, number knots taken df, location taken equally-spaced quantiles observed event times individual-level data. add_knots: intended used external data included model.  External data typically outside time period covered individual data.  add_knots chosen span time period covered external data, hazard trajectory can vary time. external data, knots add_knots omitted, default set knots chosen span individual external data, taking quantiles vector defined concatenating individual-level event times start stop times external data. df: Degrees freedom, .e. number parameters (basis terms) intended result choosing knots based quantiles data.  total number parameters df plus number additional knots specified add_knots. df defaults 10.  necessarily overfit, function smoothed prior. degree: Polynomial degree used basis function. default 3, giving cubic. can changed 3 bsmooth FALSE. bsmooth: TRUE (default) spline smoother highest knot, defining derivative second derivative point zero. prior_hscale Prior baseline log hazard scale parameter (alpha log(eta)).  call prior constructor function, p_normal(0,1) p_t(0,2,2).  Supported prior distribution families normal (parameters mean SD) t distributions (parameters location, scale degrees freedom).  default normal distribution mean 0 standard deviation 20. Note eta hazard, proportional hazard (see vignette full model specification). \"Baseline\" defined continuous covariates taking value zero factor covariates taking reference level.  use different baseline, data transformed appropriately beforehand, value zero different meaning.  continuous covariates, helps computation interpretation define value zero denote typical value data, e.g. mean. nsim Number simulations draw quantiles Quantiles used summarise implied prior distributions simulated quantities.","code":""},{"path":[]},{"path":"https://chjackson.github.io/survextrap/reference/prior_hr.html","id":null,"dir":"Reference","previous_headings":"","what":"Summarises the prior for the hazard ratio implied by a particular prior on the log hazard ratio — prior_hr","title":"Summarises the prior for the hazard ratio implied by a particular prior on the log hazard ratio — prior_hr","text":"Summarises prior hazard ratio implied particular prior log hazard ratio.   Simply applies exponential transform quantiles given prior.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/prior_hr.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Summarises the prior for the hazard ratio implied by a particular prior on the log hazard ratio — prior_hr","text":"","code":"prior_hr(prior_loghr = p_normal(0, 2.5), quantiles = c(0.025, 0.5, 0.975))"},{"path":"https://chjackson.github.io/survextrap/reference/prior_hr.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Summarises the prior for the hazard ratio implied by a particular prior on the log hazard ratio — prior_hr","text":"prior_loghr Priors log hazard ratios.  call p_normal() p_t().  list calls can also provided, give different priors different coefficients, name list component matches name coefficient, e.g.  list(\"age45-59\" = p_normal(0,1), \"age60+\" = p_t(0,2,3)) default p_normal(0,2.5) coefficients. quantiles Quantiles used summarise implied prior distributions simulated quantities.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/prior_hr.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Summarises the prior for the hazard ratio implied by a particular prior on the log hazard ratio — prior_hr","text":"vector quantiles.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/prior_pred.html","id":null,"dir":"Reference","previous_headings":"","what":"Simulate a dataset from the prior predictive distribution of survival times in an M-spline survival model. — prior_pred","title":"Simulate a dataset from the prior predictive distribution of survival times in an M-spline survival model. — prior_pred","text":"Simulate dataset prior predictive distribution survival times M-spline survival model.  Additive hazards models currently supported.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/prior_pred.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Simulate a dataset from the prior predictive distribution of survival times in an M-spline survival model. — prior_pred","text":"","code":"prior_pred(   n,   fix_prior = FALSE,   mspline,   censtime = Inf,   coefs_mean = NULL,   prior_hscale = p_normal(0, 20),   prior_hsd = p_gamma(2, 1),   newdata = NULL,   formula = NULL,   prior_loghr = NULL,   prior_hrsd = NULL,   prior_cure = NULL )"},{"path":"https://chjackson.github.io/survextrap/reference/prior_pred.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Simulate a dataset from the prior predictive distribution of survival times in an M-spline survival model. — prior_pred","text":"n Sample size simulated dataset.  observation dataset generated model parameters. parameters generated single simulation prior distribution. fix_prior TRUE, one value parameter vector drawn prior, followed n individual-level times given common prior value.  FALSE, produce sampled individual time, different sample prior used. mspline list control parameters defining spline model. knots: Spline knots.  supplied, number knots taken df, location taken equally-spaced quantiles observed event times individual-level data. add_knots: intended used external data included model.  External data typically outside time period covered individual data.  add_knots chosen span time period covered external data, hazard trajectory can vary time. external data, knots add_knots omitted, default set knots chosen span individual external data, taking quantiles vector defined concatenating individual-level event times start stop times external data. df: Degrees freedom, .e. number parameters (basis terms) intended result choosing knots based quantiles data.  total number parameters df plus number additional knots specified add_knots. df defaults 10.  necessarily overfit, function smoothed prior. degree: Polynomial degree used basis function. default 3, giving cubic. can changed 3 bsmooth FALSE. bsmooth: TRUE (default) spline smoother highest knot, defining derivative second derivative point zero. censtime Right-censoring time impose simulated event times. coefs_mean Spline basis coefficients define prior mean hazard function. default, set values define constant hazard function (see mspline_constant_coefs).  normalised sum 1 internally (already). prior_hscale Prior baseline log hazard scale parameter (alpha log(eta)).  call prior constructor function, p_normal(0,1) p_t(0,2,2).  Supported prior distribution families normal (parameters mean SD) t distributions (parameters location, scale degrees freedom).  default normal distribution mean 0 standard deviation 20. Note eta hazard, proportional hazard (see vignette full model specification). \"Baseline\" defined continuous covariates taking value zero factor covariates taking reference level.  use different baseline, data transformed appropriately beforehand, value zero different meaning.  continuous covariates, helps computation interpretation define value zero denote typical value data, e.g. mean. prior_hsd Gamma prior standard deviation controls variability time (smoothness) hazard function.  call p_gamma().  default p_gamma(2,1).  See prior_haz_sd way calibrate represent meaningful belief. newdata data frame one row, containing variables model formulae.  Samples drawn, covariate-dependent parameters, covariates set values given . formula model formula response, defining covariates hazard scale. prior_loghr Priors log hazard ratios.  call p_normal() p_t().  list calls can also provided, give different priors different coefficients, name list component matches name coefficient, e.g.  list(\"age45-59\" = p_normal(0,1), \"age60+\" = p_t(0,2,3)) default p_normal(0,2.5) coefficients. prior_hrsd Prior standard deviation parameters smooth non-proportionality effects time non-proportional hazards models.  call p_gamma() list calls p_gamma() one component per covariate, prior_loghr.  See prior_hr_sd way calibrate represent meaningful belief. prior_cure Prior baseline cure probability.  call p_beta().  default uniform prior, p_beta(1,1). Baseline defined mean continuous covariates reference level factor covariates.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/prior_pred.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Simulate a dataset from the prior predictive distribution of survival times in an M-spline survival model. — prior_pred","text":"data frame columns time (simulated time) event (indicator whether time event time, opposed right-censoring time).  prior parameters returned prior attribute list components alpha (baseline log hazard) coefs (spline coefficients).","code":""},{"path":[]},{"path":"https://chjackson.github.io/survextrap/reference/prior_sample.html","id":null,"dir":"Reference","previous_headings":"","what":"Sample from the joint prior of parameters in a survextrap model — prior_sample","title":"Sample from the joint prior of parameters in a survextrap model — prior_sample","text":"Draws sample joint prior distribution parameters governing survextrap model given covariates.  used, example, prior_sample_hazard, visualise prior distribution around hazard curves implied particular M-spline model parameter priors.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/prior_sample.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Sample from the joint prior of parameters in a survextrap model — prior_sample","text":"","code":"prior_sample(   mspline,   coefs_mean = NULL,   prior_hsd = p_gamma(2, 1),   prior_hscale,   smooth_model = \"exchangeable\",   prior_loghr = NULL,   formula = NULL,   cure = NULL,   nonprop = NULL,   newdata = NULL,   newdata0 = NULL,   prior_hrsd = NULL,   prior_cure = NULL,   prior_logor_cure = NULL,   nsim = 100 )"},{"path":"https://chjackson.github.io/survextrap/reference/prior_sample.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Sample from the joint prior of parameters in a survextrap model — prior_sample","text":"mspline list control parameters defining spline model. knots: Spline knots.  supplied, number knots taken df, location taken equally-spaced quantiles observed event times individual-level data. add_knots: intended used external data included model.  External data typically outside time period covered individual data.  add_knots chosen span time period covered external data, hazard trajectory can vary time. external data, knots add_knots omitted, default set knots chosen span individual external data, taking quantiles vector defined concatenating individual-level event times start stop times external data. df: Degrees freedom, .e. number parameters (basis terms) intended result choosing knots based quantiles data.  total number parameters df plus number additional knots specified add_knots. df defaults 10.  necessarily overfit, function smoothed prior. degree: Polynomial degree used basis function. default 3, giving cubic. can changed 3 bsmooth FALSE. bsmooth: TRUE (default) spline smoother highest knot, defining derivative second derivative point zero. coefs_mean Spline basis coefficients define prior mean hazard function. default, set values define constant hazard function (see mspline_constant_coefs).  normalised sum 1 internally (already). prior_hsd Gamma prior standard deviation controls variability time (smoothness) hazard function.  call p_gamma().  default p_gamma(2,1).  See prior_haz_sd way calibrate represent meaningful belief. prior_hscale Prior baseline log hazard scale parameter (alpha log(eta)).  call prior constructor function, p_normal(0,1) p_t(0,2,2).  Supported prior distribution families normal (parameters mean SD) t distributions (parameters location, scale degrees freedom).  default normal distribution mean 0 standard deviation 20. Note eta hazard, proportional hazard (see vignette full model specification). \"Baseline\" defined continuous covariates taking value zero factor covariates taking reference level.  use different baseline, data transformed appropriately beforehand, value zero different meaning.  continuous covariates, helps computation interpretation define value zero denote typical value data, e.g. mean. smooth_model default \"random_walk\", specifies random walk prior multinomial-logit spline coefficients, based logistic distributions.  See methods vignette full details. alternative \"exchangeable\" uses independent logistic priors multinomial-logit spline coefficients, conditionally common smoothing variance parameter.  Note method explained original survextrap paper (Jackson, BMC Med Res 2023).  random walk model shown perform better Timmins et al (2025). non-proportional hazards models, setting smooth_model also determines whether exchangeable random walk model used non-proportionality parameters (\\(\\delta\\)). prior_loghr Priors log hazard ratios.  call p_normal() p_t().  list calls can also provided, give different priors different coefficients, name list component matches name coefficient, e.g.  list(\"age45-59\" = p_normal(0,1), \"age60+\" = p_t(0,2,3)) default p_normal(0,2.5) coefficients. formula model formula response, defining covariates hazard scale. cure model formula response, giving covariates cure proportion. nonprop model formula response, defining covariates affecting spline basis coefficients, gives nonproportional hazards model. newdata data frame one row, containing variables model formulae.  Samples drawn, covariate-dependent parameters, covariates set values given . newdata0 data frame one row, containing \"reference\" values variables model formulae.  hazard ratio hazards newdata newdata0 returned. prior_hrsd Prior standard deviation parameters smooth non-proportionality effects time non-proportional hazards models.  call p_gamma() list calls p_gamma() one component per covariate, prior_loghr.  See prior_hr_sd way calibrate represent meaningful belief. prior_cure Prior baseline cure probability.  call p_beta().  default uniform prior, p_beta(1,1). Baseline defined mean continuous covariates reference level factor covariates. prior_logor_cure Priors log odds ratios cure probabilities. call p_normal() p_t().  default p_normal(0,2.5). nsim Number simulations draw","code":""},{"path":"https://chjackson.github.io/survextrap/reference/prior_sample.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Sample from the joint prior of parameters in a survextrap model — prior_sample","text":"prior_sample_hazard returns data frame samples, plot_prior_hazard generates plot.  customisation options provided plot function, just intended quick check. list components: alpha: Baseline log hazard scale parameter (log(eta) notation manual). models covariates, covariate values supplied X, zero X supplied. hscale: Baseline hazard scale parameter (eta). coefs: Spline coefficients. non-proportional hazards model covariates, returned suppled value X, values zero X supplied. beta: Multinomial logit-transformed spline coefficients. hsd: Smoothing standard deviation spline coefficients. X0 supplied, alpha0, hscale0, beta0, coefs0 also returned, representing reference covariate values. pcure returned cure models (cure probability).","code":""},{"path":"https://chjackson.github.io/survextrap/reference/prior_sample_hazard.html","id":null,"dir":"Reference","previous_headings":"","what":"Generate and/or plot a sample from the prior distribution of M-spline hazard curves — prior_sample_hazard","title":"Generate and/or plot a sample from the prior distribution of M-spline hazard curves — prior_sample_hazard","text":"Generates /plots hazard curves (functions time) implied prior mean spline coefficients (constant hazard default) particular priors baseline log hazard smoothness standard deviation.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/prior_sample_hazard.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Generate and/or plot a sample from the prior distribution of M-spline hazard curves — prior_sample_hazard","text":"","code":"prior_sample_hazard(   knots = NULL,   df = 10,   degree = 3,   bsmooth = TRUE,   coefs_mean = NULL,   prior_hsd = p_gamma(2, 1),   prior_hscale = NULL,   smooth_model = \"exchangeable\",   prior_loghr = NULL,   formula = NULL,   cure = NULL,   nonprop = NULL,   newdata = NULL,   newdata0 = NULL,   prior_hrsd = NULL,   tmin = 0,   tmax = 10,   nsim = 10 )  plot_prior_hazard(   knots = NULL,   df = 10,   degree = 3,   bsmooth = TRUE,   coefs_mean = NULL,   prior_hsd = p_gamma(2, 1),   prior_hscale = p_normal(0, 20),   smooth_model = \"exchangeable\",   prior_loghr = NULL,   formula = NULL,   cure = NULL,   nonprop = NULL,   newdata = NULL,   prior_hrsd = p_gamma(2, 1),   tmin = 0,   tmax = NULL,   nsim = 10 )"},{"path":"https://chjackson.github.io/survextrap/reference/prior_sample_hazard.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Generate and/or plot a sample from the prior distribution of M-spline hazard curves — prior_sample_hazard","text":"knots Vector knot locations. supplied, df specified.  One two rules used choose knot locations.  bknot specified, set equally spaced knots zero bknot used.  Otherwise obstimes supplied, knots chosen equally spaced quantiles obstimes. number knots (excluding zero) df - degree + 1 bsmooth TRUE, df - degree - 1 otherwise. df Desired number basis terms, \"degrees freedom\" spline.  knots supplied, number knots chosen satisfy . degree Spline polynomial degree.  Can changed default 3 bsmooth FALSE. bsmooth TRUE function constrained also zero derivative second derivative boundary. coefs_mean Spline basis coefficients define prior mean hazard function. default, set values define constant hazard function (see mspline_constant_coefs).  normalised sum 1 internally (already). prior_hsd Gamma prior standard deviation controls variability time (smoothness) hazard function.  call p_gamma().  default p_gamma(2,1).  See prior_haz_sd way calibrate represent meaningful belief. prior_hscale Prior baseline log hazard scale parameter (alpha log(eta)).  call prior constructor function, p_normal(0,1) p_t(0,2,2).  Supported prior distribution families normal (parameters mean SD) t distributions (parameters location, scale degrees freedom).  default normal distribution mean 0 standard deviation 20. Note eta hazard, proportional hazard (see vignette full model specification). \"Baseline\" defined continuous covariates taking value zero factor covariates taking reference level.  use different baseline, data transformed appropriately beforehand, value zero different meaning.  continuous covariates, helps computation interpretation define value zero denote typical value data, e.g. mean. smooth_model default \"random_walk\", specifies random walk prior multinomial-logit spline coefficients, based logistic distributions.  See methods vignette full details. alternative \"exchangeable\" uses independent logistic priors multinomial-logit spline coefficients, conditionally common smoothing variance parameter.  Note method explained original survextrap paper (Jackson, BMC Med Res 2023).  random walk model shown perform better Timmins et al (2025). non-proportional hazards models, setting smooth_model also determines whether exchangeable random walk model used non-proportionality parameters (\\(\\delta\\)). prior_loghr Priors log hazard ratios.  call p_normal() p_t().  list calls can also provided, give different priors different coefficients, name list component matches name coefficient, e.g.  list(\"age45-59\" = p_normal(0,1), \"age60+\" = p_t(0,2,3)) default p_normal(0,2.5) coefficients. formula survival formula standard R formula syntax, call Surv() left hand side. Covariates included right hand side formula modelled proportional hazards, nonprop TRUE non-proportional hazards used. data omitted, model fitted external aggregate data alone, without individual data, formula include Surv() call.  left-hand side formula empty, right hand side specifies covariates usual.  example, formula = ~1 covariates. cure TRUE, mixture cure model used, \"uncured\" survival defined M-spline model, cure probability estimated. nonprop Non-proportional hazards model specification. achieved modelling spline basis coefficients terms covariates.  See methods vignette details. TRUE, covariates modelled non-proportional hazards, using model formula formula. formula, assumed define model dependence basis coefficients covariates. NULL FALSE (default) covariates modelled proportional hazards. newdata data frame one row, containing variables model formulae.  Samples drawn, covariate-dependent parameters, covariates set values given . newdata0 data frame one row, containing \"reference\" values variables model formulae.  hazard ratio hazards newdata newdata0 returned. prior_hrsd Prior standard deviation parameters smooth non-proportionality effects time non-proportional hazards models.  call p_gamma() list calls p_gamma() one component per covariate, prior_loghr.  See prior_hr_sd way calibrate represent meaningful belief. tmin Minimum plotting time.  Defaults zero. tmax Maximum plotting time.  Defaults highest knot. nsim Number simulations draw","code":""},{"path":"https://chjackson.github.io/survextrap/reference/prior_sample_hazard.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Generate and/or plot a sample from the prior distribution of M-spline hazard curves — prior_sample_hazard","text":"tidy data frame containing values hazard sequence times, different draws prior distribution.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/p_hr.html","id":null,"dir":"Reference","previous_headings":"","what":"Derive a normal prior for the log hazard ratio parameter based on a guess at the hazard ratio — p_hr","title":"Derive a normal prior for the log hazard ratio parameter based on a guess at the hazard ratio — p_hr","text":"Derive normal prior log hazard ratio parameter based guess hazard ratio. assumes log upper limit 2 standard deviations away log median.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/p_hr.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Derive a normal prior for the log hazard ratio parameter based on a guess at the hazard ratio — p_hr","text":"","code":"p_hr(median, upper)"},{"path":"https://chjackson.github.io/survextrap/reference/p_hr.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Derive a normal prior for the log hazard ratio parameter based on a guess at the hazard ratio — p_hr","text":"median Best guess (prior median) typical hazard ratio upper Upper limit 95% credible interval hazard ratio","code":""},{"path":"https://chjackson.github.io/survextrap/reference/p_hr.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Derive a normal prior for the log hazard ratio parameter based on a guess at the hazard ratio — p_hr","text":"normal prior format returned p_normal, can passed directly prior_loghr argument survextrap.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/p_meansurv.html","id":null,"dir":"Reference","previous_headings":"","what":"Derive a normal prior for the log hazard scale parameter based on a guess at survival times — p_meansurv","title":"Derive a normal prior for the log hazard scale parameter based on a guess at survival times — p_meansurv","text":"Derive normal prior log hazard scale parameter based guess survival times.  scale parameter hard interpret, depends spline knots.  However scale parameter, can determine spline coefficients give constant hazard (mspline_constant_coefs).  Therefore can guess typical survival time, can guess typical hazard (1 divided survival time) deduce scale parameter.  prior constructed assuming normality log scale, assuming log upper credible limit two SDs away log median.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/p_meansurv.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Derive a normal prior for the log hazard scale parameter based on a guess at survival times — p_meansurv","text":"","code":"p_meansurv(median, upper, mspline = NULL)"},{"path":"https://chjackson.github.io/survextrap/reference/p_meansurv.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Derive a normal prior for the log hazard scale parameter based on a guess at survival times — p_meansurv","text":"median Best guess (prior median) typical survival time upper Upper limit 95% credible interval survival time mspline list components knots (vector knots), degree (polynomial degree) bsmooth (logical smoothness constraint boundary), defining M-spline configuration.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/p_meansurv.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Derive a normal prior for the log hazard scale parameter based on a guess at survival times — p_meansurv","text":"normal prior format returned p_normal, can passed directly prior_hscale argument survextrap.","code":""},{"path":[]},{"path":"https://chjackson.github.io/survextrap/reference/rmst.html","id":null,"dir":"Reference","previous_headings":"","what":"Restricted mean survival time — rmst","title":"Restricted mean survival time — rmst","text":"Compute restricted mean survival time model fitted survextrap.  Defined integral fitted survival curve specified time.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/rmst.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Restricted mean survival time — rmst","text":"","code":"rmst(   x,   t,   newdata = NULL,   newdata0 = NULL,   wane_period = NULL,   wane_nt = 10,   disc_rate = 0,   method = \"gl\",   gl_nodes = 100,   niter = NULL,   summ_fns = NULL,   sample = FALSE )"},{"path":"https://chjackson.github.io/survextrap/reference/rmst.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Restricted mean survival time — rmst","text":"x fitted model object returned survextrap t Vector times.  restricted mean survival time one times computed. newdata Data frame covariate values compute output . covariates model supplied, following default used: () covariate one factor variable, output computed level factor. (b) multiple covariates, numeric covariates, output computed mean numeric covariate original data, baseline level factor covariate. Note: caution required treatment groups (example) stored data.  coded numeric (0/1), newdata specified, one output shown. relates average value numeric variable data, correspond either treatment groups.  avoid , treatment group stored factor. newdata0 Data frame covariate values defining \"untreated\" group use treatment waning models. See Survmspline_wane. wane_period Vector two numbers, defining time period hazard interpolated hazard \"treated\" group (taken newdata) hazard \"untreated\" group (taken newdata0).  Optional - supplied, waning assumed. wane_nt Number intervals defining piecewise constant approximation hazard waning period. disc_rate Discounting rate used calculate discounted mean restricted mean survival time, using exponential discounting function. method Method numerical integration obtain restricted mean survival time survival function. default method=\"gl\", Gauss-Legendre method 100 nodes zero maximum t. method=\"adaptive\" uses base R integrate function, much slower, potentially robust badly-behaved survival functions. gl_nodes Number nodes Gauss-Legendre method. niter Number MCMC iterations use compute credible intervals.  Set low value make function quicker, cost approximation error (may important plotting model development). summ_fns list functions use summarise posterior sample. passed posterior::summarise_draws. default list(median=median, ~quantile(.x, probs=c(0.025, 0.975))). list named, names used columns output. sample TRUE MCMC sample returned posterior output, rather summary statistics.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/rmst.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Restricted mean survival time — rmst","text":"data frame (tibble) row containing posterior summary statistics particular time covariate value. sample=TRUE, array dimensions length(t), niter, nrow(newdata), giving RMST evaluated different times, MCMC iterations covariate values respectively.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/rmst.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Restricted mean survival time — rmst","text":"","code":"mod <- survextrap(Surv(years, status) ~ rx, data=colons, fit_method=\"opt\") rmst(mod, t=3, niter=100) #> # A tibble: 3 × 6 #>   variable rx          t median lower upper #>   <chr>    <chr>   <dbl>  <dbl> <dbl> <dbl> #> 1 rmst     Obs         3   1.99  1.75  2.26 #> 2 rmst     Lev         3   2.23  1.97  2.47 #> 3 rmst     Lev+5FU     3   2.42  2.11  2.58 rmst(mod, t=3, summ_fns=list(mean=mean), niter=100) #> # A tibble: 3 × 4 #>   variable rx          t  mean #>   <chr>    <chr>   <dbl> <dbl> #> 1 rmst     Obs         3  1.99 #> 2 rmst     Lev         3  2.23 #> 3 rmst     Lev+5FU     3  2.40"},{"path":"https://chjackson.github.io/survextrap/reference/standardise_to.html","id":null,"dir":"Reference","previous_headings":"","what":"Constructor for a standardising population used for survextrap outputs — standardise_to","title":"Constructor for a standardising population used for survextrap outputs — standardise_to","text":"Standardised outputs outputs models covariates, defined marginalising (averaging) covariate values given population, rather conditional given covariate value.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/standardise_to.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Constructor for a standardising population used for survextrap outputs — standardise_to","text":"","code":"standardise_to(newdata, nstd = 1, random = FALSE)  standardize_to(newdata, nstd = 1, random = FALSE)"},{"path":"https://chjackson.github.io/survextrap/reference/standardise_to.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Constructor for a standardising population used for survextrap outputs — standardise_to","text":"newdata Data frame describing population. nstd Number draws population distribution used per MCMC sample parameters random=TRUE. default 1, value covariate vector \\(X\\) essentially treated additional parameter Bayesian model, drawn Monte Carlo independently remaining parameters. random default FALSE, indicating standardised samples obtained concatenating posterior samples covariate value standard population.  sample standardised posterior parameters size niter times number rows newdata, niter number MCMC iterations used original survextrap fit.  Computing resulting output function (e.g. RMST uses numerical integration) can computationally intensive sample size large. quicker alternative sample random row standard population MCMC iteration.  standardised sample posterior size niter.  specified using random=TRUE.  used, result depends random number seed, checked results stable within required number significant figures.  , run survextrap MCMC iterations increase nstd .","code":""},{"path":"https://chjackson.github.io/survextrap/reference/standardise_to.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Constructor for a standardising population used for survextrap outputs — standardise_to","text":"copy newdata, attributes added indicate used standard population.  newdata passed survextrap's output functions, outputs presented average empirical distribution covariate values described newdata, rather one output per row newdata (distinct covariate values).","code":""},{"path":"https://chjackson.github.io/survextrap/reference/standardise_to.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Constructor for a standardising population used for survextrap outputs — standardise_to","text":"produced generating Monte Carlo sample joint distribution parameters \\(\\theta\\) covariate values \\(X\\), \\(p(X,\\theta) = p(\\theta|X)p(X)\\), \\(p(X)\\) defined empirical distribution covariates standard population. Hence applying vectorised output function \\(g()\\) (RMST survival probability) sample produces sample posterior \\(\\int g(\\theta|X) dX\\): average RMST (say) heterogeneous population. See Examples vignette examples notes computation.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/standardise_to.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Constructor for a standardising population used for survextrap outputs — standardise_to","text":"","code":"rxph_mod <- survextrap(Surv(years, status) ~ rx, data=colons, fit_method=\"opt\") ref_pop <- data.frame(rx = c(\"Obs\",\"Lev+5FU\"))  # covariate-specific outputs survival(rxph_mod, t = c(5,10), newdata = ref_pop) #> # A tibble: 4 × 5 #>   rx          t median  lower upper #>   <chr>   <dbl>  <dbl>  <dbl> <dbl> #> 1 Obs         5  0.365 0.206  0.507 #> 2 Obs        10  0.205 0.0435 0.411 #> 3 Lev+5FU     5  0.596 0.410  0.727 #> 4 Lev+5FU    10  0.444 0.182  0.655  # standardised outputs survival(rxph_mod, t = c(5,10), newdata = standardise_to(ref_pop)) #> # A tibble: 2 × 4 #>       t median  lower upper #>   <dbl>  <dbl>  <dbl> <dbl> #> 1     5  0.468 0.237  0.708 #> 2    10  0.309 0.0650 0.622"},{"path":"https://chjackson.github.io/survextrap/reference/summary.survextrap.html","id":null,"dir":"Reference","previous_headings":"","what":"Posterior summary statistics for parameters of survextrap models — summary.survextrap","title":"Posterior summary statistics for parameters of survextrap models — summary.survextrap","text":"Posterior summary statistics parameters survextrap models.  summary statistics presented default include posterior median 95% credible intervals, alongside Rhat convergence diagnostic bulk effective sample size (computed posterior package).  models fitted optimisation rather MCMC, posterior mode always returned. posterior summary can computed appropriate function compute supplied summ_fns.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/summary.survextrap.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Posterior summary statistics for parameters of survextrap models — summary.survextrap","text":"","code":"# S3 method for class 'survextrap' summary(object, summ_fns = NULL, ...)"},{"path":"https://chjackson.github.io/survextrap/reference/summary.survextrap.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Posterior summary statistics for parameters of survextrap models — summary.survextrap","text":"object fitted model object returned survextrap summ_fns list functions calculate different posterior summaries MCMC sample.  passed posterior::summarise_draws. list named, names used columns output. See examples different ways can used. Defaults list(median = median,                        ~quantile(.x, probs=c(0.025, 0.975)),                        sd = sd,                        rhat = posterior::rhat,                        ess_bulk = posterior::ess_bulk) Many useful functions provided posterior package. ... Summary functions can also supplied separate arguments . added supplied summ_fns.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/summary.survextrap.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Posterior summary statistics for parameters of survextrap models — summary.survextrap","text":"data frame (actually tibble) summary statistics model parameters. parameters, indicated variable column, : alpha: Baseline log hazard scale.  covariates, describes log hazard scale continuous covariates set zero, factor covariates set baseline levels.  Note log hazard, also depends spline coefficients basis.  See hazard extract actual hazard. coefs: Coefficients M-spline basis terms.  non-proportional hazards model fitted, covariates set zero baseline levels. loghr: Log hazard ratios covariate model. cure models, refers covariates survival uncured people.  non-proportional hazards models, multiplicative effects covariates hazard scale parameter.  See methods vignette full description model. hr: Hazard ratios (exponentials loghr). pcure: Probability cure (cure models ).  covariates cure, parameter describes probability cure continuous covariates set zero, factor covariates set baseline levels. logor_cure: Log odds ratio cure covariate cure. or_cure: Odds ratios cure (exponentials logor_cure). nperr: Standardised departures proportional hazards non-proportional hazards model, defined \\(b^{(np)}_{ks} / \\sigma^{(np)}_s\\) (see methods vignette definitions ). hrsd: Smoothness standard deviations \\(\\tau_s\\) non-proportionality effects.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/summary.survextrap.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Posterior summary statistics for parameters of survextrap models — summary.survextrap","text":"","code":"mod <- survextrap(Surv(years, status) ~ rx, data=colons, fit_method=\"opt\") summary(mod) #> # A tibble: 16 × 10 #>    variable basis_num term          mode   median     lower   upper     sd  rhat #>    <chr>        <dbl> <chr>        <dbl>    <dbl>     <dbl>   <dbl>  <dbl> <dbl> #>  1 alpha           NA NA        -0.250   -0.249   -0.572     0.0779 0.164   1.00 #>  2 coefs            1 NA         0.00710  0.00718  0.000103  0.0382 0.0121  1.00 #>  3 coefs            2 NA         0.0175   0.0181   0.000468  0.0823 0.0380  1.00 #>  4 coefs            3 NA         0.0897   0.0772   0.0252    0.300  0.0727  1.00 #>  5 coefs            4 NA         0.119    0.104    0.0129    0.250  0.0562  1.00 #>  6 coefs            5 NA         0.114    0.0984   0.0231    0.237  0.0537  1.00 #>  7 coefs            6 NA         0.112    0.100    0.0224    0.255  0.0605  1.00 #>  8 coefs            7 NA         0.0692   0.0664   0.00441   0.215  0.0551  1.00 #>  9 coefs            8 NA         0.136    0.123    0.0272    0.287  0.0648  1.00 #> 10 coefs            9 NA         0.188    0.176    0.0470    0.375  0.0786  1.00 #> 11 coefs           10 NA         0.148    0.149    0.0400    0.328  0.0836  1.00 #> 12 loghr           NA rxLev     -0.384   -0.383   -0.901     0.117  0.256   1.00 #> 13 loghr           NA rxLev+5FU -0.664   -0.664   -1.20     -0.122  0.279   1.00 #> 14 hr              NA rxLev      0.681    0.682    0.406     1.12   0.185   1.00 #> 15 hr              NA rxLev+5FU  0.515    0.515    0.302     0.885  0.152   1.00 #> 16 hsd             NA NA         3.04     3.05     1.13      8.64   1.93    1.00 #> # ℹ 1 more variable: ess_bulk <dbl> summary(mod, mean=mean) #> # A tibble: 16 × 11 #>    variable basis_num term          mode   median     lower   upper     sd  rhat #>    <chr>        <dbl> <chr>        <dbl>    <dbl>     <dbl>   <dbl>  <dbl> <dbl> #>  1 alpha           NA NA        -0.250   -0.249   -0.572     0.0779 0.164   1.00 #>  2 coefs            1 NA         0.00710  0.00718  0.000103  0.0382 0.0121  1.00 #>  3 coefs            2 NA         0.0175   0.0181   0.000468  0.0823 0.0380  1.00 #>  4 coefs            3 NA         0.0897   0.0772   0.0252    0.300  0.0727  1.00 #>  5 coefs            4 NA         0.119    0.104    0.0129    0.250  0.0562  1.00 #>  6 coefs            5 NA         0.114    0.0984   0.0231    0.237  0.0537  1.00 #>  7 coefs            6 NA         0.112    0.100    0.0224    0.255  0.0605  1.00 #>  8 coefs            7 NA         0.0692   0.0664   0.00441   0.215  0.0551  1.00 #>  9 coefs            8 NA         0.136    0.123    0.0272    0.287  0.0648  1.00 #> 10 coefs            9 NA         0.188    0.176    0.0470    0.375  0.0786  1.00 #> 11 coefs           10 NA         0.148    0.149    0.0400    0.328  0.0836  1.00 #> 12 loghr           NA rxLev     -0.384   -0.383   -0.901     0.117  0.256   1.00 #> 13 loghr           NA rxLev+5FU -0.664   -0.664   -1.20     -0.122  0.279   1.00 #> 14 hr              NA rxLev      0.681    0.682    0.406     1.12   0.185   1.00 #> 15 hr              NA rxLev+5FU  0.515    0.515    0.302     0.885  0.152   1.00 #> 16 hsd             NA NA         3.04     3.05     1.13      8.64   1.93    1.00 #> # ℹ 2 more variables: ess_bulk <dbl>, mean <dbl> summary(mod, list(mean=mean)) #> # A tibble: 16 × 5 #>    variable basis_num term          mode    mean #>    <chr>        <dbl> <chr>        <dbl>   <dbl> #>  1 alpha           NA NA        -0.250   -0.250  #>  2 coefs            1 NA         0.00710  0.0102 #>  3 coefs            2 NA         0.0175   0.0253 #>  4 coefs            3 NA         0.0897   0.0968 #>  5 coefs            4 NA         0.119    0.109  #>  6 coefs            5 NA         0.114    0.105  #>  7 coefs            6 NA         0.112    0.110  #>  8 coefs            7 NA         0.0692   0.0749 #>  9 coefs            8 NA         0.136    0.132  #> 10 coefs            9 NA         0.188    0.181  #> 11 coefs           10 NA         0.148    0.157  #> 12 loghr           NA rxLev     -0.384   -0.384  #> 13 loghr           NA rxLev+5FU -0.664   -0.664  #> 14 hr              NA rxLev      0.681    0.704  #> 15 hr              NA rxLev+5FU  0.515    0.535  #> 16 hsd             NA NA         3.04     3.48   summary(mod, list(mean=mean, ess_tail=posterior::ess_tail)) #> # A tibble: 16 × 6 #>    variable basis_num term          mode    mean ess_tail #>    <chr>        <dbl> <chr>        <dbl>   <dbl>    <dbl> #>  1 alpha           NA NA        -0.250   -0.250     1919. #>  2 coefs            1 NA         0.00710  0.0102    1951. #>  3 coefs            2 NA         0.0175   0.0253    1817. #>  4 coefs            3 NA         0.0897   0.0968    1881. #>  5 coefs            4 NA         0.119    0.109     1776. #>  6 coefs            5 NA         0.114    0.105     1987. #>  7 coefs            6 NA         0.112    0.110     1812. #>  8 coefs            7 NA         0.0692   0.0749    1921. #>  9 coefs            8 NA         0.136    0.132     2007. #> 10 coefs            9 NA         0.188    0.181     2002. #> 11 coefs           10 NA         0.148    0.157     2047. #> 12 loghr           NA rxLev     -0.384   -0.384     1666. #> 13 loghr           NA rxLev+5FU -0.664   -0.664     1777. #> 14 hr              NA rxLev      0.681    0.704     1666. #> 15 hr              NA rxLev+5FU  0.515    0.535     1777. #> 16 hsd             NA NA         3.04     3.48      1587. summary(mod, mean=mean, ess_tail=posterior::ess_tail) #> # A tibble: 16 × 12 #>    variable basis_num term          mode   median     lower   upper     sd  rhat #>    <chr>        <dbl> <chr>        <dbl>    <dbl>     <dbl>   <dbl>  <dbl> <dbl> #>  1 alpha           NA NA        -0.250   -0.249   -0.572     0.0779 0.164   1.00 #>  2 coefs            1 NA         0.00710  0.00718  0.000103  0.0382 0.0121  1.00 #>  3 coefs            2 NA         0.0175   0.0181   0.000468  0.0823 0.0380  1.00 #>  4 coefs            3 NA         0.0897   0.0772   0.0252    0.300  0.0727  1.00 #>  5 coefs            4 NA         0.119    0.104    0.0129    0.250  0.0562  1.00 #>  6 coefs            5 NA         0.114    0.0984   0.0231    0.237  0.0537  1.00 #>  7 coefs            6 NA         0.112    0.100    0.0224    0.255  0.0605  1.00 #>  8 coefs            7 NA         0.0692   0.0664   0.00441   0.215  0.0551  1.00 #>  9 coefs            8 NA         0.136    0.123    0.0272    0.287  0.0648  1.00 #> 10 coefs            9 NA         0.188    0.176    0.0470    0.375  0.0786  1.00 #> 11 coefs           10 NA         0.148    0.149    0.0400    0.328  0.0836  1.00 #> 12 loghr           NA rxLev     -0.384   -0.383   -0.901     0.117  0.256   1.00 #> 13 loghr           NA rxLev+5FU -0.664   -0.664   -1.20     -0.122  0.279   1.00 #> 14 hr              NA rxLev      0.681    0.682    0.406     1.12   0.185   1.00 #> 15 hr              NA rxLev+5FU  0.515    0.515    0.302     0.885  0.152   1.00 #> 16 hsd             NA NA         3.04     3.05     1.13      8.64   1.93    1.00 #> # ℹ 3 more variables: ess_bulk <dbl>, mean <dbl>, ess_tail <dbl>"},{"path":"https://chjackson.github.io/survextrap/reference/survextrap-package.html","id":null,"dir":"Reference","previous_headings":"","what":"The 'survextrap' package. — survextrap-package","title":"The 'survextrap' package. — survextrap-package","text":"introduction overview survextrap package, full documentation, see https://chjackson.github.io/survextrap/. details methods, see paper Jackson (2023).","code":""},{"path":"https://chjackson.github.io/survextrap/reference/survextrap-package.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"The 'survextrap' package. — survextrap-package","text":"Jackson, C. (2023) survextrap: package flexible transparent survival extrapolation. BMC Medical Research Methodology 23:282. doi:10.1186/s12874-023-02094-1 Timmins , Torabi F, Jackson C, Lambert P, Sweeting M J. (2025) Simulation-based assessment Bayesian survival model flexible baseline hazard time-dependent effects. doi:10.48550/arXiv.2503.21388 .","code":""},{"path":[]},{"path":"https://chjackson.github.io/survextrap/reference/survextrap-package.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"The 'survextrap' package. — survextrap-package","text":"Maintainer: Christopher Jackson chris.jackson@mrc-bsu.cam.ac.uk (ORCID) [copyright holder] contributors: Iain Timmins (ORCID) [contributor] Michael Sweeting (ORCID) [contributor]","code":""},{"path":"https://chjackson.github.io/survextrap/reference/survextrap.html","id":null,"dir":"Reference","previous_headings":"","what":"Flexible Bayesian parametric survival models — survextrap","title":"Flexible Bayesian parametric survival models — survextrap","text":"Flexible Bayesian parametric survival models.  Individual data represented using M-splines proportional hazards flexible non-proportional hazards model.  External aggregate data can included, example, enable extrapolation outside individual data.  fixed background hazard can also included additive hazards (relative survival) model.  Mixture cure versions models can also used.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/survextrap.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Flexible Bayesian parametric survival models — survextrap","text":"","code":"survextrap(   formula,   data = NULL,   external = NULL,   cure = FALSE,   nonprop = FALSE,   prior_hscale = p_normal(0, 20),   prior_loghr = NULL,   prior_hsd = p_gamma(2, 1),   prior_cure = p_beta(1, 1),   prior_logor_cure = NULL,   prior_hrsd = p_gamma(2, 1),   backhaz = NULL,   backhaz_strata = NULL,   mspline = NULL,   add_knots = NULL,   smooth_model = \"random_walk\",   hsd = \"bayes\",   coefs_mean = NULL,   fit_method = \"mcmc\",   loo = (fit_method == \"mcmc\"),   ... )"},{"path":"https://chjackson.github.io/survextrap/reference/survextrap.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Flexible Bayesian parametric survival models — survextrap","text":"formula survival formula standard R formula syntax, call Surv() left hand side. Covariates included right hand side formula modelled proportional hazards, nonprop TRUE non-proportional hazards used. data omitted, model fitted external aggregate data alone, without individual data, formula include Surv() call.  left-hand side formula empty, right hand side specifies covariates usual.  example, formula = ~1 covariates. data Data frame containing variables formula. Variables data frame, working environment. may omitted, case external must supplied.  allows model fitted external aggregate data alone, without individual-level data. external External data data frame aggregate survival counts columns named: start: Start time stop: Follow-time n: Number people alive start r: Number people still alive stop covariates formula, values take external data must supplied additional columns external.  Therefore external data, covariates formula data named start,stop,n r. cure TRUE, mixture cure model used, \"uncured\" survival defined M-spline model, cure probability estimated. nonprop Non-proportional hazards model specification. achieved modelling spline basis coefficients terms covariates.  See methods vignette details. TRUE, covariates modelled non-proportional hazards, using model formula formula. formula, assumed define model dependence basis coefficients covariates. NULL FALSE (default) covariates modelled proportional hazards. prior_hscale Prior baseline log hazard scale parameter (alpha log(eta)).  call prior constructor function, p_normal(0,1) p_t(0,2,2).  Supported prior distribution families normal (parameters mean SD) t distributions (parameters location, scale degrees freedom).  default normal distribution mean 0 standard deviation 20. Note eta hazard, proportional hazard (see vignette full model specification). \"Baseline\" defined continuous covariates taking value zero factor covariates taking reference level.  use different baseline, data transformed appropriately beforehand, value zero different meaning.  continuous covariates, helps computation interpretation define value zero denote typical value data, e.g. mean. prior_loghr Priors log hazard ratios.  call p_normal() p_t().  list calls can also provided, give different priors different coefficients, name list component matches name coefficient, e.g.  list(\"age45-59\" = p_normal(0,1), \"age60+\" = p_t(0,2,3)) default p_normal(0,2.5) coefficients. prior_hsd Gamma prior standard deviation controls variability time (smoothness) hazard function.  call p_gamma().  default p_gamma(2,1).  See prior_haz_sd way calibrate represent meaningful belief. prior_cure Prior baseline cure probability.  call p_beta().  default uniform prior, p_beta(1,1). Baseline defined mean continuous covariates reference level factor covariates. prior_logor_cure Priors log odds ratios cure probabilities. call p_normal() p_t().  default p_normal(0,2.5). prior_hrsd Prior standard deviation parameters smooth non-proportionality effects time non-proportional hazards models.  call p_gamma() list calls p_gamma() one component per covariate, prior_loghr.  See prior_hr_sd way calibrate represent meaningful belief. backhaz Background hazard, , causes death cause interest. defines \"relative survival\" model overall hazard sum cause-specific hazard background hazard.  background hazard assumed known, cause-specific hazard modelled flexible parametric model. background hazard can supplied two forms.  meaning predictions model depends used. () data frame columns \"hazard\" \"time\", specifying background hazard times piecewise-constant (step) function.  row gives background hazard specified time next time.  first element \"time\" 0, final row specifies hazard times greater last element \"time\".  Predictions model fitted survextrap include background hazard, known times. (b) (quoted) name variable data giving background hazard.  censored cases, exact value matter.  predictions survextrap describe excess hazard survival top background.  overall hazard predicted general, background hazard specified limited range time. external data, backhaz supplied form (b), user also supply background survival start stop points columns external data named \"backsurv_start\" \"backsurv_stop\".  , probability survival times someone alive time 0. describe reference population backhaz, though package check consistency . stratifying variables specified backhaz_strata, multiple rows giving background hazard value time period stratifying variable. backhaz NULL (default) background hazard component included model. backhaz_strata character vector names variables appear backhaz indicate strata, e.g. backhaz_strata = c(\"agegroup\",\"sex\").  allows different background hazard values used different subgroups.  variables must also appear datasets modelled, , data, external .  row datasets corresponding row backhaz values stratifying variables. NULL default, indicating stratification background hazard. stratification done, backhaz must supplied form (), data frame rather variable data. mspline list control parameters defining spline model. knots: Spline knots.  supplied, number knots taken df, location taken equally-spaced quantiles observed event times individual-level data. add_knots: intended used external data included model.  External data typically outside time period covered individual data.  add_knots chosen span time period covered external data, hazard trajectory can vary time. external data, knots add_knots omitted, default set knots chosen span individual external data, taking quantiles vector defined concatenating individual-level event times start stop times external data. df: Degrees freedom, .e. number parameters (basis terms) intended result choosing knots based quantiles data.  total number parameters df plus number additional knots specified add_knots. df defaults 10.  necessarily overfit, function smoothed prior. degree: Polynomial degree used basis function. default 3, giving cubic. can changed 3 bsmooth FALSE. bsmooth: TRUE (default) spline smoother highest knot, defining derivative second derivative point zero. add_knots extra knots beyond chosen individual-level data (supplied knots).  spline specifications set defaults, described mspline.  example, add_knots = 10 shorthand mspline = list(add_knots = 10). smooth_model default \"random_walk\", specifies random walk prior multinomial-logit spline coefficients, based logistic distributions.  See methods vignette full details. alternative \"exchangeable\" uses independent logistic priors multinomial-logit spline coefficients, conditionally common smoothing variance parameter.  Note method explained original survextrap paper (Jackson, BMC Med Res 2023).  random walk model shown perform better Timmins et al (2025). non-proportional hazards models, setting smooth_model also determines whether exchangeable random walk model used non-proportionality parameters (\\(\\delta\\)). hsd Smoothing variance parameter estimation. \"bayes\": smoothing parameter estimated full Bayes (default). \"eb\": empirical Bayes used. Alternatively, number supplied , smoothing parameter fixed number. coefs_mean Spline basis coefficients define prior mean hazard function. default, set values define constant hazard function (see mspline_constant_coefs).  normalised sum 1 internally (already). fit_method Method rstan used fit model. fit_method=\"mcmc\" sample posterior drawn using Markov Chain Monte Carlo sampling, via rstan's rstan::sampling() function.  default.  accurate slowest method. fit_method=\"opt\", instead MCMC sample posterior, survextrap returns posterior mode calculated using optimisation, via rstan's rstan::optimizing() function.  sample normal approximation (real-line-transformed) posterior distribution drawn order obtain credible intervals.  useful model development, using MCMC \"final answer\". fit_method=\"vb\", variational Bayes methods used, via rstan's rstan::vb() function. labelled \"experimental\" rstan.  might give better approximation posterior fit_method=\"opt\", faster MCMC, particular large datasets, investigated depth models. loo Compute leave-one-cross-validation statistics. done default. Set FALSE compute .  statistics computed, returned loo loo_external components object returned survextrap.  loo describes fit model individual-level data, loo_external describes fit external data. See \"examples\" vignette explanation . ... Additional arguments supply control Stan fit, passed appropriate rstan function, depending chosen fit_method argument.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/survextrap.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Flexible Bayesian parametric survival models — survextrap","text":"list objects defining fitted model.  intended extracted directly users.  Instead see summary.survextrap summarising parameter estimates, functions hazard, survival, rmst others computing interesting summaries fitted survival distribution. object returned rstan containing samples fitted model returned stanfit component.  See rstan documentation.  function get_draws provided convert simple matrix posterior samples chains collapsed.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/survextrap.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Flexible Bayesian parametric survival models — survextrap","text":"Jackson, C. (2023) survextrap: package flexible transparent survival extrapolation. BMC Medical Research Methodology 23:282. doi:10.1186/s12874-023-02094-1 Timmins , Torabi F, Jackson C, Lambert P, Sweeting M J. (2025) Simulation-based assessment Bayesian survival model flexible baseline hazard time-dependent effects. doi:10.48550/arXiv.2503.21388 .","code":""},{"path":"https://chjackson.github.io/survextrap/reference/survival.html","id":null,"dir":"Reference","previous_headings":"","what":"Estimates of survival from a survextrap model — survival","title":"Estimates of survival from a survextrap model — survival","text":"Estimates survival probabilities particular times, survextrap model","code":""},{"path":"https://chjackson.github.io/survextrap/reference/survival.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Estimates of survival from a survextrap model — survival","text":"","code":"survival(   x,   newdata = NULL,   t = NULL,   tmax = NULL,   niter = NULL,   summ_fns = NULL,   sample = FALSE,   newdata0 = NULL,   wane_period = NULL,   wane_nt = 10 )"},{"path":"https://chjackson.github.io/survextrap/reference/survival.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Estimates of survival from a survextrap model — survival","text":"x fitted model object returned survextrap newdata Data frame covariate values compute output . covariates model supplied, following default used: () covariate one factor variable, output computed level factor. (b) multiple covariates, numeric covariates, output computed mean numeric covariate original data, baseline level factor covariate. Note: caution required treatment groups (example) stored data.  coded numeric (0/1), newdata specified, one output shown. relates average value numeric variable data, correspond either treatment groups.  avoid , treatment group stored factor. t Vector times compute estimates. tmax Maximum time compute estimates.  t supplied, ignored.  t supplied, t set set 100 equally spaced time points 0 tmax.  tmax t supplied, tmax set maximum follow time data. niter Number MCMC iterations use compute credible intervals.  Set low value make function quicker, cost approximation error (may important plotting model development). summ_fns list functions use summarise posterior sample. passed posterior::summarise_draws. default list(median=median, ~quantile(.x, probs=c(0.025, 0.975))). list named, names used columns output. sample TRUE MCMC samples returned instead summarised median 95% credible intervals. newdata0 Data frame covariate values defining \"untreated\" group use treatment waning models. See Survmspline_wane. wane_period Vector two numbers, defining time period hazard interpolated hazard \"treated\" group (taken newdata) hazard \"untreated\" group (taken newdata0).  Optional - supplied, waning assumed. wane_nt Number intervals defining piecewise constant approximation hazard waning period.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/survival.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Estimates of survival from a survextrap model — survival","text":"data frame (tibble) giving posterior summary statistics, (sample=TRUE) array giving samples posterior.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/Survmspline.html","id":null,"dir":"Reference","previous_headings":"","what":"M-spline survival distribution — Survmspline","title":"M-spline survival distribution — Survmspline","text":"Probability density, distribution, quantile, random generation, hazard, cumulative hazard, mean restricted mean functions M-spline time--event model.  can optionally combined cure probability, / known background hazard trajectory piecewise-constant function time.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/Survmspline.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"M-spline survival distribution — Survmspline","text":"","code":"psurvmspline(   q,   alpha,   coefs,   knots,   degree = 3,   lower.tail = TRUE,   log.p = FALSE,   pcure = 0,   offsetH = 0,   backhaz = NULL,   bsmooth = TRUE )  Hsurvmspline(   x,   alpha,   coefs,   knots,   degree = 3,   log = FALSE,   pcure = 0,   offsetH = 0,   backhaz = NULL,   bsmooth = TRUE )  hsurvmspline(   x,   alpha,   coefs,   knots,   degree = 3,   log = FALSE,   pcure = 0,   offseth = 0,   backhaz = NULL,   bsmooth = TRUE )  dsurvmspline(   x,   alpha,   coefs,   knots,   degree = 3,   log = FALSE,   pcure = 0,   offseth = 0,   offsetH = 0,   backhaz = NULL,   bsmooth = TRUE )  qsurvmspline(   p,   alpha,   coefs,   knots,   degree = 3,   lower.tail = TRUE,   log.p = FALSE,   pcure = 0,   offsetH = 0,   backhaz = NULL,   bsmooth = TRUE )  rsurvmspline(   n,   alpha,   coefs,   knots,   degree = 3,   pcure = 0,   offsetH = 0,   backhaz = NULL,   bsmooth = TRUE )  rmst_survmspline(   t,   alpha,   coefs,   knots,   degree = 3,   pcure = 0,   offsetH = 0,   backhaz = NULL,   bsmooth = TRUE,   disc_rate = 0,   method = \"gl\",   gl_nodes = 100 )  mean_survmspline(   alpha,   coefs,   knots,   degree = 3,   pcure = 0,   offsetH = 0,   backhaz = NULL,   bsmooth = TRUE,   disc_rate = 0 )"},{"path":"https://chjackson.github.io/survextrap/reference/Survmspline.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"M-spline survival distribution — Survmspline","text":"alpha Log hazard scale parameter. coefs Spline basis coefficients. sum 1, otherwise normalised internally sum 1.  Supplied either vector one element per basis term, matrix one column per basis term, rows alternative values coefficients (vectorised usage function).  array supplied, collapsed matrix number columns equal final dimension array. knots Locations knots axis time, supplied increasing order.  include two boundary knots. vectorised usage functions, knots degree must alternative times parameter values. degree Spline polynomial degree.  Can changed default 3 bsmooth FALSE. lower.tail logical; TRUE (default), probabilities \\(P(X \\le x)\\), otherwise, \\(P(X > x)\\). pcure Probability \"cure\", defaults zero.  non-zero, defines \"mixture cure\" version M-spline model. offsetH Constant added cumulative hazard. backhaz data frame defines background hazard piecewise-constant function time. two columns, named \"time\" \"hazard\". row gives \"background\" hazard specified time next time. first element \"time\" 0, final row specifies hazard times greater last element \"time\". bsmooth TRUE function constrained also zero derivative second derivative boundary. x, q, t Vector times. log, log.p Return log density probability. offseth Constant added hazard, e.g. representing \"background\" risk death causes cause interest. p Vector probabilities. n Number random numbers simulate. disc_rate Discounting rate used calculate discounted mean restricted mean survival time, using exponential discounting function. method Method numerical integration obtain restricted mean survival time survival function. default method=\"gl\", Gauss-Legendre method 100 nodes zero maximum t. method=\"adaptive\" uses base R integrate function, much slower, potentially robust badly-behaved survival functions. gl_nodes Number nodes Gauss-Legendre method.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/Survmspline.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"M-spline survival distribution — Survmspline","text":"dsurvmspline gives density, psurvmspline gives distribution function, hsurvmspline gives hazard Hsurvmspline gives cumulative hazard. qsurvmspline gives quantile function, computed numerical inversion. rsurvmspline generates random survival times using qsurvmspline sample uniform random numbers.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/Survmspline.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"M-spline survival distribution — Survmspline","text":"M-splines used model survival data rstanarm, except additional assumption made hazard constant beyond boundary knots value boundary.   gives continuous non-smooth function. \"cure\" model can interpreted two different ways.  result identical probability distribution functions event time, hence indistinguishable data: () model everyone follows hazard trajectory decreasing time, higher rate decrease higher pcure. (b) model person either constant zero hazard times, hazard follows parametric model (M-spline case).  probability person zero hazard pcure. \"mixture model\" interpretation. \"background hazard\" model, overall hazard defined sum background hazard cause-specific hazard.   cause-specific hazard modelled M-spline model, background hazard assumed known piecewise-constant function defined backhaz. backhaz pcure supplied, cure probablity applies cause-specific hazard. , cause-specific hazard decreases zero, overall hazard converges towards background hazard, time increases.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/Survmspline.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"M-spline survival distribution — Survmspline","text":"Ramsay, J. O. (1988). Monotone regression splines action. Statistical Science, 3(4): 425-441. Brilleman, S. L., Elci, E. M., Novik, J. B., & Wolfe, R. (2020). Bayesian survival analysis using rstanarm R package. arXiv preprint arXiv:2002.09633. Wang, W., Yan, J. (2021). Shape-restricted regression splines R package splines2. Journal Data Science, 19(3), 498-517.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/Survmspline.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"M-spline survival distribution — Survmspline","text":"Christopher Jackson chris.jackson@mrc-bsu.cam.ac.uk","code":""},{"path":"https://chjackson.github.io/survextrap/reference/Survmspline_wane.html","id":null,"dir":"Reference","previous_headings":"","what":"M-spline survival distribution under treatment effect waning — Survmspline_wane","title":"M-spline survival distribution under treatment effect waning — Survmspline_wane","text":"defines CDF, cumulative hazard hazard survival distribution defined combining hazards two different groups (e.g. \"treated\" \"untreated\") defined standard M-spline model. log hazards one group interpolated defined period time.  may used models treatment effect wanes, period time, estimated hazard ratio zero.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/Survmspline_wane.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"M-spline survival distribution under treatment effect waning — Survmspline_wane","text":"","code":"Hsurvmspline_wane(   x,   alpha1,   alpha0,   coefs1,   coefs0,   knots,   degree = 3,   wane_period,   wane_nt = 10,   pcure1 = 0,   pcure0 = 0,   offsetH = 0,   backhaz = NULL,   bsmooth = TRUE,   log = FALSE )  psurvmspline_wane(   q,   alpha1,   alpha0,   coefs1,   coefs0,   knots,   degree = 3,   bsmooth = TRUE,   wane_period,   wane_nt = 10,   lower.tail = TRUE,   pcure1 = 0,   pcure0 = 0,   offsetH = 0,   backhaz = NULL,   log.p = FALSE )  hsurvmspline_wane(   x,   alpha1,   alpha0,   coefs1,   coefs0,   knots,   degree = 3,   bsmooth = TRUE,   wane_period,   wane_nt = 10,   pcure1 = 0,   pcure0 = 0,   offseth = 0,   backhaz = NULL,   log = FALSE )  dsurvmspline_wane(   x,   alpha1,   alpha0,   coefs1,   coefs0,   knots,   degree = 3,   bsmooth = TRUE,   wane_period,   wane_nt = 10,   pcure1 = 0,   pcure0 = 0,   offseth = 0,   offsetH = 0,   backhaz = NULL,   log = FALSE )  qsurvmspline_wane(   p,   alpha1,   alpha0,   coefs1,   coefs0,   knots,   degree = 3,   bsmooth = TRUE,   lower.tail = TRUE,   log.p = FALSE,   pcure1 = 0,   pcure0 = 0,   offsetH = 0,   backhaz = NULL,   wane_period,   wane_nt = 10 )  rsurvmspline_wane(   n,   alpha1,   alpha0,   coefs1,   coefs0,   knots,   degree = 3,   bsmooth = TRUE,   pcure1 = 0,   pcure0 = 0,   offsetH = 0,   backhaz = NULL,   wane_period,   wane_nt = 10 )  rmst_survmspline_wane(   t,   alpha1,   alpha0,   coefs1,   coefs0,   knots,   degree = 3,   pcure1 = 0,   pcure0 = 0,   offsetH = 0,   backhaz = NULL,   bsmooth = TRUE,   wane_period,   wane_nt = 10,   disc_rate = 0,   method = \"gl\",   gl_nodes = 100 )  mean_survmspline_wane(   alpha1,   alpha0,   coefs1,   coefs0,   knots,   degree = 3,   pcure1 = 0,   pcure0 = 0,   backhaz = NULL,   bsmooth = TRUE,   wane_period,   wane_nt = 10,   disc_rate = 0 )"},{"path":"https://chjackson.github.io/survextrap/reference/Survmspline_wane.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"M-spline survival distribution under treatment effect waning — Survmspline_wane","text":"x, q, t Vector times. alpha1, coefs1, pcure1 log hazard intercept, spline coefficients cure probability start waning period (\"treated\") alpha0, coefs0, pcure0 log hazard intercept, spline coefficients cure probability end waning period (\"untreated\") knots Locations knots axis time, supplied increasing order.  include two boundary knots. vectorised usage functions, knots degree must alternative times parameter values. degree Spline polynomial degree.  Can changed default 3 bsmooth FALSE. wane_period vector two components giving start stop waning period wane_nt time resolution piecewise constant hazard approximation waning period.  specified, defaults dividing waning period 10 pieces. offsetH Constant added cumulative hazard. backhaz data frame defines background hazard piecewise-constant function time. two columns, named \"time\" \"hazard\". row gives \"background\" hazard specified time next time. first element \"time\" 0, final row specifies hazard times greater last element \"time\". bsmooth TRUE function constrained also zero derivative second derivative boundary. log, log.p Return log density probability. lower.tail logical; TRUE (default), probabilities \\(P(X \\le x)\\), otherwise, \\(P(X > x)\\). offseth Constant added hazard, e.g. representing \"background\" risk death causes cause interest. p Vector probabilities. n Number random numbers simulate. disc_rate Discounting rate used calculate discounted mean restricted mean survival time, using exponential discounting function. method Method numerical integration obtain restricted mean survival time survival function. default method=\"gl\", Gauss-Legendre method 100 nodes zero maximum t. method=\"adaptive\" uses base R integrate function, much slower, potentially robust badly-behaved survival functions. gl_nodes Number nodes Gauss-Legendre method.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/Survmspline_wane.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"M-spline survival distribution under treatment effect waning — Survmspline_wane","text":"psurvmspline_wane gives CDF, Hsurvmspline_wane gives cumulative hazard, hsurvmspline_wane gives hazard, dsurvmspline_wane gives PDF, qsurvmspline_wane gives quantiles, rsurvmspline_wane generates random numbers distribution.","code":""},{"path":"https://chjackson.github.io/survextrap/reference/Survmspline_wane.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"M-spline survival distribution under treatment effect waning — Survmspline_wane","text":"distribution defined follows. time 0 wane_period[1], \"treated\" hazard used, defined M-spline intercept alpha1. wane_period[1] wane_period[2], log hazard defined linear interpolation.  waning period divided number discrete pieces hazard assumed constant, defined hazard start piece. hazard values obtained spline model, using intercept parameter alpha (log scale parameter) defined linearly interpolating alpha1 alpha0 waning period.  cumulative hazard time can deduced adding contributions piece. wane_period[2], \"untreated\" hazard used, defined M-spline intercept alpha0. See methods vignette details examples. can used predict hazard person treated treatment whose short-term effect estimated shorter-term data, wish extrapolate model longer period effect assumed diminish. may work hazard zero infinite point waning period (thus log hazard indeterminate).  might typically happen time 0.","code":""},{"path":"https://chjackson.github.io/survextrap/news/index.html","id":"version-09-20250502","dir":"Changelog","previous_headings":"","what":"Version 0.9 (2025/05/02)","title":"Version 0.9 (2025/05/02)","text":"smooth_model = \"random_walk\" made default survextrap(), following Timmins et al..","code":""},{"path":"https://chjackson.github.io/survextrap/news/index.html","id":"version-0816-20250226","dir":"Changelog","previous_headings":"","what":"Version 0.8.16 (2025/02/26)","title":"Version 0.8.16 (2025/02/26)","text":"rmst() related functions now faster, new Gauss-Legendre integration method. Thanks Iain Timmins.","code":""},{"path":"https://chjackson.github.io/survextrap/news/index.html","id":"version-0815-20240701","dir":"Changelog","previous_headings":"","what":"Version 0.8.15 (2024/07/01)","title":"Version 0.8.15 (2024/07/01)","text":"Random walk prior coefficients changed first-order weighted model, following Phillippo et al., expected smoothness accounts knot spacing.","code":""},{"path":"https://chjackson.github.io/survextrap/news/index.html","id":"version-0814-20240613","dir":"Changelog","previous_headings":"","what":"Version 0.8.14 (2024/06/13)","title":"Version 0.8.14 (2024/06/13)","text":"Added discount rate argument disc_rate mean rmst() functions (PR #12)","code":""},{"path":"https://chjackson.github.io/survextrap/news/index.html","id":"version-0813-20240305","dir":"Changelog","previous_headings":"","what":"Version 0.8.13 (2024/03/05)","title":"Version 0.8.13 (2024/03/05)","text":"Bug fix models external data either nonproportional hazards covariates cure probability.","code":""},{"path":"https://chjackson.github.io/survextrap/news/index.html","id":"version-0812-20240106","dir":"Changelog","previous_headings":"","what":"Version 0.8.12 (2024/01/06)","title":"Version 0.8.12 (2024/01/06)","text":"irmst, hazard_ratio hrtime tidied. Fix bug irmst introduced v0.8.9, now sample argument.","code":""},{"path":"https://chjackson.github.io/survextrap/news/index.html","id":"version-0811-20231228","dir":"Changelog","previous_headings":"","what":"Version 0.8.11 (2023/12/28)","title":"Version 0.8.11 (2023/12/28)","text":"Outputs standardised covariate values reference population can now produced using new standardise_to() function.","code":""},{"path":"https://chjackson.github.io/survextrap/news/index.html","id":"version-0810-20231224","dir":"Changelog","previous_headings":"","what":"Version 0.8.10 (2023/12/24)","title":"Version 0.8.10 (2023/12/24)","text":"loo longer ignores covariates cure probability cure models. internal refactoring code produce outputs.","code":""},{"path":"https://chjackson.github.io/survextrap/news/index.html","id":"version-089-20231222","dir":"Changelog","previous_headings":"","what":"Version 0.8.9 (2023/12/22)","title":"Version 0.8.9 (2023/12/22)","text":"Cleaned simplified internal code model outputs (rmst, survival etc.). rmst now outputs tibble, credible limits default output renamed lower upper consistency survival hazard. Arrays now allowed coef argument dsurvspline related functions.","code":""},{"path":"https://chjackson.github.io/survextrap/news/index.html","id":"version-088-20231219","dir":"Changelog","previous_headings":"","what":"Version 0.8.8 (2023/12/19)","title":"Version 0.8.8 (2023/12/19)","text":"Background hazards additive hazards models can now stratified, using new backhaz_strata argument survextrap(). argument names stratifying variables (e.g. age group) background hazards individual /external data. Bug fix hsurvmspline_wane dsurvmspline_wane offsets implemented correctly. affected hazard predictions models included background hazards treatment effect waning.","code":""},{"path":"https://chjackson.github.io/survextrap/news/index.html","id":"version-087-20231029","dir":"Changelog","previous_headings":"","what":"Version 0.8.7 (2023/10/29)","title":"Version 0.8.7 (2023/10/29)","text":"random walk prior can now specified spline coefficients, smooth_model = \"random_walk\".","code":""},{"path":"https://chjackson.github.io/survextrap/news/index.html","id":"version-086-20231024","dir":"Changelog","previous_headings":"","what":"Version 0.8.6 (2023/10/24)","title":"Version 0.8.6 (2023/10/24)","text":"Non-proportional hazards models can now applied subset covariates, supplying formula nonprop argument survextrap. Prior simulation functions prior_sample now require explicit covariate model, specified formula newdata, rather design matrix X. functions now fully support nonproportional hazards models cure probabilities associated regression models.","code":""},{"path":"https://chjackson.github.io/survextrap/news/index.html","id":"version-085-20230930","dir":"Changelog","previous_headings":"","what":"Version 0.8.5 (2023/09/30)","title":"Version 0.8.5 (2023/09/30)","text":"Code constructing mspline specification objects tidied, new mspline_init mspline_list_init functions.","code":""},{"path":"https://chjackson.github.io/survextrap/news/index.html","id":"version-084-20230909","dir":"Changelog","previous_headings":"","what":"Version 0.8.4 (2023/09/09)","title":"Version 0.8.4 (2023/09/09)","text":"Deprecated Stan array syntax updated. package now requires rstan version 2.26.","code":""},{"path":"https://chjackson.github.io/survextrap/news/index.html","id":"version-083-20230630","dir":"Changelog","previous_headings":"","what":"Version 0.8.3 (2023/06/30)","title":"Version 0.8.3 (2023/06/30)","text":"Fix mspline_spec bug introduced 0.8.2.","code":""},{"path":"https://chjackson.github.io/survextrap/news/index.html","id":"version-082-20230614","dir":"Changelog","previous_headings":"","what":"Version 0.8.2 (2023/06/14)","title":"Version 0.8.2 (2023/06/14)","text":"Individual data can now excluded, model fitted external data alone.","code":""},{"path":"https://chjackson.github.io/survextrap/news/index.html","id":"version-081-20230525","dir":"Changelog","previous_headings":"","what":"Version 0.8.1 (2023/05/25)","title":"Version 0.8.1 (2023/05/25)","text":"Update work StanHeaders 2.26.","code":""},{"path":"https://chjackson.github.io/survextrap/news/index.html","id":"version-08-20230506","dir":"Changelog","previous_headings":"","what":"Version 0.8 (2023/05/06)","title":"Version 0.8 (2023/05/06)","text":"GitHub commit 6 May 2023 implemented several changes listed . survextrap now “beta” status. major features now implemented, may still lack polish.","code":""},{"path":"https://chjackson.github.io/survextrap/news/index.html","id":"new-features-0-8","dir":"Changelog","previous_headings":"","what":"New features","title":"Version 0.8 (2023/05/06)","text":"new vignette cetuximab, giving -depth case study realistic use survextrap. included forthcoming paper. Improvements usability stability M-splines: iknots bknots replaced single knots, lower boundary knot always fixed zero. add_knots can used add user-defined knots default ones. See case study. New function mspline_spec define M-spline knots based data, advance fitting models. M-splines can now smoother final knot, option bsmooth, default. Thanks Iain Timmins suggestion. Incremental restricted mean survival time (irmst) added. summary posterior distribution can produced supplying list summary functions (e.g. mean, quantiles) output functions (rmst survival). Leave-one-cross validation external data.","code":""},{"path":"https://chjackson.github.io/survextrap/news/index.html","id":"bug-fixes-and-improvements-0-8","dir":"Changelog","previous_headings":"","what":"Bug fixes and improvements","title":"Version 0.8 (2023/05/06)","text":"Bug fix hsurvmspline() (hence hazard()) using wrong tail end psurvmspline(). Waning models longer ignore non-proportional hazards cure. Waning vignette merged methods vignette. Leave-one-cross validation now supports models background hazards. consistent naming arguments variables (e.g. hscale hazard scale, hsd hazard smoothing parameter). information given printing fitted model objects. Thorough documentation polishing code tidying.","code":""},{"path":[]},{"path":"https://chjackson.github.io/survextrap/news/index.html","id":"changes-0-1","dir":"Changelog","previous_headings":"","what":"Changes","title":"Version 0.1","text":"See commit messages GitHub history developments survextrap.","code":""}]
